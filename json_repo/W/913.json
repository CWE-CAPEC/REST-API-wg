{"ID":"913","Name":"Improper Control of Dynamically-Managed Code Resources","Abstraction":"Class","Structure":"Simple","Status":"Incomplete","Description":"The product does not properly restrict reading from or writing to dynamically-managed code resources such as variables, objects, classes, attributes, functions, or executable instructions or statements.","ExtendedDescription":"Many languages offer powerful features that allow the programmer to dynamically create or modify existing code, or resources used by code such as variables and objects. While these features can offer significant flexibility and reduce development time, they can be extremely dangerous if attackers can directly influence these code resources in unexpected ways.","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"664","ViewID":"1000","Ordinal":"Primary"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Language","Class":"Interpreted","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Architecture and Design"},{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Integrity"],"Impact":["Execute Unauthorized Code or Commands"]},{"Scope":["Other","Integrity"],"Impact":["Varies by Context","Alter Execution Logic"]}],"DetectionMethods":[{"DetectionMethodID":"DM-13","Method":"Fuzzing","Description":"Fuzz testing (fuzzing) is a powerful technique for generating large numbers of diverse inputs - either randomly or algorithmically - and dynamically invoking the code with those inputs. Even with random inputs, it is often capable of generating unexpected results such as crashes, memory corruption, or resource consumption. Fuzzing effectively produces repeatable test cases that clearly indicate bugs, which helps developers to diagnose the issues.","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Implementation"],"Strategy":"Input Validation","Description":"For any externally-influenced input, check the input against an allowlist of acceptable values."},{"Phase":["Implementation","Architecture and Design"],"Strategy":"Refactoring","Description":"Refactor the code so that it does not need to be dynamically managed."}],"DemonstrativeExamples":[{"ID":"DX-32","Entries":[{"IntroText":"This example attempts to write user messages to a message file and allow users to view them."},{"Nature":"Bad","Language":"PHP","ExampleCode":"```\n\t$MessageFile = \"messages.out\";\n\tif ($_GET[\"action\"] == \"NewMessage\") {\n\t\t$name = $_GET[\"name\"];\n\t\t$message = $_GET[\"message\"];\n\t\t$handle = fopen($MessageFile, \"a+\");\n\t\tfwrite($handle, \"\u003cb\u003e$name\u003c/b\u003e says '$message'\u003chr\u003e\\n\");\n\t\tfclose($handle);\n\t\techo \"Message Saved!\u003cp\u003e\\n\";\n\t}\n\telse if ($_GET[\"action\"] == \"ViewMessages\") {\n\t\tinclude($MessageFile);\n\t}\n```"},{"BodyText":"While the programmer intends for the MessageFile to only include data, an attacker can provide a message such as:"},{"Nature":"Attack","ExampleCode":"```\n\tname=h4x0r\n\tmessage=%3C?php%20system(%22/bin/ls%20-l%22);?%3E\n```"},{"BodyText":"which will decode to the following:"},{"Nature":"Attack","ExampleCode":"```\n\t\u003c?php system(\"/bin/ls -l\");?\u003e\n```"},{"BodyText":"The programmer thought they were just including the contents of a regular data file, but PHP parsed it and executed the code. Now, this code is executed any time people view messages."},{"BodyText":"Notice that XSS (CWE-79) is also possible in this situation."}]},{"ID":"DX-232","Entries":[{"IntroText":"A common reason that programmers use the reflection API is to implement their own command dispatcher. The following example shows a command dispatcher that does not use reflection:"},{"Nature":"Good","Language":"Java","ExampleCode":"```\n\tString ctl = request.getParameter(\"ctl\");\n\t Worker ao = null;\n\t if (ctl.equals(\"Add\")) { \n\t\t ao = new AddCommand(); \n\t }\n\t else if (ctl.equals(\"Modify\")) { \n\t\t ao = new ModifyCommand(); \n\t }\n\t else { \n\t\t throw new UnknownActionError(); \n\t} \n\t ao.doAction(request); \n```"},{"BodyText":"A programmer might refactor this code to use reflection as follows:"},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\t String ctl = request.getParameter(\"ctl\");\n\t Class cmdClass = Class.forName(ctl + \"Command\");\n\t Worker ao = (Worker) cmdClass.newInstance();\n\t ao.doAction(request); \n```"},{"BodyText":"The refactoring initially appears to offer a number of advantages. There are fewer lines of code, the if/else blocks have been entirely eliminated, and it is now possible to add new command types without modifying the command dispatcher.\n\n\nHowever, the refactoring allows an attacker to instantiate any object that implements the Worker interface. If the command dispatcher is still responsible for access control, then whenever programmers create a new class that implements the Worker interface, they must remember to modify the dispatcher's access control code. If they do not modify the access control code, then some Worker classes will not have any access control."},{"BodyText":"One way to address this access control problem is to make the Worker object responsible for performing the access control check. An example of the re-refactored code follows:"},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\t String ctl = request.getParameter(\"ctl\");\n\t Class cmdClass = Class.forName(ctl + \"Command\");\n\t Worker ao = (Worker) cmdClass.newInstance();\n\t ao.checkAccessControl(request);\n\t ao.doAction(request); \n```"},{"BodyText":"Although this is an improvement, it encourages a decentralized approach to access control, which makes it easier for programmers to make access control mistakes."},{"BodyText":"This code also highlights another security problem with using reflection to build a command dispatcher. An attacker can invoke the default constructor for any kind of object. In fact, the attacker is not even constrained to objects that implement the Worker interface; the default constructor for any object in the system can be invoked. If the object does not implement the Worker interface, a ClassCastException will be thrown before the assignment to ao, but if the constructor performs operations that work in the attacker's favor, the damage will already have been done. Although this scenario is relatively benign in simple products, in larger products where complexity grows exponentially, it is not unreasonable that an attacker could find a constructor to leverage as part of an attack."}]}],"ObservedExamples":[{"Reference":"CVE-2022-2054","Description":"Python compiler uses eval() to execute malicious strings as Python code.","Link":"https://www.cve.org/CVERecord?id=CVE-2022-2054"},{"Reference":"CVE-2018-1000613","Description":"Cryptography API uses unsafe reflection when deserializing a private key","Link":"https://www.cve.org/CVERecord?id=CVE-2018-1000613"},{"Reference":"CVE-2015-8103","Description":"Deserialization issue in commonly-used Java library allows remote execution.","Link":"https://www.cve.org/CVERecord?id=CVE-2015-8103"},{"Reference":"CVE-2006-7079","Description":"Chain: extract used for register_globals compatibility layer, enables path traversal (CWE-22)","Link":"https://www.cve.org/CVERecord?id=CVE-2006-7079"},{"Reference":"CVE-2012-2055","Description":"Source version control product allows modification of trusted key using mass assignment.","Link":"https://www.cve.org/CVERecord?id=CVE-2012-2055"}],"MappingNotes":{"Usage":"Allowed-with-Review","Rationale":"This CWE entry is a Class and might have Base-level children that would be more appropriate","Comments":"Examine children of this entry to see if there is a better fit","Reasons":["Abstraction"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"CWE Content Team","SubmissionOrganization":"MITRE","SubmissionDate":"2013-01-26","SubmissionVersion":"2.4","SubmissionReleaseDate":"2013-02-21"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-01-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-06-25","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-10-26","ModificationComment":"updated Observed_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-12-11","ModificationComment":"updated Applicable_Platforms, Demonstrative_Examples, Weakness_Ordinalities","ModificationVersion":"4.19","ModificationReleaseDate":"2025-12-11"}]}