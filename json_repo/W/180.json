{"ID":"180","Name":"Incorrect Behavior Order: Validate Before Canonicalize","Abstraction":"Variant","Structure":"Simple","Status":"Draft","Description":"The product validates input before it is canonicalized, which prevents the product from detecting data that becomes invalid after the canonicalization step.","ExtendedDescription":"This can be used by an attacker to bypass the validation and launch attacks that expose weaknesses that would otherwise be prevented, such as injection.","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"179","ViewID":"1000","Ordinal":"Primary"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Access Control"],"Impact":["Bypass Protection Mechanism"]}],"PotentialMitigations":[{"MitigationID":"MIT-20","Phase":["Implementation"],"Strategy":"Input Validation","Description":"Inputs should be decoded and canonicalized to the application's current internal representation before being validated (CWE-180). Make sure that the application does not decode the same input twice (CWE-174). Such errors could be used to bypass allowlist validation schemes by introducing dangerous inputs after they have been checked."}],"DemonstrativeExamples":[{"ID":"DX-35","Entries":[{"IntroText":"The following code attempts to validate a given input path by checking it against an allowlist and then return the canonical path. In this specific case, the path is considered valid if it starts with the string \"/safe_dir/\"."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tString path = getInputPath();\n\tif (path.startsWith(\"/safe_dir/\"))\n\t{\n\t\tFile f = new File(path);\n\t\treturn f.getCanonicalPath();\n\t}\n```"},{"BodyText":"The problem with the above code is that the validation step occurs before canonicalization occurs. An attacker could provide an input path of \"/safe_dir/../\" that would pass the validation step. However, the canonicalization process sees the double dot as a traversal to the parent directory and hence when canonicized the path would become just \"/\"."},{"BodyText":"To avoid this problem, validation should occur after canonicalization takes place. In this case canonicalization occurs during the initialization of the File object. The code below fixes the issue."},{"Nature":"Good","Language":"Java","ExampleCode":"```\n\tString path = getInputPath();\n\tFile f = new File(path);\n\tif (f.getCanonicalPath().startsWith(\"/safe_dir/\"))\n\t{\n\t\treturn f.getCanonicalPath();\n\t}\n```"}]}],"ObservedExamples":[{"Reference":"CVE-2002-0433","Description":"List files in web server using \"*.ext\"","Link":"https://www.cve.org/CVERecord?id=CVE-2002-0433"},{"Reference":"CVE-2003-0332","Description":"Product modifies the first two letters of a filename extension after performing a security check, which allows remote attackers to bypass authentication via a filename with a .ats extension instead of a .hts extension.","Link":"https://www.cve.org/CVERecord?id=CVE-2003-0332"},{"Reference":"CVE-2002-0802","Description":"Database consumes an extra character when processing a character that cannot be converted, which could remove an escape character from the query and make the application subject to SQL injection attacks.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-0802"},{"Reference":"CVE-2000-0191","Description":"Overlaps \"fakechild/../realchild\"","Link":"https://www.cve.org/CVERecord?id=CVE-2000-0191"},{"Reference":"CVE-2004-2363","Description":"Product checks URI for \"\u003c\" and other literal characters, but does it before hex decoding the URI, so \"%3E\" and other sequences are allowed.","Link":"https://www.cve.org/CVERecord?id=CVE-2004-2363"}],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Validate-Before-Canonicalize"},{"TaxonomyName":"OWASP Top Ten 2004","EntryID":"A1","EntryName":"Unvalidated Input","MappingFit":"CWE More Specific"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"IDS01-J","EntryName":"Normalize strings before validating them","MappingFit":"Exact"},{"TaxonomyName":"SEI CERT Oracle Coding Standard for Java","EntryID":"IDS01-J","EntryName":"Normalize strings before validating them","MappingFit":"Exact"}],"RelatedAttackPatterns":["267","3","71","78","79","80"],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"Notes":[{"Type":"Relationship","Note":"This overlaps other categories."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Potential_Mitigations, Time_of_Introduction"},{"Type":"Modification","ModificationOrganization":"Veracode","ModificationDate":"2008-08-15","ModificationComment":"Suggested OWASP Top Ten 2004 mapping"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Relationships, Other_Notes, Taxonomy_Mappings, Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-10-14","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Other_Notes, Relationship_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Demonstrative_Examples, Observed_Examples, Related_Attack_Patterns, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-01-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Functional_Areas"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships, Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-06-25","ModificationComment":"updated Demonstrative_Examples, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-12-11","ModificationComment":"updated Observed_Examples, Relationships, Weakness_Ordinalities","ModificationVersion":"4.19","ModificationReleaseDate":"2025-12-11"},{"Type":"Rename","PreviousEntryName":"Validate-Before-Canonicalize","Date":"2008-04-11"}]}