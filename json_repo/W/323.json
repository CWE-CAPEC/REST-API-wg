{"ID":"323","Name":"Reusing a Nonce, Key Pair in Encryption","Abstraction":"Base","Structure":"Simple","Status":"Incomplete","Description":"Nonces should be used for the present occasion and only once.","LikelihoodOfExploit":"High","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"344","ViewID":"1000","Ordinal":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"BackgroundDetails":["Nonces are often bundled with a key in a communication exchange to produce a new session key for each exchange."],"ModesOfIntroduction":[{"Phase":"Architecture and Design","Note":"REALIZATION: This weakness is caused during implementation of an architectural security tactic."}],"CommonConsequences":[{"Scope":["Access Control"],"Impact":["Bypass Protection Mechanism","Gain Privileges or Assume Identity"],"Note":"Potentially a replay attack, in which an attacker could send the same data twice, could be crafted if nonces are allowed to be reused. This could allow a user to send a message which masquerades as a valid message from a valid user."}],"PotentialMitigations":[{"Phase":["Implementation"],"Description":"Refuse to reuse nonce values."},{"Phase":["Implementation"],"Description":"Use techniques such as requiring incrementing, time based and/or challenge response to assure uniqueness of nonces."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"This code takes a password, concatenates it with a nonce, then encrypts it before sending over a network:"},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tvoid encryptAndSendPassword(char *password){\n\t\tchar *nonce = \"bad\";\n\t\t...\n\t\tchar *data = (unsigned char*)malloc(20);\n\t\tint para_size = strlen(nonce) + strlen(password);\n\t\tchar *paragraph = (char*)malloc(para_size);\n\t\tSHA1((const unsigned char*)paragraph,parsize,(unsigned char*)data);\n\t\tsendEncryptedData(data)\n\t}\n```"},{"BodyText":"Because the nonce used is always the same, an attacker can impersonate a trusted party by intercepting and resending the encrypted password. This attack avoids the need to learn the unencrypted password."}]},{"Entries":[{"IntroText":"This code sends a command to a remote server, using an encrypted password and nonce to prove the command is from a trusted party:"},{"Nature":"Bad","Language":"C++","ExampleCode":"```\n\tString command = new String(\"some command to execute\");\n\tMessageDigest nonce = MessageDigest.getInstance(\"SHA\");\n\tnonce.update(String.valueOf(\"bad nonce\"));\n\tbyte[] nonce = nonce.digest();\n\tMessageDigest password = MessageDigest.getInstance(\"SHA\");\n\tpassword.update(nonce + \"secretPassword\");\n\tbyte[] digest = password.digest();\n\tsendCommand(digest, command)\n```"},{"BodyText":"Once again the nonce used is always the same. An attacker may be able to replay previous legitimate commands or execute new arbitrary commands."}]}],"TaxonomyMappings":[{"TaxonomyName":"CLASP","EntryName":"Reusing a nonce, key pair in encryption"}],"References":[{"ExternalReferenceID":"REF-18","Authors":["Secure Software, Inc."],"Title":"The CLASP Application Security Process","PublicationYear":"2005","URL":"https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"CLASP","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Background_Details, Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-10-30","ModificationComment":"updated Demonstrative_Examples, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Modes_of_Introduction, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated References"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships, Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"}]}