{"ID":"778","Name":"Insufficient Logging","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"When a security-critical event occurs, the product either does not record the event or omits important details about the event when logging it.","ExtendedDescription":"\n\nWhen security-critical events are not logged properly, such as a failed login attempt, this can make malicious behavior more difficult to detect and may hinder forensic analysis after an attack succeeds.\n\n\nAs organizations adopt cloud storage resources, these technologies often require configuration changes to enable detailed logging information, since detailed logging can incur additional costs. This could lead to telemetry gaps in critical audit logs. For example, in Azure, the default value for logging is disabled. \n","LikelihoodOfExploit":"Medium","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"223","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"693","ViewID":"1000"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Cloud Computing","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Operation","Note":"COMMISSION: This weakness refers to an incorrect design related to an architectural security tactic."}],"CommonConsequences":[{"Scope":["Non-Repudiation"],"Impact":["Hide Activities"],"Note":"If security critical information is not recorded, there will be no trail for forensic analysis and discovering the cause of problems or the source of attacks may become more difficult or impossible."}],"DetectionMethods":[{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"Use a centralized logging mechanism that supports multiple levels of detail."},{"Phase":["Implementation"],"Description":"Ensure that all security-related successes and failures can be logged. When storing data in the cloud (e.g., AWS S3 buckets, Azure blobs, Google Cloud Storage, etc.), use the provider's controls to enable and capture detailed logging information."},{"Phase":["Operation"],"Description":"Be sure to set the level of logging appropriately in a production environment. Sufficient data should be logged to enable system administrators to detect attacks, diagnose errors, and recover from attacks. At the same time, logging too much data (CWE-779) can cause the same problems, including unexpected costs when using a cloud environment."},{"Phase":["Operation"],"Description":"To enable storage logging using Azure's Portal, navigate to the name of the Storage Account, locate Monitoring (CLASSIC) section, and select Diagnostic settings (classic). For each of the various properties (blob, file, table, queue), ensure the status is properly set for the desired logging data. If using PowerShell, the Set-AzStorageServiceLoggingProperty command could be called using appropriate -ServiceType, -LoggingOperations, and -RetentionDays arguments."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"The example below shows a configuration for the service security audit feature in the Windows Communication Foundation (WCF)."},{"Nature":"Bad","Language":"XML","ExampleCode":"```\n\t\u003csystem.serviceModel\u003e\n\t\t\u003cbehaviors\u003e\n\t\t\t\u003cserviceBehaviors\u003e\n\t\t\t\t\u003cbehavior name=\"NewBehavior\"\u003e\n\t\t\t\t\t\u003cserviceSecurityAudit auditLogLocation=\"Default\"\n\t\t\t\t\tsuppressAuditFailure=\"false\"\n\t\t\t\t\tserviceAuthorizationAuditLevel=\"None\"\n\t\t\t\t\tmessageAuthenticationAuditLevel=\"None\" /\u003e\n\t\t\t\t...\n\t\u003c/system.serviceModel\u003e\n```"},{"BodyText":"The previous configuration file has effectively disabled the recording of security-critical events, which would force the administrator to look to other sources during debug or recovery efforts."},{"BodyText":"Logging failed authentication attempts can warn administrators of potential brute force attacks. Similarly, logging successful authentication events can provide a useful audit trail when a legitimate account is compromised. The following configuration shows appropriate settings, assuming that the site does not have excessive traffic, which could fill the logs if there are a large number of success or failure events (CWE-779)."},{"Nature":"Good","Language":"XML","ExampleCode":"```\n\t\u003csystem.serviceModel\u003e\n\t\t\u003cbehaviors\u003e\n\t\t\t\u003cserviceBehaviors\u003e\n\t\t\t\t\u003cbehavior name=\"NewBehavior\"\u003e\n\t\t\t\t\t\u003cserviceSecurityAudit auditLogLocation=\"Default\"\n\t\t\t\t\tsuppressAuditFailure=\"false\"\n\t\t\t\t\tserviceAuthorizationAuditLevel=\"SuccessAndFailure\"\n\t\t\t\t\tmessageAuthenticationAuditLevel=\"SuccessAndFailure\" /\u003e\n\t\t\t\t ...\n\t\u003c/system.serviceModel\u003e\n```"}]},{"Entries":[{"IntroText":"In the following Java example the code attempts to authenticate the user. If the login fails a retry is made. Proper restrictions on the number of login attempts are of course part of the retry functionality. Unfortunately, the failed login is not recorded and there would be no record of an adversary attempting to brute force the program."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tif LoginUser(){ \n\t\t// Login successful\n\t\t RunProgram();\n\t } else { \n\t\t// Login unsuccessful\n\t\t LoginRetry();\n\t }\n```"},{"BodyText":"It is recommended to log the failed login action. Note that unneutralized usernames should not be part of the log message, and passwords should never be part of the log message."},{"Nature":"Good","Language":"Java","ExampleCode":"```\n\tif LoginUser(){ \n\t\t// Login successful\n\t\t log.warn(\"Login by user successful.\");\n\t\t RunProgram();\n\t } else { \n\t\t // Login unsuccessful\n\t\t log.warn(\"Login attempt by user failed, trying again.\");\n\t\t LoginRetry();\n\t }\n```"}]},{"Entries":[{"IntroText":"Consider this command for updating Azure's Storage Logging for Blob service, adapted from [REF-1307]:"},{"Nature":"Bad","Language":"Shell","ExampleCode":"```\n\taz storage logging update --account-name --account-key --services b --log d --retention 90\n```"},{"BodyText":"The \"--log d\" portion of the command says to log deletes. However, the argument does not include the logging of writes and reads. Adding the \"rw\" arguments to the -log parameter will fix the issue:"},{"Nature":"Good","Language":"Shell","ExampleCode":"```\n\taz storage logging update --account-name --account-key --services b --log rwd --retention 90\n```"},{"BodyText":"To enable Azure's storage analytic logs programmatically using PowerShell:"},{"Nature":"Good","Language":"Shell","ExampleCode":"```\n\tSet-AzStorageServiceLoggingProperty -ServiceType Queue -LoggingOperations read,write,delete -RetentionDays 5 -Context $MyContextObject\n```"},{"BodyText":"Notice that here, the retention has been limited to 5 days."}]}],"ObservedExamples":[{"Reference":"CVE-2008-4315","Description":"server does not log failed authentication attempts, making it easier for attackers to perform brute force password guessing without being detected","Link":"https://www.cve.org/CVERecord?id=CVE-2008-4315"},{"Reference":"CVE-2008-1203","Description":"admin interface does not log failed authentication attempts, making it easier for attackers to perform brute force password guessing without being detected","Link":"https://www.cve.org/CVERecord?id=CVE-2008-1203"},{"Reference":"CVE-2007-3730","Description":"default configuration for POP server does not log source IP or username for login attempts","Link":"https://www.cve.org/CVERecord?id=CVE-2007-3730"},{"Reference":"CVE-2007-1225","Description":"proxy does not log requests without \"http://\" in the URL, allowing web surfers to access restricted web content without detection","Link":"https://www.cve.org/CVERecord?id=CVE-2007-1225"},{"Reference":"CVE-2003-1566","Description":"web server does not log requests for a non-standard request type","Link":"https://www.cve.org/CVERecord?id=CVE-2003-1566"}],"References":[{"ExternalReferenceID":"REF-62","Section":"Chapter 2, \"Accountability\", Page 40","Authors":["Mark Dowd","John McDonald","Justin Schuh"],"Title":"The Art of Software Security Assessment","Edition":"1st Edition","PublicationYear":"2006","Publisher":"Addison Wesley"},{"ExternalReferenceID":"REF-1307","Section":"Sections 3.5, 3.13, and 3.14","Authors":["Center for Internet Security"],"Title":"CIS Microsoft Azure Foundations Benchmark version 1.5.0","PublicationYear":"2022","PublicationMonth":"08","PublicationDay":"16","URL":"https://www.cisecurity.org/benchmark/azure","URLDate":"2023-01-19"},{"ExternalReferenceID":"REF-1308","Authors":["Microsoft"],"Title":"Enable and manage Azure Storage Analytics logs (classic)","PublicationYear":"2023","PublicationMonth":"01","PublicationDay":"23","URL":"https://learn.microsoft.com/en-us/azure/storage/common/manage-storage-analytics-logs","URLDate":"2023-01-24"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"CWE Content Team","SubmissionOrganization":"MITRE","SubmissionDate":"2009-07-02","SubmissionVersion":"1.5","SubmissionReleaseDate":"2009-07-27"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated References"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Modes_of_Introduction, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2018-03-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Demonstrative_Examples, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Applicable_Platforms, Demonstrative_Examples, Description, Potential_Mitigations, References"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Contribution","ContributionOrganization":"Fortify Software","ContributionDate":"2009-07-02","ContributionComment":"Provided code example and additional information for description and consequences.","ContributionType":"Content"},{"Type":"Contribution","ContributionName":"Drew Buttner","ContributionDate":"2022-08-15","ContributionComment":"Suggested a new demonstrative example and changes to the mitigations.","ContributionType":"Content"}]}