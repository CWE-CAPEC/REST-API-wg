{"ID":"1311","Name":"Improper Translation of Security Attributes by Fabric Bridge","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"The bridge incorrectly translates security attributes from either trusted to untrusted or from untrusted to trusted when converting from one fabric protocol to another.","ExtendedDescription":"\n\nA bridge allows IP blocks supporting different fabric protocols to be integrated into the system. Fabric end-points or interfaces usually have dedicated signals to transport security attributes. For example, HPROT signals in AHB, AxPROT signals in AXI, and MReqInfo and SRespInfo signals in OCP.\n\n\nThe values on these signals are used to indicate the security attributes of the transaction. These include the immutable hardware identity of the controller initiating the transaction, privilege level, and type of transaction (e.g., read/write, cacheable/non-cacheable, posted/non-posted).\n\n\nA weakness can arise if the bridge IP block, which translates the signals from the protocol used in the IP block endpoint to the protocol used by the central bus, does not properly translate the security attributes. As a result, the identity of the initiator could be translated from untrusted to trusted or vice-versa. This could result in access-control bypass, privilege escalation, or denial of service.\n","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"284","ViewID":"1000","Ordinal":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Name":"Verilog","Prevalence":"Undetermined"},{"Type":"Language","Name":"VHDL","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Not Technology-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Architecture and Design"},{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Confidentiality","Integrity","Access Control"],"Impact":["Modify Memory","Read Memory","Gain Privileges or Assume Identity","Bypass Protection Mechanism","Execute Unauthorized Code or Commands"]}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"The translation must map signals in such a way that untrusted agents cannot map to trusted agents or vice-versa."},{"Phase":["Implementation"],"Description":"Ensure that the translation maps signals in such a way that untrusted agents cannot map to trusted agents or vice-versa."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"The bridge interfaces between OCP and AHB end points. OCP uses MReqInfo signal to indicate security attributes, whereas AHB uses HPROT signal to indicate the security attributes. The width of MReqInfo can be customized as needed. In this example, MReqInfo is 5-bits wide and carries the privilege level of the OCP controller.\n\n\nThe values 5'h11, 5'h10, 5'h0F, 5'h0D, 5'h0C, 5'h0B, 5'h09, 5'h08, 5'h04, and 5'h02 in MReqInfo indicate that the request is coming from a privileged state of the OCP bus controller. Values 5'h1F, 5'h0E, and 5'h00 indicate untrusted, privilege state.\n\n\nThough HPROT is a 5-bit signal, we only consider the lower, two bits in this example. HPROT values 2'b00 and 2'b10 are considered trusted, and 2'b01 and 2'b11 are considered untrusted.\n\n\nThe OCP2AHB bridge is expected to translate trusted identities on the controller side to trusted identities on the responder side. Similarly, it is expected to translate untrusted identities on the controller side to untrusted identities on the responder side."},{"Nature":"Bad","Language":"Verilog","ExampleCode":"module ocp2ahb\n ( \n\n```\n\t ahb_hprot, \n\t ocp_mreqinfo \n ); \n output [1:0] ahb_hprot; // output is 2 bit signal for AHB HPROT\n input [4:0] ocp_mreqinfo; // input is 5 bit signal from OCP MReqInfo\n wire [6:0] p0_mreqinfo_o_temp; // OCP signal that transmits hardware identity of bus controller\n wire y;\n reg [1:0] ahb_hprot;\n // hardware identity of bus controller is in bits 5:1 of p0_mreqinfo_o_temp signal\n assign p0_mreqinfo_o_temp[6:0] = {1'b0, ocp_mreqinfo[4:0], y};\n always @*\n begin\n\t case (p0_mreqinfo_o_temp[4:2])\n\t\t 000: ahb_hprot = 2'b11; // OCP MReqInfo to AHB HPROT mapping\n\t\t 001: ahb_hprot = 2'b00;\n\t\t 010: ahb_hprot = 2'b00;\n\t\t 011: ahb_hprot = 2'b01;\n\t\t 100: ahb_hprot = 2'b00;\n\t\t 101: ahb_hprot = 2'b00;\n\t\t 110: ahb_hprot = 2'b10;\n\t\t 111: ahb_hprot = 2'b00;\n\t endcase\n end\n endmodule\n```"},{"BodyText":"Logic in the case statement only checks for MReqInfo bits 4:2, i.e., hardware-identity bits 3:1. When ocp_mreqinfo is 5'h1F or 5'h0E, p0_mreqinfo_o_temp[2] will be 1. As a result, untrusted IDs from OCP 5'h1F and 5'h0E get translated to trusted ahb_hprot values 2'b00."}]}],"RelatedAttackPatterns":["1","180","233"],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"Arun Kanuparthi, Hareesh Khattri, Parbati Manna","SubmissionOrganization":"Intel Corporation","SubmissionDate":"2020-05-24","SubmissionVersion":"4.3","SubmissionReleaseDate":"2020-12-10"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Contribution","ContributionName":"Hareesh Khattri","ContributionOrganization":"Intel Corporation","ContributionDate":"2022-04-28","ContributionComment":"Corrections in the demonstrative example.","ContributionType":"Feedback"}]}