{"ID":"74","Name":"Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')","Abstraction":"Class","Structure":"Simple","Status":"Incomplete","Description":"The product constructs all or part of a command, data structure, or record using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify how it is parsed or interpreted when it is sent to a downstream component.","ExtendedDescription":"Software or other automated logic has certain assumptions about what constitutes data and control respectively. It is the lack of verification of these assumptions for user-controlled input that leads to injection problems. Injection problems encompass a wide variety of issues -- all mitigated in very different ways and usually attempted in order to alter the control flow of the process. For this reason, the most effective way to discuss these weaknesses is to note the distinct features that classify them as injection weaknesses. The most important issue to note is that all injection problems share one thing in common -- i.e., they allow for the injection of control plane data into the user-controlled data plane. This means that the execution of the process may be altered by sending code in through legitimate data channels, using no other mechanism. While buffer overflows, and many other flaws, involve the use of some further issue to gain execution, injection problems need only for the data to be parsed.","LikelihoodOfExploit":"High","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"707","ViewID":"1000","Ordinal":"Primary"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation","Note":"REALIZATION: This weakness is caused during implementation of an architectural security tactic."}],"CommonConsequences":[{"Scope":["Confidentiality"],"Impact":["Read Application Data"],"Note":"Many injection attacks involve the disclosure of important information -- in terms of both data sensitivity and usefulness in further exploitation."},{"Scope":["Access Control"],"Impact":["Bypass Protection Mechanism"],"Note":"In some cases, injectable code controls authentication; this may lead to a remote vulnerability."},{"Scope":["Other"],"Impact":["Alter Execution Logic"],"Note":"Injection attacks are characterized by the ability to significantly change the flow of a given process, and in some cases, to the execution of arbitrary code."},{"Scope":["Integrity","Other"],"Impact":["Other"],"Note":"Data injection attacks lead to loss of data integrity in nearly all cases as the control-plane data injected is always incidental to data recall or writing."},{"Scope":["Non-Repudiation"],"Impact":["Hide Activities"],"Note":"Often the actions performed by injected control code are unlogged."}],"DetectionMethods":[{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Requirements"],"Description":"Programming languages and supporting technologies might be chosen which are not subject to these issues."},{"Phase":["Implementation"],"Description":"Utilize an appropriate mix of allowlist and denylist parsing to filter control-plane syntax from all input."}],"DemonstrativeExamples":[{"ID":"DX-151","Entries":[{"IntroText":"This example code intends to take the name of a user and list the contents of that user's home directory. It is subject to the first variant of OS command injection."},{"Nature":"Bad","Language":"PHP","ExampleCode":"```\n\t$userName = $_POST[\"user\"];\n\t$command = 'ls -l /home/' . $userName;\n\tsystem($command);\n```"},{"BodyText":"The $userName variable is not checked for malicious input. An attacker could set the $userName variable to an arbitrary OS command such as:"},{"Nature":"Attack","ExampleCode":"```\n\t;rm -rf /\n```"},{"BodyText":"Which would result in $command being:"},{"Nature":"Result","ExampleCode":"```\n\tls -l /home/;rm -rf /\n```"},{"BodyText":"Since the semi-colon is a command separator in Unix, the OS would first execute the ls command, then the rm command, deleting the entire file system."},{"BodyText":"Also note that this example code is vulnerable to Path Traversal (CWE-22) and Untrusted Search Path (CWE-426) attacks."}]},{"ID":"DX-150","Entries":[{"IntroText":"Consider the following program. It intends to perform an \"ls -l\" on an input filename. The validate_name() subroutine performs validation on the input to make sure that only alphanumeric and \"-\" characters are allowed, which avoids path traversal (CWE-22) and OS command injection (CWE-78) weaknesses. Only filenames like \"abc\" or \"d-e-f\" are intended to be allowed."},{"Nature":"Bad","Language":"Perl","ExampleCode":"```\n\t my $arg = GetArgument(\"filename\");\n\t do_listing($arg);\n\t sub do_listing {\n\t\t my($fname) = @_;\n\t\t if (! validate_name($fname)) {\n\t\t\t print \"Error: name is not well-formed!\\n\";\n\t\t\t return;\n\t\t }\n```\n# build command* \n\t\t my $cmd = \"/bin/ls -l $fname\";\n\t\t system($cmd);\n\t\t } \n\t\n\t sub validate_name {\n\t\n\t```\n\t\t my($name) = @_;\n\t\t if ($name =~ /^[\\w\\-]+$/) {\n\t\t\t return(1);\n\t\t }\n\t\t else {\n\t\t\t return(0);\n\t\t }\n\t } \n```"},{"BodyText":"However, validate_name() alows filenames that begin with a \"-\". An adversary could supply a filename like \"-aR\", producing the \"ls -l -aR\" command (CWE-88), thereby getting a full recursive listing of the entire directory and all of its sub-directories.\n\n\nThere are a couple possible mitigations for this weakness. One would be to refactor the code to avoid using system() altogether, instead relying on internal functions.\n\n\nAnother option could be to add a \"--\" argument to the ls command, such as \"ls -l --\", so that any remaining arguments are treated as filenames, causing any leading \"-\" to be treated as part of a filename instead of another option.\n\n\nAnother fix might be to change the regular expression used in validate_name to force the first character of the filename to be a letter or number, such as:"},{"Nature":"Good","Language":"Perl","ExampleCode":"```\n\t if ($name =~ /^\\w[\\w\\-]+$/) ... \n```"}]}],"ObservedExamples":[{"Reference":"CVE-2022-36069","Description":"Python-based dependency management tool avoids OS command injection when generating Git commands but allows injection of optional arguments with input beginning with a dash (CWE-88), potentially allowing for code execution.","Link":"https://www.cve.org/CVERecord?id=CVE-2022-36069"},{"Reference":"CVE-1999-0067","Description":"Canonical example of OS command injection. CGI program does not neutralize \"|\" metacharacter when invoking a phonebook program.","Link":"https://www.cve.org/CVERecord?id=CVE-1999-0067"},{"Reference":"CVE-2022-1509","Description":"injection of sed script syntax (\"sed injection\")","Link":"https://www.cve.org/CVERecord?id=CVE-2022-1509"},{"Reference":"CVE-2020-9054","Description":"Chain: improper input validation (CWE-20) in username parameter, leading to OS command injection (CWE-78), as exploited in the wild per CISA KEV.","Link":"https://www.cve.org/CVERecord?id=CVE-2020-9054"},{"Reference":"CVE-2021-44228","Description":"Product does not neutralize ${xyz} style expressions, allowing remote code execution. (log4shell vulnerability)","Link":"https://www.cve.org/CVERecord?id=CVE-2021-44228"}],"TaxonomyMappings":[{"TaxonomyName":"CLASP","EntryName":"Injection problem ('data' used as something else)"},{"TaxonomyName":"OWASP Top Ten 2004","EntryID":"A6","EntryName":"Injection Flaws","MappingFit":"CWE More Specific"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP24","EntryName":"Tainted input to command"}],"RelatedAttackPatterns":["10","101","105","108","120","13","135","14","24","250","267","273","28","3","34","42","43","45","46","47","51","52","53","6","64","67","7","71","72","76","78","79","8","80","83","84","9"],"References":[{"ExternalReferenceID":"REF-18","Authors":["Secure Software, Inc."],"Title":"The CLASP Application Security Process","PublicationYear":"2005","URL":"https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf"}],"MappingNotes":{"Usage":"Discouraged","Rationale":"CWE-74 is high-level and often misused when lower-level weaknesses are more appropriate.","Comments":"Examine the children and descendants of this entry to find a more precise mapping.","Reasons":["Frequent Misuse","Abstraction"]},"Notes":[{"Type":"Theoretical","Note":"Many people treat injection only as an input validation problem (CWE-20) because many people do not distinguish between the consequence/attack (injection) and the protection mechanism that prevents the attack from succeeding. However, input validation is only one potential protection mechanism (output encoding is another), and there is a chaining relationship between improper input validation and the improper enforcement of the structure of messages to other components. Other issues not directly related to input validation, such as race conditions, could similarly impact message structure."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"CLASP","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationOrganization":"Veracode","ModificationDate":"2008-08-15","ModificationComment":"Suggested OWASP Top Ten 2004 mapping"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Common_Consequences, Description, Relationships, Other_Notes, Relationship_Notes, Taxonomy_Mappings, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-01-12","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Name, Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-07-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-10-29","ModificationComment":"updated Description, Other_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-04-05","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-06-21","ModificationComment":"updated Description, Name"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-12-13","ModificationComment":"updated Common_Consequences, Relationship_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-10-30","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-02-18","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-06-23","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-01-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-05-03","ModificationComment":"updated Potential_Mitigations, Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Causal_Nature, Likelihood_of_Exploit, Modes_of_Introduction, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2018-03-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated References, Relationship_Notes, Relationships, Theoretical_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-06-25","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-04-28","ModificationComment":"updated Demonstrative_Examples, Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-06-28","ModificationComment":"updated Observed_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Observed_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2024-07-16","ModificationComment":"updated Observed_Examples","ModificationVersion":"4.15","ModificationReleaseDate":"2024-07-16"},{"Type":"Rename","PreviousEntryName":"Injection","Date":"2008-04-11"},{"Type":"Rename","PreviousEntryName":"Failure to Sanitize Data into a Different Plane (aka 'Injection')","Date":"2009-05-27"},{"Type":"Rename","PreviousEntryName":"Failure to Sanitize Data into a Different Plane ('Injection')","Date":"2010-06-21"}]}