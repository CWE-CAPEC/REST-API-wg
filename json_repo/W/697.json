{"ID":"697","Name":"Incorrect Comparison","Abstraction":"Pillar","Structure":"Simple","Status":"Incomplete","Diagram":"/data/images/CWE-697-Diagram.png","Description":"The product compares two entities in a security-relevant context, but the comparison is incorrect.","ExtendedDescription":"\n\nThis Pillar covers several possibilities:\n\n\n  - the comparison checks one factor incorrectly;\n\n  - the comparison should consider multiple factors, but it does not check at least one of those factors at all;\n\n  - the comparison checks the wrong factor.\n\n","WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Not Technology-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Other"],"Impact":["Varies by Context"],"Note":"When the comparison is incorrect, it may lead to resultant weaknesses."}],"DetectionMethods":[{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)"}],"DemonstrativeExamples":[{"ID":"DX-115","Entries":[{"IntroText":"Consider an application in which Truck objects are defined to be the same if they have the same make, the same model, and were manufactured in the same year."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tpublic class Truck {\n\t\t\tprivate String make;\n\t\t\tprivate String model;\n\t\t\tprivate int year;\n\t\t\tpublic boolean equals(Object o) {\n\t\t\t\t\tif (o == null) return false;\n\t\t\t\t\tif (o == this) return true;\n\t\t\t\t\tif (!(o instanceof Truck)) return false;\n\t\t\t\t\tTruck t = (Truck) o;\n\t\t\t\t\treturn (this.make.equals(t.getMake()) \u0026\u0026 this.model.equals(t.getModel()));\n\t\t\t}\n\t}\n```"},{"BodyText":"Here, the equals() method only checks the make and model of the Truck objects, but the year of manufacture is not included."}]},{"ID":"DX-116","Entries":[{"IntroText":"This example defines a fixed username and password. The AuthenticateUser() function is intended to accept a username and a password from an untrusted user, and check to ensure that it matches the username and password. If the username and password match, AuthenticateUser() is intended to indicate that authentication succeeded."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n```\n/* Ignore CWE-259 (hard-coded password) and CWE-309 (use of password system for authentication) for this example. */* \n\t\n\tchar *username = \"admin\";\n\tchar *pass = \"password\";\n\t\n\tint AuthenticateUser(char *inUser, char *inPass) {\n\t```\n\t\tif (strncmp(username, inUser, strlen(inUser))) {\n\t\t\tlogEvent(\"Auth failure of username using strlen of inUser\");\n\t\t\treturn(AUTH_FAIL);\n\t\t}\n\t\tif (! strncmp(pass, inPass, strlen(inPass))) {\n\t\t\tlogEvent(\"Auth success of password using strlen of inUser\");\n\t\t\treturn(AUTH_SUCCESS);\n\t\t}\n\t\telse {\n\t\t\tlogEvent(\"Auth fail of password using sizeof\");\n\t\t\treturn(AUTH_FAIL);\n\t\t}\n\t}\n\tint main (int argc, char **argv) {\n\t\t int authResult;\n\t\tif (argc \u003c 3) {\n\t\t\tExitError(\"Usage: Provide a username and password\");\n\t\t}\n\t\tauthResult = AuthenticateUser(argv[1], argv[2]);\n\t\tif (authResult == AUTH_SUCCESS) {\n\t\t\tDoAuthenticatedTask(argv[1]);\n\t\t}\n\t\telse {\n\t\t\tExitError(\"Authentication failed\");\n\t\t}\n\t}\n```"},{"BodyText":"In AuthenticateUser(), the strncmp() call uses the string length of an attacker-provided inPass parameter in order to determine how many characters to check in the password. So, if the attacker only provides a password of length 1, the check will only examine the first byte of the application's password before determining success."},{"BodyText":"As a result, this partial comparison leads to improper authentication (CWE-287)."},{"BodyText":"Any of these passwords would still cause authentication to succeed for the \"admin\" user:"},{"Nature":"Attack","ExampleCode":"```\n\tp\n\tpa\n\tpas\n\tpass\n```"},{"BodyText":"This significantly reduces the search space for an attacker, making brute force attacks more feasible."},{"BodyText":"The same problem also applies to the username, so values such as \"a\" and \"adm\" will succeed for the username."},{"BodyText":"While this demonstrative example may not seem realistic, see the Observed Examples for CVE entries that effectively reflect this same weakness."}]}],"ObservedExamples":[{"Reference":"CVE-2021-3116","Description":"Chain: Python-based HTTP Proxy server uses the wrong boolean operators (CWE-480) causing an incorrect comparison (CWE-697) that identifies an authN failure if all three conditions are met instead of only one, allowing bypass of the proxy authentication (CWE-1390)","Link":"https://www.cve.org/CVERecord?id=CVE-2021-3116"},{"Reference":"CVE-2020-15811","Description":"Chain: Proxy uses a substring search instead of parsing the Transfer-Encoding header (CWE-697), allowing request splitting (CWE-113) and cache poisoning","Link":"https://www.cve.org/CVERecord?id=CVE-2020-15811"},{"Reference":"CVE-2016-10003","Description":"Proxy performs incorrect comparison of request headers, leading to infoleak","Link":"https://www.cve.org/CVERecord?id=CVE-2016-10003"}],"RelatedAttackPatterns":["10","120","14","15","182","24","267","3","41","43","44","45","46","47","52","53","6","64","67","7","71","73","78","79","8","80","88","9","92"],"MappingNotes":{"Usage":"Discouraged","Rationale":"This CWE entry is extremely high-level, a Pillar. However, sometimes this weakness is forced to be used due to the lack of in-depth weakness research. See Research Gaps.","Comments":"Where feasible, consider children or descendants of this entry instead.","Reasons":["Abstraction"]},"Notes":[{"Type":"Research Gap","Note":"\n\nWeaknesses related to this Pillar appear to be under-studied, especially with respect to classification schemes. Input from academic and other communities could help identify and resolve gaps or organizational difficulties within CWE.\n"},{"Type":"Maintenance","Note":"This entry likely has some relationships with case sensitivity (CWE-178), but case sensitivity is a factor in other types of weaknesses besides comparison. Also, in cryptography, certain attacks are possible when certain comparison operations do not take place in constant time, causing a timing-related information leak (CWE-208)."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"CWE Content Team","SubmissionOrganization":"MITRE","SubmissionDate":"2008-09-09","SubmissionVersion":"1.0","SubmissionReleaseDate":"2008-09-09"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-11-24","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-09-13","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-05-03","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2018-03-27","ModificationComment":"updated Common_Consequences, Demonstrative_Examples, Description, Maintenance_Notes, Name, Observed_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-09-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Applicable_Platforms, Relationships, Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-06-25","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-04-28","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-06-28","ModificationComment":"updated Observed_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description, Observed_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes, Research_Gaps"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-12-11","ModificationComment":"updated Common_Consequences, Description, Detection_Factors, Diagram","ModificationVersion":"4.19","ModificationReleaseDate":"2025-12-11"},{"Type":"Rename","PreviousEntryName":"Insufficient Comparison","Date":"2018-03-27"}]}