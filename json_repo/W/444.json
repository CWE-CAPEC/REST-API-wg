{"ID":"444","Name":"Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling')","Abstraction":"Base","Structure":"Simple","Status":"Incomplete","Description":"The product acts as an intermediary HTTP agent\n         (such as a proxy or firewall) in the data flow between two\n         entities such as a client and server, but it does not\n         interpret malformed HTTP requests or responses in ways that\n         are consistent with how the messages will be processed by\n         those entities that are at the ultimate destination.","ExtendedDescription":"\n\nHTTP requests or responses (\"messages\") can be malformed or unexpected in ways that cause web servers or clients to interpret the messages in different ways than intermediary HTTP agents such as load balancers, reverse proxies, web caching proxies, application firewalls, etc. For example, an adversary may be able to add duplicate or different header fields that a client or server might interpret as one set of messages, whereas the intermediary might interpret the same sequence of bytes as a different set of messages. For example, discrepancies can arise in how to handle duplicate headers like two Transfer-encoding (TE) or two Content-length (CL), or the malicious HTTP message will have different headers for TE and CL.\n\n\nThe inconsistent parsing and interpretation of messages can allow the adversary to \"smuggle\" a message to the client/server without the intermediary being aware of it.\n\n\nThis weakness is usually the result of the usage of outdated or incompatible HTTP protocol versions in the HTTP agents.\n","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"436","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"436","ViewID":"1003","Ordinal":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Web Based","Prevalence":"Undetermined"}],"AlternateTerms":[{"Term":"HTTP Request Smuggling"},{"Term":"HTTP Response Smuggling"},{"Term":"HTTP Smuggling"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Integrity","Non-Repudiation","Access Control"],"Impact":["Unexpected State","Hide Activities","Bypass Protection Mechanism"],"Note":"An attacker could create HTTP messages to exploit a number of weaknesses including 1) the message can trick the web server to associate a URL with another URL's webpage and caching the contents of the webpage (web cache poisoning attack), 2) the message can be structured to bypass the firewall protection mechanisms and gain unauthorized access to a web application, and 3) the message can invoke a script or a page that returns client credentials (similar to a Cross Site Scripting attack)."}],"PotentialMitigations":[{"Phase":["Implementation"],"Description":"Use a web server that employs a strict HTTP parsing procedure, such as Apache [REF-433]."},{"Phase":["Implementation"],"Description":"Use only SSL communication."},{"Phase":["Implementation"],"Description":"Terminate the client session after each request."},{"Phase":["System Configuration"],"Description":"Turn all pages to non-cacheable."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"In the following example, a malformed HTTP request is sent to a website that includes a proxy server and a web server with the intent of poisoning the cache to associate one webpage with another malicious webpage."},{"Nature":"Attack","ExampleCode":"POST http://www.website.com/foobar.html HTTP/1.1\n Host: www.website.com\n Connection: Keep-Alive\n Content-Type: application/x-www-form-urlencoded\n Content-Length: 0\n Content-Length: 54\n\n GET /poison.html HTTP/1.1\n Host: www.website.com\n Bla: GET http://www.website.com/page_to_poison.html HTTP/1.1\n Host: www.website.com\n Connection: Keep-Alive"},{"BodyText":"When this request is sent to the proxy server, the proxy server parses the first four lines of the POST request and encounters the two \"Content-Length\" headers. The proxy server ignores the first header, so it assumes the request has a body of length 54 bytes. Therefore, it treats the data in the next three lines that contain exactly 54 bytes as the first request's body:"},{"Nature":"Result","ExampleCode":"GET /poison.html HTTP/1.1\n Host: www.website.com\n Bla:"},{"BodyText":"The proxy then parses the remaining bytes, which it treats as the client's second request:"},{"Nature":"Attack","ExampleCode":"GET http://www.website.com/page_to_poison.html HTTP/1.1\n Host: www.website.com\n Connection: Keep-Alive"},{"BodyText":"The original request is forwarded by the proxy server to the web server. Unlike the proxy, the web server uses the first \"Content-Length\" header and considers that the first POST request has no body."},{"Nature":"Attack","ExampleCode":"POST http://www.website.com/foobar.html HTTP/1.1\n Host: www.website.com\n Connection: Keep-Alive\n Content-Type: application/x-www-form-urlencoded\n Content-Length: 0\n\n *Content-Length: 54 (ignored by server)*"},{"BodyText":"Because the web server has assumed the original POST request was length 0, it parses the second request that follows, i.e. for GET /poison.html:"},{"Nature":"Attack","ExampleCode":"GET /poison.html HTTP/1.1\n Host: www.website.com\n Bla: GET http://www.website.com/page_to_poison.html HTTP/1.1\n Host: www.website.com\n Connection: Keep-Alive"},{"BodyText":"Note that the \"Bla:\" header is treated as a regular header, so it is not parsed as a separate GET request."},{"BodyText":"The requests the web server sees are \"POST /foobar.html\" and \"GET /poison.html\", so it sends back two responses with the contents of the \"foobar.html\" page and the \"poison.html\" page, respectively. The proxy matches these responses to the two requests it thinks were sent by the client - \"POST /foobar.html\" and \"GET /page_to_poison.html\". If the response is cacheable, the proxy caches the contents of \"poison.html\" under the URL \"page_to_poison.html\", and the cache is poisoned! Any client requesting \"page_to_poison.html\" from the proxy would receive the \"poison.html\" page."},{"BodyText":"When a website includes both a proxy server and a web server, some protection against this type of attack can be achieved by installing a web application firewall, or using a web server that includes a stricter HTTP parsing procedure or make all webpages non-cacheable."},{"BodyText":"Additionally, if a web application includes a Java servlet for processing requests, the servlet can check for multiple \"Content-Length\" headers and if they are found the servlet can return an error response thereby preventing the poison page to be cached, as shown below."},{"Nature":"Good","Language":"Java","ExampleCode":"```\n\tprotected void processRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { \n```\n// Set up response writer object* \n\t\t\t...\n\t\t\ttry { \n\t\t\t```\n```\n// check for multiple content length headers* \n\t\t\t\t\tEnumeration contentLengthHeaders = request.getHeaders(\"Content-Length\"); \n\t\t\t\t\tint count = 0; \n\t\t\t\t\twhile (contentLengthHeaders.hasMoreElements()) { \n\t\t\t\t\t```\n\t\t\t\t\t\tcount++; \n\t\t\t\t\t} \n\t\t\t\t\tif (count \u003e 1) { \n```\n// output error response* } \n\t\t\t\t\telse { \n\t\t\t\t\t```\n```\n// process request* } \n\t\t\t\t\t} catch (Exception ex) {...}}"}]},{"Entries":[{"IntroText":"In the following example, a malformed HTTP request is sent to a website that includes a web server with a firewall with the intent of bypassing the web server firewall to smuggle malicious code into the system."},{"Nature":"Attack","ExampleCode":"```\n\tPOST /page.asp HTTP/1.1\n\tHost: www.website.com\n\tConnection: Keep-Alive\n\tContent-Length: 49223\n\tzzz...zzz [\"z\" x 49152]\n\tPOST /page.asp HTTP/1.0\n\tConnection: Keep-Alive\n\tContent-Length: 30\n\tPOST /page.asp HTTP/1.0\n\tBla: POST /page.asp?cmd.exe HTTP/1.0\n\tConnection: Keep-Alive\n```"},{"BodyText":"When this request is sent to the web server, the first POST request has a content-length of 49,223 bytes, and the firewall treats the line with 49,152 copies of \"z\" and the lines with an additional lines with 71 bytes as its body (49,152+71=49,223). The firewall then continues to parse what it thinks is the second request starting with the line with the third POST request."},{"BodyText":"Note that there is no CRLF after the \"Bla: \" header so the POST in the line is parsed as the value of the \"Bla:\" header. Although the line contains the pattern identified with a worm (\"cmd.exe\"), it is not blocked, since it is considered part of a header value. Therefore, \"cmd.exe\" is smuggled through the firewall."},{"BodyText":"When the request is passed through the firewall the web server the first request is ignored because the web server does not find an expected \"Content-Type: application/x-www-form-urlencoded\" header, and starts parsing the second request."},{"BodyText":"This second request has a content-length of 30 bytes, which is exactly the length of the next two lines up to the space after the \"Bla:\" header. And unlike the firewall, the web server processes the final POST as a separate third request and the \"cmd.exe\" worm is smuggled through the firewall to the web server."},{"BodyText":"To avoid this attack a Web server firewall product must be used that is designed to prevent this type of attack."}]},{"Entries":[{"IntroText":"The interpretation of HTTP responses can be manipulated if response headers include a space between the header name and colon, or if HTTP 1.1 headers are sent through a proxy configured for HTTP 1.0, allowing for HTTP response smuggling. This can be exploited in web browsers and other applications when used in combination with various proxy servers. For instance, the HTTP response interpreted by the front-end/client HTTP agent/entity - in this case the web browser - can interpret a single response from an adversary-compromised web server as being two responses from two different web sites. In the Example below, notice the extra space after the Content-Length and Set-Cookie headers."},{"Nature":"Attack","ExampleCode":"HTTP/1.1 200 OK\n Date: Fri, 08 Aug 2016 08:12:31 GMT\n Server: Apache (Unix)\n Connection: Keep-Alive\n Content-Encoding: gzip\n Content-Type: text/html\n\n **Content-Length :**  2345\n Transfer-Encoding: chunked\n\n **Set-Cookie :**  token=\"Malicious Code\"\n\n \u003cHTML\u003e ... \"Malicious Code\""}]}],"ObservedExamples":[{"Reference":"CVE-2022-24766","Description":"SSL/TLS-capable proxy allows HTTP smuggling when used in tandem with HTTP/1.0 services, due to inconsistent interpretation and input sanitization of HTTP messages within the body of another message","Link":"https://www.cve.org/CVERecord?id=CVE-2022-24766"},{"Reference":"CVE-2021-37147","Description":"Chain: caching proxy server has improper input validation (CWE-20) of headers, allowing HTTP response smuggling (CWE-444) using an \"LF line ending\"","Link":"https://www.cve.org/CVERecord?id=CVE-2021-37147"},{"Reference":"CVE-2020-8287","Description":"Node.js platform allows request smuggling via two Transfer-Encoding headers","Link":"https://www.cve.org/CVERecord?id=CVE-2020-8287"},{"Reference":"CVE-2006-6276","Description":"Web servers allow request smuggling via inconsistent HTTP headers.","Link":"https://www.cve.org/CVERecord?id=CVE-2006-6276"},{"Reference":"CVE-2005-2088","Description":"HTTP server allows request smuggling with both a \"Transfer-Encoding: chunked\" header and a Content-Length header","Link":"https://www.cve.org/CVERecord?id=CVE-2005-2088"},{"Reference":"CVE-2005-2089","Description":"HTTP server allows request smuggling with both a \"Transfer-Encoding: chunked\" header and a Content-Length header","Link":"https://www.cve.org/CVERecord?id=CVE-2005-2089"}],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"HTTP Request Smuggling"},{"TaxonomyName":"WASC","EntryID":"26","EntryName":"HTTP Request Smuggling"},{"TaxonomyName":"WASC","EntryID":"27","EntryName":"HTTP Response Smuggling"}],"RelatedAttackPatterns":["273","33"],"References":[{"ExternalReferenceID":"REF-433","Authors":["Chaim Linhart","Amit Klein","Ronen Heled","Steve Orrin"],"Title":"HTTP Request Smuggling","URL":"https://www.cgisecurity.com/lib/HTTP-Request-Smuggling.pdf","URLDate":"2023-04-07"},{"ExternalReferenceID":"REF-1273","Authors":["Robert Auger"],"Title":"HTTP Response Smuggling","PublicationYear":"2011","PublicationMonth":"02","PublicationDay":"01","URL":"http://projects.webappsec.org/w/page/13246930/HTTP%20Response%20Smuggling"},{"ExternalReferenceID":"REF-1274","Authors":["Dzevad Alibegovic"],"Title":"HTTP Request Smuggling: Complete Guide to Attack Types and Prevention","PublicationYear":"2021","PublicationMonth":"08","PublicationDay":"23","URL":"https://brightsec.com/blog/http-request-smuggling-hrs/"},{"ExternalReferenceID":"REF-1275","Authors":["Busra Demir"],"Title":"A Pentester's Guide to HTTP Request Smuggling","PublicationYear":"2020","PublicationMonth":"10","PublicationDay":"15","URL":"https://www.cobalt.io/blog/a-pentesters-guide-to-http-request-smuggling"},{"ExternalReferenceID":"REF-1276","Authors":["Edi Kogan","Daniel Kerman"],"Title":"HTTP Desync Attacks in the Wild and How to Defend Against Them","PublicationYear":"2019","PublicationMonth":"10","PublicationDay":"29","URL":"https://www.imperva.com/blog/archive/http-desync-attacks-and-defence-methods/","URLDate":"2025-08-04"},{"ExternalReferenceID":"REF-1277","Authors":["James Kettle"],"Title":"HTTP Desync Attacks: Request Smuggling Reborn","PublicationYear":"2019","PublicationMonth":"08","PublicationDay":"07","URL":"https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn","URLDate":"2023-04-07"},{"ExternalReferenceID":"REF-1278","Authors":["PortSwigger"],"Title":"HTTP request smuggling","URL":"https://portswigger.net/web-security/request-smuggling","URLDate":"2023-04-07"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"Notes":[{"Type":"Theoretical","Note":"Request smuggling can be performed due to a multiple interpretation error, where the target is an intermediary or monitor, via a consistency manipulation (Transfer-Encoding and Content-Length headers)."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Potential_Mitigations, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Name, Relationships, Other_Notes, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Name, Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Common_Consequences, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-10-30","ModificationComment":"updated Demonstrative_Examples, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-06-23","ModificationComment":"updated Other_Notes, Potential_Mitigations, Theoretical_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Applicable_Platforms, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-04-28","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-06-28","ModificationComment":"Extended the abstraction of this entry to include both HTTP request and response smuggling."},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-06-28","ModificationComment":"updated Alternate_Terms, Common_Consequences, Demonstrative_Examples, Description, Name, Observed_Examples, References, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated References, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-09-09","ModificationComment":"updated References","ModificationVersion":"4.18","ModificationReleaseDate":"2025-09-09"},{"Type":"Rename","PreviousEntryName":"HTTP Request Smuggling","Date":"2008-04-11"},{"Type":"Rename","PreviousEntryName":"Interpretation Conflict in Web Traffic (aka 'HTTP Request Smuggling')","Date":"2008-09-09"},{"Type":"Rename","PreviousEntryName":"Inconsistent Interpretation of HTTP Requests (aka 'HTTP Request Smuggling')","Date":"2009-05-27"},{"Type":"Rename","PreviousEntryName":"Inconsistent Interpretation of HTTP Requests ('HTTP Request Smuggling')","Date":"2022-06-28"}]}