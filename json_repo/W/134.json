{"ID":"134","Name":"Use of Externally-Controlled Format String","Abstraction":"Base","Structure":"Simple","Status":"Draft","Diagram":"/data/images/CWE-134-Diagram.png","Description":"The product uses a function that accepts a format string as an argument, but the format string originates from an external source.","LikelihoodOfExploit":"High","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"668","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"668","ViewID":"1003","Ordinal":"Primary"},{"Nature":"CanPrecede","CweID":"123","ViewID":"1000"},{"Nature":"ChildOf","CweID":"20","ViewID":"700","Ordinal":"Primary"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Name":"C","Prevalence":"Often"},{"Type":"Language","Name":"C++","Prevalence":"Often"},{"Type":"Language","Name":"Perl","Prevalence":"Rarely"}],"ModesOfIntroduction":[{"Phase":"Implementation","Note":"The programmer rarely intends for a format string to be externally-controlled at all. This weakness is frequently introduced in code that constructs log messages, where a constant format string is omitted."},{"Phase":"Implementation","Note":"In cases such as localization and internationalization, the language-specific message repositories could be an avenue for exploitation, but the format string issue would be resultant, since attacker control of those repositories would also allow modification of message length, format, and content."}],"CommonConsequences":[{"Scope":["Confidentiality"],"Impact":["Read Memory"],"Note":"Format string problems allow for information disclosure which can severely simplify exploitation of the program."},{"Scope":["Integrity","Confidentiality","Availability"],"Impact":["Modify Memory","Execute Unauthorized Code or Commands"],"Note":"Format string problems can result in the execution of arbitrary code, buffer overflows, denial of service, or incorrect data representation."}],"DetectionMethods":[{"DetectionMethodID":"DM-1","Method":"Automated Static Analysis","Description":"This weakness can often be detected using automated static analysis tools. Many modern tools use data flow analysis or constraint-based techniques to minimize the number of false positives."},{"Method":"Black Box","Description":"Since format strings often occur in rarely-occurring erroneous conditions (e.g. for error message logging), they can be difficult to detect using black box methods. It is highly likely that many latent issues exist in executables that do not have associated source code (or equivalent source.","Effectiveness":"Limited"},{"Method":"Automated Static Analysis - Binary or Bytecode","Description":"\n\nAccording to SOAR [REF-1479], the following detection techniques may be useful:\n\n```\n\t\tHighly cost effective:\n```\n\n\t\tBytecode Weakness Analysis - including disassembler + source code weakness analysis\n\t\tBinary Weakness Analysis - including disassembler + source code weakness analysis\n\t```\n\t\tCost effective for partial coverage:\n```\n\n\t\tBinary / Bytecode simple extractor - strings, ELF readers, etc.","Effectiveness":"High"},{"Method":"Manual Static Analysis - Binary or Bytecode","Description":"\n\nAccording to SOAR [REF-1479], the following detection techniques may be useful:\n\n```\n\t\tCost effective for partial coverage:\n```\n\n\t\tBinary / Bytecode disassembler - then use manual analysis for vulnerabilities \u0026 anomalies","Effectiveness":"SOAR Partial"},{"Method":"Dynamic Analysis with Automated Results Interpretation","Description":"\n\nAccording to SOAR [REF-1479], the following detection techniques may be useful:\n\n```\n\t\tCost effective for partial coverage:\n```\n\n\t\tWeb Application Scanner\n\t\tWeb Services Scanner\n\t\tDatabase Scanners","Effectiveness":"SOAR Partial"},{"Method":"Dynamic Analysis with Manual Results Interpretation","Description":"\n\nAccording to SOAR [REF-1479], the following detection techniques may be useful:\n\n```\n\t\tCost effective for partial coverage:\n```\n\n\t\tFuzz Tester\n\t\tFramework-based Fuzzer","Effectiveness":"SOAR Partial"},{"Method":"Manual Static Analysis - Source Code","Description":"\n\nAccording to SOAR [REF-1479], the following detection techniques may be useful:\n\n```\n\t\tHighly cost effective:\n```\n\n\t\tManual Source Code Review (not inspections)\n\t```\n\t\tCost effective for partial coverage:\n```\n\n\t\tFocused Manual Spotcheck - Focused manual analysis of source","Effectiveness":"High"},{"Method":"Automated Static Analysis - Source Code","Description":"\n\nAccording to SOAR [REF-1479], the following detection techniques may be useful:\n\n```\n\t\tHighly cost effective:\n```\n\n\t\tSource code Weakness Analyzer\n\t\tContext-configured Source Code Weakness Analyzer\n\t```\n\t\tCost effective for partial coverage:\n```\n\n\t\tWarning Flags","Effectiveness":"High"},{"Method":"Architecture or Design Review","Description":"\n\nAccording to SOAR [REF-1479], the following detection techniques may be useful:\n\n```\n\t\tHighly cost effective:\n```\n\n\t\tFormal Methods / Correct-By-Construction\n\t```\n\t\tCost effective for partial coverage:\n```\n\n\t\tInspection (IEEE 1028 standard) (can apply to requirements, design, source code, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Requirements"],"Description":"Choose a language that is not subject to this flaw."},{"Phase":["Implementation"],"Description":"Ensure that all format string functions are passed a static string which cannot be controlled by the user, and that the proper number of arguments are always sent to that function as well. If at all possible, use functions that do not support the %n operator in format strings. [REF-116] [REF-117]"},{"Phase":["Build and Compilation"],"Description":"Run compilers and linkers with high warning levels, since they may detect incorrect usage."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"The following program prints a string provided as an argument."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\t#include \u003cstdio.h\u003e\n\tvoid printWrapper(char *string) {\n\t\t\tprintf(string);\n\t}\n\tint main(int argc, char **argv) {\n\t\t\tchar buf[5012];\n\t\t\tmemcpy(buf, argv[1], 5012);\n\t\t\tprintWrapper(argv[1]);\n\t\t\treturn (0);\n\t}\n```"},{"BodyText":"The example is exploitable, because of the call to printf() in the printWrapper() function. Note: The stack buffer was added to make exploitation more simple."}]},{"Entries":[{"IntroText":"The following code copies a command line argument into a buffer using snprintf()."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tint main(int argc, char **argv){\n\t\tchar buf[128];\n\t\t...\n\t\tsnprintf(buf,128,argv[1]);\n\t}\n```"},{"BodyText":"This code allows an attacker to view the contents of the stack and write to the stack using a command line argument containing a sequence of formatting directives. The attacker can read from the stack by providing more formatting directives, such as %x, than the function takes as arguments to be formatted. (In this example, the function takes no arguments to be formatted.) By using the %n formatting directive, the attacker can write to the stack, causing snprintf() to write the number of bytes output thus far to the specified argument (rather than reading a value from the argument, which is the intended behavior). A sophisticated version of this attack will use four staggered writes to completely control the value of a pointer on the stack."}]},{"Entries":[{"IntroText":"Certain implementations make more advanced attacks even easier by providing format directives that control the location in memory to read from or write to. An example of these directives is shown in the following code, written for glibc:"},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tprintf(\"%d %d %1$d %1$d\\n\", 5, 9);\n```"},{"BodyText":"This code produces the following output: 5 9 5 5 It is also possible to use half-writes (%hn) to accurately control arbitrary DWORDS in memory, which greatly reduces the complexity needed to execute an attack that would otherwise require four staggered writes, such as the one mentioned in a separate example."}]}],"ObservedExamples":[{"Reference":"CVE-2002-1825","Description":"format string in Perl program","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1825"},{"Reference":"CVE-2001-0717","Description":"format string in bad call to syslog function","Link":"https://www.cve.org/CVERecord?id=CVE-2001-0717"},{"Reference":"CVE-2002-0573","Description":"format string in bad call to syslog function","Link":"https://www.cve.org/CVERecord?id=CVE-2002-0573"},{"Reference":"CVE-2002-1788","Description":"format strings in NNTP server responses","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1788"},{"Reference":"CVE-2006-2480","Description":"Format string vulnerability exploited by triggering errors or warnings, as demonstrated via format string specifiers in a .bmp filename.","Link":"https://www.cve.org/CVERecord?id=CVE-2006-2480"},{"Reference":"CVE-2007-2027","Description":"Chain: untrusted search path enabling resultant format string by loading malicious internationalization messages","Link":"https://www.cve.org/CVERecord?id=CVE-2007-2027"}],"FunctionalAreas":["Logging","Error Handling","String Processing","Memory Management"],"AffectedResources":["Memory"],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Format string vulnerability"},{"TaxonomyName":"7 Pernicious Kingdoms","EntryName":"Format String"},{"TaxonomyName":"CLASP","EntryName":"Format string problem"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"FIO30-C","EntryName":"Exclude user input from format strings","MappingFit":"Exact"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"FIO47-C","EntryName":"Use valid format strings","MappingFit":"CWE More Specific"},{"TaxonomyName":"OWASP Top Ten 2004","EntryID":"A1","EntryName":"Unvalidated Input","MappingFit":"CWE More Specific"},{"TaxonomyName":"WASC","EntryID":"6","EntryName":"Format String"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"IDS06-J","EntryName":"Exclude user input from format strings"},{"TaxonomyName":"SEI CERT Perl Coding Standard","EntryID":"IDS30-PL","EntryName":"Exclude user input from format strings","MappingFit":"Exact"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP24","EntryName":"Tainted input to command"},{"TaxonomyName":"OMG ASCSM","EntryID":"ASCSM-CWE-134"}],"RelatedAttackPatterns":["135","67"],"References":[{"ExternalReferenceID":"REF-116","Authors":["Steve Christey"],"Title":"Format String Vulnerabilities in Perl Programs","URL":"https://seclists.org/fulldisclosure/2005/Dec/91","URLDate":"2023-04-07"},{"ExternalReferenceID":"REF-117","Authors":["Hal Burch","Robert C. Seacord"],"Title":"Programming Language Format String Vulnerabilities","URL":"https://drdobbs.com/security/programming-language-format-string-vulne/197002914","URLDate":"2023-04-07"},{"ExternalReferenceID":"REF-118","Authors":["Tim Newsham"],"Title":"Format String Attacks","PublicationYear":"2000","PublicationMonth":"09","PublicationDay":"09","Publisher":"Guardent","URL":"https://seclists.org/bugtraq/2000/Sep/214","URLDate":"2025-07-29"},{"ExternalReferenceID":"REF-7","Section":"Chapter 5, \"Format String Bugs\" Page 147","Authors":["Michael Howard","David LeBlanc"],"Title":"Writing Secure Code","Edition":"2nd Edition","PublicationYear":"2002","PublicationMonth":"12","PublicationDay":"04","Publisher":"Microsoft Press","URL":"https://www.microsoftpressstore.com/store/writing-secure-code-9780735617223"},{"ExternalReferenceID":"REF-44","Section":"\"Sin 6: Format String Problems.\" Page 109","Authors":["Michael Howard","David LeBlanc","John Viega"],"Title":"24 Deadly Sins of Software Security","Publication":"McGraw-Hill","PublicationYear":"2010"},{"ExternalReferenceID":"REF-62","Section":"Chapter 8, \"C Format Strings\", Page 422","Authors":["Mark Dowd","John McDonald","Justin Schuh"],"Title":"The Art of Software Security Assessment","Edition":"1st Edition","PublicationYear":"2006","Publisher":"Addison Wesley"},{"ExternalReferenceID":"REF-962","Section":"ASCSM-CWE-134","Authors":["Object Management Group (OMG)"],"Title":"Automated Source Code Security Measure (ASCSM)","PublicationYear":"2016","PublicationMonth":"01","URL":"http://www.omg.org/spec/ASCSM/1.0/"},{"ExternalReferenceID":"REF-1479","Authors":["Gregory Larsen","E. Kenneth Hong Fong","David A. Wheeler","Rama S. Moorthy"],"Title":"State-of-the-Art Resources (SOAR) for Software Vulnerability Detection, Test, and Evaluation","PublicationYear":"2014","PublicationMonth":"07","URL":"https://www.ida.org/-/media/feature/publications/s/st/stateoftheart-resources-soar-for-software-vulnerability-detection-test-and-evaluation/p-5061.ashx","URLDate":"2025-09-05"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"Notes":[{"Type":"Applicable Platform","Note":"\n\nThis weakness is possible in any programming language that support format strings.\n"},{"Type":"Other","Note":"\n\nIn some circumstances, such as internationalization, the set of format strings is externally controlled by design. If the source of these format strings is trusted (e.g. only contained in library files that are only modifiable by the system administrator), then the external control might not itself pose a vulnerability.\n\n\nWhile Format String vulnerabilities typically fall under the Buffer Overflow category, technically they are not overflowed buffers. The Format String vulnerability is fairly new (circa 1999) and stems from the fact that there is no realistic way for a function that takes a variable number of arguments to determine just how many arguments were passed in. The most common functions that take a variable number of arguments, including C-runtime functions, are the printf() family of calls. The Format String problem appears in a number of ways. A *printf() call without a format specifier is dangerous and can be exploited. For example, printf(input); is exploitable, while printf(y, input); is not exploitable in that context. The result of the first call, used incorrectly, allows for an attacker to be able to peek at stack memory since the input string will be used as the format specifier. The attacker can stuff the input string with format specifiers and begin reading stack values, since the remaining parameters will be pulled from the stack. Worst case, this improper use may give away enough control to allow an arbitrary value (or values in the case of an exploit program) to be written into the memory of the running program.\n\n\nFrequently targeted entities are file names, process names, identifiers.\n\n\nFormat string problems are a classic C/C++ issue that are now rare due to the ease of discovery. One main reason format string vulnerabilities can be exploited is due to the %n operator. The %n operator will write the number of characters, which have been printed by the format string therefore far, to the memory pointed to by its argument. Through skilled creation of a format string, a malicious user may use values on the stack to create a write-what-where condition. Once this is achieved, they can execute arbitrary code. Other operators can be used as well; for example, a %9999s operator could also trigger a buffer overflow, or when used in file-formatting functions like fprintf, it can generate a much larger output than intended.\n"},{"Type":"Research Gap","Note":"Format string issues are under-studied for languages other than C. Memory or disk consumption, control flow or variable alteration, and data corruption may result from format string exploitation in applications written in other languages such as Perl, PHP, Python, etc."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationOrganization":"KDM Analytics","ModificationDate":"2008-08-01","ModificationComment":"added/updated white box definitions"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Applicable_Platforms, Common_Consequences, Detection_Factors, Modes_of_Introduction, Relationships, Other_Notes, Research_Gaps, Taxonomy_Mappings, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-11-24","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"KDM Analytics","ModificationDate":"2009-07-17","ModificationComment":"Improved the White_Box_Definition"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-07-27","ModificationComment":"updated White_Box_Definitions"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Detection_Factors, References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-27","ModificationComment":"updated Modes_of_Introduction, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-09-13","ModificationComment":"updated Potential_Mitigations, References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Observed_Examples, References, Related_Attack_Patterns, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Demonstrative_Examples, Detection_Factors, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Description, Modes_of_Introduction, Name, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Causal_Nature, Functional_Areas, Likelihood_of_Exploit, Other_Notes, References, Relationships, Taxonomy_Mappings, White_Box_Definitions"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2018-03-27","ModificationComment":"updated References"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-09-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Detection_Factors, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-12-10","ModificationComment":"updated Common_Consequences, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-03-15","ModificationComment":"updated Potential_Mitigations, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-04-03","ModificationComment":"updated Common_Consequences, Demonstrative_Examples, Description, Diagram, Other_Notes","ModificationVersion":"4.17","ModificationReleaseDate":"2025-04-03"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-09-09","ModificationComment":"updated Detection_Factors, Functional_Areas, References","ModificationVersion":"4.18","ModificationReleaseDate":"2025-09-09"},{"Type":"Rename","PreviousEntryName":"Uncontrolled Format String","Date":"2015-12-07"}]}