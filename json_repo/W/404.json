{"ID":"404","Name":"Improper Resource Shutdown or Release","Abstraction":"Class","Structure":"Simple","Status":"Draft","Description":"The product does not release or incorrectly releases a resource before it is made available for re-use.","ExtendedDescription":"When a resource is created or allocated, the developer is responsible for properly releasing the resource as well as accounting for all potential paths of expiration or invalidation, such as a set period of time or revocation.","LikelihoodOfExploit":"Medium","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"664","ViewID":"1000","Ordinal":"Primary"},{"Nature":"PeerOf","CweID":"405","ViewID":"1000"},{"Nature":"CanPrecede","CweID":"619","ViewID":"1000"}],"WeaknessOrdinalities":[{"Ordinality":"Primary","Description":"Improper release or shutdown of resources can be primary to resource exhaustion, performance, and information confidentiality problems to name a few."},{"Ordinality":"Resultant","Description":"Improper release or shutdown of resources can be resultant from improper error handling or insufficient resource tracking."}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Availability","Other"],"Impact":["DoS: Resource Consumption (Other)","Varies by Context"],"Note":"Most unreleased resource issues result in general software reliability problems, but if an attacker can intentionally trigger a resource leak, the attacker might be able to launch a denial of service attack by depleting the resource pool."},{"Scope":["Confidentiality"],"Impact":["Read Application Data"],"Note":"When a resource containing sensitive information is not correctly shutdown, it may expose the sensitive data in a subsequent allocation."}],"DetectionMethods":[{"DetectionMethodID":"DM-2","Method":"Automated Dynamic Analysis","Description":"\n\nThis weakness can be detected using dynamic tools and techniques that interact with the software using large test suites with many diverse inputs, such as fuzz testing (fuzzing), robustness testing, and fault injection. The software's operation may slow down, but it should not become unstable, crash, or generate incorrect results.\n\n\nResource clean up errors might be detected with a stress-test by calling the software simultaneously from a large number of threads or processes, and look for evidence of any unexpected behavior. The software's operation may slow down, but it should not become unstable, crash, or generate incorrect results.\n","Effectiveness":"Moderate"},{"DetectionMethodID":"DM-12","Method":"Manual Dynamic Analysis","Description":"Identify error conditions that are not likely to occur during normal usage and trigger them. For example, run the product under low memory conditions, run with insufficient privileges or permissions, interrupt a transaction before it is completed, or disable connectivity to basic network services such as DNS. Monitor the software for any unexpected behavior. If you trigger an unhandled exception or similar error that was discovered and handled by the application's environment, it may still indicate unexpected conditions that were not handled by the application itself."},{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"MitigationID":"MIT-3","Phase":["Requirements"],"Strategy":"Language Selection","Description":"\n\nUse a language that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.\n\n\nFor example, languages such as Java, Ruby, and Lisp perform automatic garbage collection that releases memory for objects that have been deallocated.\n"},{"Phase":["Implementation"],"Description":"It is good practice to be responsible for freeing all resources you allocate and to be consistent with how and where you free memory in a function. If you allocate memory that you intend to free upon completion of the function, you must be sure to free the memory at all exit points for that function including error conditions."},{"Phase":["Implementation"],"Description":"Memory should be allocated/freed using matching functions such as malloc/free, new/delete, and new[]/delete[]."},{"Phase":["Implementation"],"Description":"When releasing a complex object or structure, ensure that you properly dispose of all of its member components, not just the object itself."}],"DemonstrativeExamples":[{"ID":"DX-81","Entries":[{"IntroText":"The following method never closes the new file handle. Given enough time, the Finalize() method for BufferReader should eventually call Close(), but there is no guarantee as to how long this action will take. In fact, there is no guarantee that Finalize() will ever be invoked. In a busy environment, the Operating System could use up all of the available file handles before the Close() function is called."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tprivate void processFile(string fName)\n\t{\n\t\tBufferReader fil = new BufferReader(new FileReader(fName));\n\t\tString line;\n\t\twhile ((line = fil.ReadLine()) != null)\n\t\t{\n\t\t\tprocessLine(line);\n\t\t}\n\t}\n```"},{"BodyText":"The good code example simply adds an explicit call to the Close() function when the system is done using the file. Within a simple example such as this the problem is easy to see and fix. In a real system, the problem may be considerably more obscure."},{"Nature":"Good","Language":"Java","ExampleCode":"```\n\tprivate void processFile(string fName)\n\t{\n\t\tBufferReader fil = new BufferReader(new FileReader(fName));\n\t\tString line;\n\t\twhile ((line = fil.ReadLine()) != null)\n\t\t{\n\t\t\tprocessLine(line);\n\t\t}\n\t\tfil.Close();\n\t}\n```"}]},{"ID":"DX-82","Entries":[{"IntroText":"This code attempts to open a connection to a database and catches any exceptions that may occur."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\ttry {\n\t\tConnection con = DriverManager.getConnection(some_connection_string);\n\t}\n\tcatch ( Exception e ) {\n\t\tlog( e );\n\t}\n```"},{"BodyText":"If an exception occurs after establishing the database connection and before the same connection closes, the pool of database connections may become exhausted. If the number of available connections is exceeded, other users cannot access this resource, effectively denying access to the application."}]},{"ID":"DX-83","Entries":[{"IntroText":"Under normal conditions the following C# code executes a database query, processes the results returned by the database, and closes the allocated SqlConnection object. But if an exception occurs while executing the SQL or processing the results, the SqlConnection object is not closed. If this happens often enough, the database will run out of available cursors and not be able to execute any more SQL queries."},{"Nature":"Bad","Language":"C#","ExampleCode":"```\n\t...\n\tSqlConnection conn = new SqlConnection(connString);\n\tSqlCommand cmd = new SqlCommand(queryString);\n\tcmd.Connection = conn;\n\tconn.Open();\n\tSqlDataReader rdr = cmd.ExecuteReader();\n\tHarvestResults(rdr);\n\tconn.Connection.Close();\n\t...\n```"}]},{"ID":"DX-84","Entries":[{"IntroText":"The following C function does not close the file handle it opens if an error occurs. If the process is long-lived, the process can run out of file handles."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tint decodeFile(char* fName) {\n\t\t\tchar buf[BUF_SZ];\n\t\t\tFILE* f = fopen(fName, \"r\");\n\t\t\tif (!f) {\n\t\t\t\tprintf(\"cannot open %s\\n\", fName);\n\t\t\t\treturn DECODE_FAIL;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t\twhile (fgets(buf, BUF_SZ, f)) {\n\t\t\t\t\t\tif (!checkChecksum(buf)) {\n\t\t\t\t\t\t\treturn DECODE_FAIL;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tdecodeBlock(buf);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tfclose(f);\n\t\t\treturn DECODE_SUCCESS;\n\t}\n```"}]},{"ID":"DX-85","Entries":[{"IntroText":"In this example, the program does not use matching functions such as malloc/free, new/delete, and new[]/delete[] to allocate/deallocate the resource."},{"Nature":"Bad","Language":"C++","ExampleCode":"```\n\tclass A {\n\t\tvoid foo();\n\t};\n\tvoid A::foo(){\n\t\tint *ptr;\n\t\tptr = (int*)malloc(sizeof(int));\n\t\tdelete ptr;\n\t}\n```"}]},{"ID":"DX-86","Entries":[{"IntroText":"In this example, the program calls the delete[] function on non-heap memory."},{"Nature":"Bad","Language":"C++","ExampleCode":"```\n\tclass A{\n\t\tvoid foo(bool);\n\t};\n\tvoid A::foo(bool heap) {\n\t\tint localArray[2] = {\n\t\t\t11,22\n\t\t};\n\t\tint *p = localArray;\n\t\tif (heap){\n\t\t\tp = new int[2];\n\t\t}\n\t\tdelete[] p;\n\t}\n```"}]}],"ObservedExamples":[{"Reference":"CVE-1999-1127","Description":"Does not shut down named pipe connections if malformed data is sent.","Link":"https://www.cve.org/CVERecord?id=CVE-1999-1127"},{"Reference":"CVE-2001-0830","Description":"Sockets not properly closed when attacker repeatedly connects and disconnects from server.","Link":"https://www.cve.org/CVERecord?id=CVE-2001-0830"},{"Reference":"CVE-2002-1372","Description":"Chain: Return values of file/socket operations are not checked (CWE-252), allowing resultant consumption of file descriptors (CWE-772).","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1372"}],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Improper resource shutdown or release"},{"TaxonomyName":"7 Pernicious Kingdoms","EntryName":"Unreleased Resource"},{"TaxonomyName":"OWASP Top Ten 2004","EntryID":"A9","EntryName":"Denial of Service","MappingFit":"CWE More Specific"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"FIO42-C","EntryName":"Close files when they are no longer needed","MappingFit":"CWE More Abstract"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MEM31-C","EntryName":"Free dynamically allocated memory when no longer needed","MappingFit":"CWE More Abstract"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"FIO04-J","EntryName":"Release resources when they are no longer needed"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP14","EntryName":"Failure to release resource"}],"RelatedAttackPatterns":["125","130","131","494","495","496","666"],"References":[{"ExternalReferenceID":"REF-44","Section":"\"Sin 8: C++ Catastrophes.\" Page 143","Authors":["Michael Howard","David LeBlanc","John Viega"],"Title":"24 Deadly Sins of Software Security","Publication":"McGraw-Hill","PublicationYear":"2010"}],"MappingNotes":{"Usage":"Allowed-with-Review","Rationale":"This CWE entry is a Class and might have Base-level children that would be more appropriate","Comments":"Examine children of this entry to see if there is a better fit","Reasons":["Abstraction"]},"Notes":[{"Type":"Relationship","Note":"Overlaps memory leaks, asymmetric resource consumption, malformed input errors."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationOrganization":"Veracode","ModificationDate":"2008-08-15","ModificationComment":"Suggested OWASP Top Ten 2004 mapping"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Description, Relationships, Other_Notes, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-10-14","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-11-24","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-01-12","ModificationComment":"updated Common_Consequences, Likelihood_of_Exploit, Other_Notes, Potential_Mitigations, Relationship_Notes, Relationships, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Description, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-07-27","ModificationComment":"updated Demonstrative_Examples, Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-10-29","ModificationComment":"updated Other_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Potential_Mitigations, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-06-21","ModificationComment":"updated Detection_Factors, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-12-13","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-27","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-09-13","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Demonstrative_Examples, References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-02-18","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-06-23","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-01-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-05-03","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Functional_Areas, Likelihood_of_Exploit, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships, Taxonomy_Mappings, Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-06-25","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-12-10","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-03-15","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-07-20","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description, Detection_Factors"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-10-26","ModificationComment":"updated Observed_Examples"}]}