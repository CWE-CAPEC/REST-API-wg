{"ID":"330","Name":"Use of Insufficiently Random Values","Abstraction":"Class","Structure":"Simple","Status":"Stable","Description":"The product uses insufficiently random numbers or values in a security context that depends on unpredictable numbers.","ExtendedDescription":"When product generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that will be generated, and use this guess to impersonate another user or access sensitive information.","LikelihoodOfExploit":"High","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"693","ViewID":"1000","Ordinal":"Primary"},{"Nature":"CanPrecede","CweID":"804","ViewID":"1000"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Not Technology-Specific","Prevalence":"Undetermined"}],"BackgroundDetails":["Computers are deterministic machines, and as such are unable to produce true randomness. Pseudo-Random Number Generators (PRNGs) approximate randomness algorithmically, starting with a seed from which subsequent values are calculated. There are two types of PRNGs: statistical and cryptographic. Statistical PRNGs provide useful statistical properties, but their output is highly predictable and forms an easy to reproduce numeric stream that is unsuitable for use in cases where security depends on generated values being unpredictable. Cryptographic PRNGs address this problem by generating output that is more difficult to predict. For a value to be cryptographically secure, it must be impossible or highly improbable for an attacker to distinguish between it and a truly random value."],"ModesOfIntroduction":[{"Phase":"Architecture and Design"},{"Phase":"Implementation","Note":"REALIZATION: This weakness is caused during implementation of an architectural security tactic."}],"CommonConsequences":[{"Scope":["Confidentiality","Other"],"Impact":["Other"],"Note":"When a protection mechanism relies on random values to restrict access to a sensitive resource, such as a session ID or a seed for generating a cryptographic key, then the resource being protected could be accessed by guessing the ID or key."},{"Scope":["Access Control","Other"],"Impact":["Bypass Protection Mechanism","Other"],"Note":"If product relies on unique, unguessable IDs to identify a resource, an attacker might be able to guess an ID for a resource that is owned by another user. The attacker could then read the resource, or pre-create a resource with the same ID to prevent the legitimate program from properly sending the resource to the intended user. For example, a product might maintain session information in a file whose name is based on a username. An attacker could pre-create this file for a victim user, then set the permissions so that the application cannot generate the session for the victim, preventing the victim from using the application."},{"Scope":["Access Control"],"Impact":["Bypass Protection Mechanism","Gain Privileges or Assume Identity"],"Note":"When an authorization or authentication mechanism relies on random values to restrict access to restricted functionality, such as a session ID or a seed for generating a cryptographic key, then an attacker may access the restricted functionality by guessing the ID or key."}],"DetectionMethods":[{"DetectionMethodID":"DM-11.4","Method":"Black Box","Description":"\n\nUse monitoring tools that examine the software's process as it interacts with the operating system and the network. This technique is useful in cases when source code is unavailable, if the software was not developed by you, or if you want to verify that the build phase did not introduce any new weaknesses. Examples include debuggers that directly attach to the running process; system-call tracing utilities such as truss (Solaris) and strace (Linux); system activity monitors such as FileMon, RegMon, Process Monitor, and other Sysinternals utilities (Windows); and sniffers and protocol analyzers that monitor network traffic.\n\n\nAttach the monitor to the process and look for library functions that indicate when randomness is being used. Run the process multiple times to see if the seed changes. Look for accesses of devices or equivalent resources that are commonly used for strong (or weak) randomness, such as /dev/urandom on Linux. Look for library or system calls that access predictable information such as process IDs and system time.\n"},{"Method":"Automated Static Analysis - Binary or Bytecode","Description":"\n\nAccording to SOAR, the following detection techniques may be useful:\n\n```\n\t\tCost effective for partial coverage:\n```\n\n\t\tBytecode Weakness Analysis - including disassembler + source code weakness analysis\n\t\tBinary Weakness Analysis - including disassembler + source code weakness analysis","Effectiveness":"SOAR Partial"},{"Method":"Manual Static Analysis - Binary or Bytecode","Description":"\n\nAccording to SOAR, the following detection techniques may be useful:\n\n```\n\t\tCost effective for partial coverage:\n```\n\n\t\tBinary / Bytecode disassembler - then use manual analysis for vulnerabilities \u0026 anomalies","Effectiveness":"SOAR Partial"},{"Method":"Dynamic Analysis with Manual Results Interpretation","Description":"\n\nAccording to SOAR, the following detection techniques may be useful:\n\n```\n\t\tCost effective for partial coverage:\n```\n\n\t\tMan-in-the-middle attack tool","Effectiveness":"SOAR Partial"},{"Method":"Manual Static Analysis - Source Code","Description":"\n\nAccording to SOAR, the following detection techniques may be useful:\n\n```\n\t\tHighly cost effective:\n```\n\n\t\tFocused Manual Spotcheck - Focused manual analysis of source\n\t\tManual Source Code Review (not inspections)","Effectiveness":"High"},{"Method":"Automated Static Analysis - Source Code","Description":"\n\nAccording to SOAR, the following detection techniques may be useful:\n\n```\n\t\tCost effective for partial coverage:\n```\n\n\t\tSource code Weakness Analyzer\n\t\tContext-configured Source Code Weakness Analyzer","Effectiveness":"SOAR Partial"},{"Method":"Architecture or Design Review","Description":"\n\nAccording to SOAR, the following detection techniques may be useful:\n\n```\n\t\tHighly cost effective:\n```\n\n\t\tInspection (IEEE 1028 standard) (can apply to requirements, design, source code, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"\n\nUse a well-vetted algorithm that is currently considered to be strong by experts in the field, and select well-tested implementations with adequate length seeds.\n\n\nIn general, if a pseudo-random number generator is not advertised as being cryptographically secure, then it is probably a statistical PRNG and should not be used in security-sensitive contexts.\n\n\nPseudo-random number generators can produce predictable numbers if the generator is known and the seed can be guessed. A 256-bit seed is a good starting point for producing a \"random enough\" number.\n"},{"Phase":["Implementation"],"Description":"Consider a PRNG that re-seeds itself as needed from high quality pseudo-random output sources, such as hardware devices."},{"Phase":["Testing"],"Description":"Use automated static analysis tools that target this type of weakness. Many modern techniques use data flow analysis to minimize the number of false positives. This is not a perfect solution, since 100% accuracy and coverage are not feasible."},{"MitigationID":"MIT-2","Phase":["Architecture and Design","Requirements"],"Strategy":"Libraries or Frameworks","Description":"Use products or modules that conform to FIPS 140-2 [REF-267] to avoid obvious entropy problems. Consult FIPS 140-2 Annex C (\"Approved Random Number Generators\")."},{"Phase":["Testing"],"Description":"Use tools and techniques that require manual (human) analysis, such as penetration testing, threat modeling, and interactive tools that allow the tester to record and modify an active session. These may be more effective than strictly automated techniques. This is especially the case with weaknesses that are related to design and business rules."}],"DemonstrativeExamples":[{"ID":"DX-45","Entries":[{"IntroText":"This code attempts to generate a unique random identifier for a user's session."},{"Nature":"Bad","Language":"PHP","ExampleCode":"```\n\tfunction generateSessionID($userID){\n\t\tsrand($userID);\n\t\treturn rand();\n\t}\n```"},{"BodyText":"Because the seed for the PRNG is always the user's ID, the session ID will always be the same. An attacker could thus predict any user's session ID and potentially hijack the session."},{"BodyText":"This example also exhibits a Small Seed Space (CWE-339)."}]},{"ID":"DX-46","Entries":[{"IntroText":"The following code uses a statistical PRNG to create a URL for a receipt that remains active for some period of time after a purchase."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tString GenerateReceiptURL(String baseUrl) {\n\t\tRandom ranGen = new Random();\n\t\tranGen.setSeed((new Date()).getTime());\n\t\treturn(baseUrl + ranGen.nextInt(400000000) + \".html\");\n\t}\n```"},{"BodyText":"This code uses the Random.nextInt() function to generate \"unique\" identifiers for the receipt pages it generates. Because Random.nextInt() is a statistical PRNG, it is easy for an attacker to guess the strings it generates. Although the underlying design of the receipt system is also faulty, it would be more secure if it used a random number generator that did not produce predictable receipt identifiers, such as a cryptographic PRNG."}]}],"ObservedExamples":[{"Reference":"CVE-2021-3692","Description":"PHP framework uses mt_rand() function (Marsenne Twister) when generating tokens","Link":"https://www.cve.org/CVERecord?id=CVE-2021-3692"},{"Reference":"CVE-2020-7010","Description":"Cloud application on Kubernetes generates passwords using a weak random number generator based on deployment time.","Link":"https://www.cve.org/CVERecord?id=CVE-2020-7010"},{"Reference":"CVE-2009-3278","Description":"Crypto product uses rand() library function to generate a recovery key, making it easier to conduct brute force attacks.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-3278"},{"Reference":"CVE-2009-3238","Description":"Random number generator can repeatedly generate the same value.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-3238"},{"Reference":"CVE-2009-2367","Description":"Web application generates predictable session IDs, allowing session hijacking.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-2367"},{"Reference":"CVE-2009-2158","Description":"Password recovery utility generates a relatively small number of random passwords, simplifying brute force attacks.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-2158"},{"Reference":"CVE-2009-0255","Description":"Cryptographic key created with a seed based on the system time.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-0255"},{"Reference":"CVE-2008-5162","Description":"Kernel function does not have a good entropy source just after boot.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-5162"},{"Reference":"CVE-2008-4905","Description":"Blogging software uses a hard-coded salt when calculating a password hash.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-4905"},{"Reference":"CVE-2008-4929","Description":"Bulletin board application uses insufficiently random names for uploaded files, allowing other users to access private files.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-4929"},{"Reference":"CVE-2008-3612","Description":"Handheld device uses predictable TCP sequence numbers, allowing spoofing or hijacking of TCP connections.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-3612"},{"Reference":"CVE-2008-2433","Description":"Web management console generates session IDs based on the login time, making it easier to conduct session hijacking.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-2433"},{"Reference":"CVE-2008-0166","Description":"SSL library uses a weak random number generator that only generates 65,536 unique keys.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-0166"},{"Reference":"CVE-2008-2108","Description":"Chain: insufficient precision causes extra zero bits to be assigned, reducing entropy for an API function that generates random numbers.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-2108"},{"Reference":"CVE-2008-2108","Description":"Chain: insufficient precision (CWE-1339) in random-number generator causes some zero bits to be reliably generated, reducing the amount of entropy (CWE-331)","Link":"https://www.cve.org/CVERecord?id=CVE-2008-2108"},{"Reference":"CVE-2008-2020","Description":"CAPTCHA implementation does not produce enough different images, allowing bypass using a database of all possible checksums.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-2020"},{"Reference":"CVE-2008-0087","Description":"DNS client uses predictable DNS transaction IDs, allowing DNS spoofing.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-0087"},{"Reference":"CVE-2008-0141","Description":"Application generates passwords that are based on the time of day.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-0141"}],"FunctionalAreas":["Cryptography","Authentication","Session Management"],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Randomness and Predictability"},{"TaxonomyName":"7 Pernicious Kingdoms","EntryName":"Insecure Randomness"},{"TaxonomyName":"OWASP Top Ten 2004","EntryID":"A2","EntryName":"Broken Access Control","MappingFit":"CWE More Specific"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"CON33-C","EntryName":"Avoid race conditions when using library functions","MappingFit":"Imprecise"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MSC30-C","EntryName":"Do not use the rand() function for generating pseudorandom numbers","MappingFit":"CWE More Abstract"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MSC32-C","EntryName":"Properly seed pseudorandom number generators","MappingFit":"CWE More Abstract"},{"TaxonomyName":"WASC","EntryID":"11","EntryName":"Brute Force"},{"TaxonomyName":"WASC","EntryID":"18","EntryName":"Credential/Session Prediction"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"MSC02-J","EntryName":"Generate strong random numbers"}],"RelatedAttackPatterns":["112","485","59"],"References":[{"ExternalReferenceID":"REF-267","Authors":["Information Technology Laboratory, National Institute of Standards and Technology"],"Title":"SECURITY REQUIREMENTS FOR CRYPTOGRAPHIC MODULES","PublicationYear":"2001","PublicationMonth":"05","PublicationDay":"25","URL":"https://csrc.nist.gov/csrc/media/publications/fips/140/2/final/documents/fips1402.pdf","URLDate":"2023-04-07"},{"ExternalReferenceID":"REF-207","Authors":["John Viega","Gary McGraw"],"Title":"Building Secure Software: How to Avoid Security Problems the Right Way","Edition":"1st Edition","PublicationYear":"2002","Publisher":"Addison-Wesley"},{"ExternalReferenceID":"REF-7","Section":"Chapter 8, \"Using Poor Random Numbers\" Page 259","Authors":["Michael Howard","David LeBlanc"],"Title":"Writing Secure Code","Edition":"2nd Edition","PublicationYear":"2002","PublicationMonth":"12","PublicationDay":"04","Publisher":"Microsoft Press","URL":"https://www.microsoftpressstore.com/store/writing-secure-code-9780735617223"},{"ExternalReferenceID":"REF-44","Section":"\"Sin 20: Weak Random Numbers.\" Page 299","Authors":["Michael Howard","David LeBlanc","John Viega"],"Title":"24 Deadly Sins of Software Security","Publication":"McGraw-Hill","PublicationYear":"2010"}],"MappingNotes":{"Usage":"Discouraged","Rationale":"This CWE entry is a level-1 Class (i.e., a child of a Pillar). It might have lower-level children that would be more appropriate","Comments":"Examine children of this entry to see if there is a better fit","Reasons":["Abstraction"]},"Notes":[{"Type":"Relationship","Note":"This can be primary to many other weaknesses such as cryptographic errors, authentication errors, symlink following, information leaks, and others."},{"Type":"Maintenance","Note":"As of CWE 4.3, CWE-330 and its descendants are being investigated by the CWE crypto team to identify gaps related to randomness and unpredictability, as well as the relationships between randomness and cryptographic primitives. This \"subtree analysis\" might result in the addition or deprecation of existing entries; the reorganization of relationships in some views, e.g. the research view (CWE-1000); more consistent use of terminology; and/or significant modifications to related entries."},{"Type":"Maintenance","Note":"As of CWE 4.5, terminology related to randomness, entropy, and predictability can vary widely. Within the developer and other communities, \"randomness\" is used heavily. However, within cryptography, \"entropy\" is distinct, typically implied as a measurement. There are no commonly-used definitions, even within standards documents and cryptography papers. Future versions of CWE will attempt to define these terms and, if necessary, distinguish between them in ways that are appropriate for different communities but do not reduce the usability of CWE for mapping, understanding, or other scenarios."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Background_Details, Relationships, Other_Notes, Relationship_Notes, Taxonomy_Mappings, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-11-24","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-01-12","ModificationComment":"updated Description, Likelihood_of_Exploit, Other_Notes, Potential_Mitigations, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Demonstrative_Examples, Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-12-28","ModificationComment":"updated Applicable_Platforms, Common_Consequences, Description, Observed_Examples, Potential_Mitigations, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-04-05","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-06-21","ModificationComment":"updated Detection_Factors, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-09-13","ModificationComment":"updated Potential_Mitigations, References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Demonstrative_Examples, Observed_Examples, References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-02-18","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-06-23","ModificationComment":"updated Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Detection_Factors"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Functional_Areas, Likelihood_of_Exploit, Modes_of_Introduction, References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2018-03-27","ModificationComment":"updated References"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Applicable_Platforms, Description, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-03-15","ModificationComment":"updated Maintenance_Notes, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-07-20","ModificationComment":"updated Demonstrative_Examples, Maintenance_Notes, Observed_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Observed_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Common_Consequences, Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-10-26","ModificationComment":"updated Observed_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2024-02-29","ModificationComment":"updated Mapping_Notes","ModificationVersion":"4.14","ModificationReleaseDate":"2024-02-29"},{"Type":"Rename","PreviousEntryName":"Randomness and Predictability","Date":"2008-04-11"}]}