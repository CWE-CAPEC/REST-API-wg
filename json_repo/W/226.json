{"ID":"226","Name":"Sensitive Information in Resource Not Removed Before Reuse","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"The product releases a resource such as memory or a file so that it can be made available for reuse, but it does not clear or \"zeroize\" the information contained in the resource before the product performs a critical state transition or makes the resource available for reuse by other entities.","ExtendedDescription":"\n\nWhen resources are released, they can be made available for reuse. For example, after memory is de-allocated, an operating system may make the memory available to another process, or disk space may be reallocated when a file is deleted. As removing information requires time and additional resources, operating systems do not usually clear the previously written information.\n\n\nEven when the resource is reused by the same process, this weakness can arise when new data is not as large as the old data, which leaves portions of the old data still available. Equivalent errors can occur in other situations where the length of data is variable but the associated data structure is not. If memory is not cleared after use, the information may be read by less trustworthy parties when the memory is reallocated.\n\n\nThis weakness can apply in hardware, such as when a device or system switches between power, sleep, or debug states during normal operation, or when execution changes to different users or privilege levels.\n","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"459","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"212","ViewID":"1000"},{"Nature":"CanPrecede","CweID":"201","ViewID":"1000"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Not Technology-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Confidentiality"],"Impact":["Read Application Data"]}],"DetectionMethods":[{"Method":"Manual Analysis","Description":"Write a known pattern into each sensitive location. Trigger the release of the resource or cause the desired state transition to occur. Read data back from the sensitive locations. If the reads are successful, and the data is the same as the pattern that was originally written, the test fails and the product needs to be fixed. Note that this test can likely be automated.","Effectiveness":"High"},{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Architecture and Design","Implementation"],"Description":"During critical state transitions, information not needed in the next state should be removed or overwritten with fixed patterns (such as all 0's) or random data, before the transition to the next state.","Effectiveness":"High"},{"Phase":["Architecture and Design","Implementation"],"Description":"When releasing, de-allocating, or deleting a resource, overwrite its data and relevant metadata with fixed patterns or random data. Be cautious about complex resource types whose underlying representation might be non-contiguous or change at a low level, such as how a file might be split into different chunks on a file system, even though \"logical\" file positions are contiguous at the application layer. Such resource types might require invocation of special modes or APIs to tell the underlying operating system to perform the necessary clearing, such as SDelete (Secure Delete) on Windows, although the appropriate functionality might not be available at the application layer.","Effectiveness":"High"}],"DemonstrativeExamples":[{"ID":"DX-147","Entries":[{"IntroText":"This example shows how an attacker can take advantage of an incorrect state transition."},{"BodyText":"Suppose a device is transitioning from state A to state B. During state A, it can read certain private keys from the hidden fuses that are only accessible in state A but not in state B. The device reads the keys, performs operations using those keys, then transitions to state B, where those private keys should no longer be accessible."},{"Nature":"Bad","Language":"Other","ExampleCode":"During the transition from A to B, the device does not scrub the memory."},{"BodyText":"After the transition to state B, even though the private keys are no longer accessible directly from the fuses in state B, they can be accessed indirectly by reading the memory that contains the private keys."},{"Nature":"Good","Language":"Other","ExampleCode":"For transition from state A to state B, remove information which should not be available once the transition is complete."}]},{"ID":"DX-148","Entries":[{"IntroText":"The following code calls realloc() on a buffer containing sensitive data:"},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tcleartext_buffer = get_secret();...\n\tcleartext_buffer = realloc(cleartext_buffer, 1024);\n\t...\n\tscrub_memory(cleartext_buffer, 1024);\n```"},{"BodyText":"There is an attempt to scrub the sensitive data from memory, but realloc() is used, so it could return a pointer to a different part of memory. The memory that was originally allocated for cleartext_buffer could still contain an uncleared copy of the data."}]},{"Entries":[{"IntroText":"The following example code is excerpted from the AES wrapper/interface, aes0_wrapper, module of one of the AES engines (AES0) in the Hack@DAC'21 buggy OpenPiton System-on-Chip (SoC). Note that this SoC contains three distinct AES engines. Within this wrapper module, four 32-bit registers are utilized to store the message intended for encryption, referred to as p_c[i]. Using the AXI Lite interface, these registers are filled with the 128-bit message to be encrypted."},{"Nature":"Bad","Language":"Verilog","ExampleCode":"module aes0_wrapper #(...)(...);\n ...\n always @(posedge clk_i)\n\n```\n\t begin\n\t\t if(~(rst_ni \u0026\u0026 ~rst_1)) //clear p_c[i] at reset\n\t\t\t begin\n\t\t\t\t start \u003c= 0;\n\t\t\t\t p_c[0] \u003c= 0;\n\t\t\t\t p_c[1] \u003c= 0;\n\t\t\t\t p_c[2] \u003c= 0;\n\t\t\t\t p_c[3] \u003c= 0;\n\t\t\t\t ...\n\t\t\t end\n\t\t else if(en \u0026\u0026 we)\n\t\t\t case(address[8:3])\n\t\t\t\t 0:\n\t\t\t\t\t start \u003c= reglk_ctrl_i[1] ? start : wdata[0];\n\t\t\t\t 1:\n```\np_c[3] \u003c= reglk_ctrl_i[3] ? p_c[3] : wdata[31:0];** \n\t\t\t\t\t 2:\n\t\t\t\t\n\t\t\t\t```\n```\np_c[2] \u003c= reglk_ctrl_i[3] ? p_c[2] : wdata[31:0];** \n\t\t\t\t\t 3:\n\t\t\t\t\n\t\t\t\t```\n```\np_c[1] \u003c= reglk_ctrl_i[3] ? p_c[1] : wdata[31:0];** \n\t\t\t\t\t 4:\n\t\t\t\t\n\t\t\t\t```\n```\np_c[0] \u003c= reglk_ctrl_i[3] ? p_c[0] : wdata[31:0];** \n\t\t\t\t\t ...\n\t\t\t\t endcase\n\t\t\t end // always @ (posedge wb_clk_i)\n\t\t endmodule"},{"BodyText":"The above code snippet [REF-1402] illustrates an instance of a vulnerable implementation of the AES wrapper module, where p_c[i] registers are cleared at reset. Otherwise, p_c[i]registers either maintain their old values (if reglk_ctrl_i[3]is true) or get filled through the AXI signal wdata. Note that p_c[i]registers can be read through the AXI Lite interface (not shown in snippet). However, p_c[i] registers are never cleared after their usage once the AES engine has completed the encryption process of the message. In a multi-user or multi-process environment, not clearing registers may result in the attacker process accessing data left by the victim, leading to data leakage or unintentional information disclosure.\n\n\nTo fix this issue, it is essential to ensure that these internal registers are cleared in a timely manner after their usage, i.e., the encryption process is complete. This is illustrated below by monitoring the assertion of the cipher text valid signal, ct_valid [REF-1403]."},{"Nature":"Good","Language":"Verilog","ExampleCode":"module aes0_wrapper #(...)(...);\n ...\n always @(posedge clk_i)\n\n```\n\t begin\n\t\t if(~(rst_ni \u0026\u0026 ~rst_1)) //clear p_c[i] at reset\n\t\t\t ...\n```\nelse if(ct_valid) //encryption process complete, clear p_c[i]** \n\t\t\n\t\t```\n```\nbegin** \n\t\t\t\n\t\t\t```\n```\np_c[0] \u003c= 0;** \n\t\t\t\t\n\t\t\t\t **p_c[1] \u003c= 0;** \n\t\t\t\t\n\t\t\t\t **p_c[2] \u003c= 0;** \n\t\t\t\t\n\t\t\t\t **p_c[3] \u003c= 0;** \n\t\t\t\t\n\t\t\t **end** \n\t\t\t else if(en \u0026\u0026 we)\n\t\t\n\t\t```\n\t\t\t case(address[8:3])\n\t\t\t ...\n\t\t\t endcase\n\t\t end // always @ (posedge wb_clk_i)\n\t endmodule\n```"}]}],"ObservedExamples":[{"Reference":"CVE-2019-3733","Description":"Cryptography library does not clear heap memory before release","Link":"https://www.cve.org/CVERecord?id=CVE-2019-3733"},{"Reference":"CVE-2003-0001","Description":"Ethernet NIC drivers do not pad frames with null bytes, leading to infoleak from malformed packets.","Link":"https://www.cve.org/CVERecord?id=CVE-2003-0001"},{"Reference":"CVE-2003-0291","Description":"router does not clear information from DHCP packets that have been previously used","Link":"https://www.cve.org/CVERecord?id=CVE-2003-0291"},{"Reference":"CVE-2005-1406","Description":"Products do not fully clear memory buffers when less data is stored into the buffer than previous.","Link":"https://www.cve.org/CVERecord?id=CVE-2005-1406"},{"Reference":"CVE-2005-1858","Description":"Products do not fully clear memory buffers when less data is stored into the buffer than previous.","Link":"https://www.cve.org/CVERecord?id=CVE-2005-1858"},{"Reference":"CVE-2005-3180","Description":"Products do not fully clear memory buffers when less data is stored into the buffer than previous.","Link":"https://www.cve.org/CVERecord?id=CVE-2005-3180"},{"Reference":"CVE-2005-3276","Description":"Product does not clear a data structure before writing to part of it, yielding information leak of previously used memory.","Link":"https://www.cve.org/CVERecord?id=CVE-2005-3276"},{"Reference":"CVE-2002-2077","Description":"Memory not properly cleared before reuse.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-2077"}],"FunctionalAreas":["Memory Management","Networking"],"AffectedResources":["Memory"],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Sensitive Information Uncleared Before Use"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MEM03-C","EntryName":"Clear sensitive information stored in reusable resources returned for reuse"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP23","EntryName":"Exposed Data"}],"RelatedAttackPatterns":["37"],"References":[{"ExternalReferenceID":"REF-1402","Title":"aes0_wrapper.sv","PublicationYear":"2021","URL":"https://github.com/HACK-EVENT/hackatdac21/blob/65d0ffdab7426da4509c98d62e163bcce642f651/piton/design/chip/tile/ariane/src/aes0/aes0_wrapper.sv#L84C2-L90C29","URLDate":"2024-02-14"},{"ExternalReferenceID":"REF-1403","Title":"Fix for aes0_wrapper","PublicationYear":"2023","PublicationMonth":"11","PublicationDay":"29","URL":"https://github.com/HACK-EVENT/hackatdac21/blob/0034dff6852365a8c4e36590a47ea8b088d725ae/piton/design/chip/tile/ariane/src/aes0/aes0_wrapper.sv#L96C1-L102C16","URLDate":"2024-02-14"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"Notes":[{"Type":"Relationship","Note":"There is a close association between CWE-226 and CWE-212. The difference is partially that of perspective. CWE-226 is geared towards the final stage of the resource lifecycle, in which the resource is deleted, eliminated, expired, or otherwise released for reuse. Technically, this involves a transfer to a different control sphere, in which the original contents of the resource are no longer relevant. CWE-212, however, is intended for sensitive data in resources that are intentionally shared with others, so they are still active. This distinction is useful from the perspective of the CWE research view (CWE-1000)."},{"Type":"Maintenance","Note":"This entry needs modification to clarify the differences with CWE-212. The description also combines two problems that are distinct from the CWE research perspective: the inadvertent transfer of information to another sphere, and improper initialization/shutdown. Some of the associated taxonomy mappings reflect these different uses."},{"Type":"Research Gap","Note":"This is frequently found for network packets, but it can also exist in local memory allocation, files, etc."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Relationships, Other_Notes, Relationship_Notes, Taxonomy_Mappings, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-10-14","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-11-24","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-10-29","ModificationComment":"updated Description, Other_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Applicable_Platforms, Maintenance_Notes, Relationship_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-09-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-12-13","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-09-13","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Causal_Nature, Functional_Areas, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Applicable_Platforms, Description, Name, Relationships, Time_of_Introduction, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Description, Name, Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Demonstrative_Examples, Description, Detection_Factors, Maintenance_Notes, Potential_Mitigations, Relationships, Research_Gaps"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2024-02-29","ModificationComment":"updated Demonstrative_Examples, Observed_Examples, References","ModificationVersion":"4.14","ModificationReleaseDate":"2024-02-29"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-04-03","ModificationComment":"updated Demonstrative_Examples","ModificationVersion":"4.17","ModificationReleaseDate":"2025-04-03"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-09-09","ModificationComment":"updated Relationships","ModificationVersion":"4.18","ModificationReleaseDate":"2025-09-09"},{"Type":"Contribution","ContributionName":"Rahul Kande, Chen Chen, Jeyavijayan Rajendran","ContributionOrganization":"Texas A\u0026M University","ContributionDate":"2023-11-29","ContributionComment":"suggested demonstrative example","ContributionType":"Content","ContributionVersion":"4.14","ContributionReleaseDate":"2024-02-29"},{"Type":"Contribution","ContributionName":"Mohamadreza Rostami, Shaza Zeitouni, Ahmad-Reza Sadeghi","ContributionOrganization":"Technical University of Darmstadt","ContributionDate":"2023-11-29","ContributionComment":"suggested demonstrative example","ContributionType":"Content","ContributionVersion":"4.14","ContributionReleaseDate":"2024-02-29"},{"Type":"Rename","PreviousEntryName":"Sensitive Information Uncleared Before Use","Date":"2008-04-11"},{"Type":"Rename","PreviousEntryName":"Sensitive Information Uncleared Before Release","Date":"2020-02-24"},{"Type":"Rename","PreviousEntryName":"Sensitive Information Uncleared in Resource Before Release for Reuse","Date":"2020-08-20"}]}