{"ID":"478","Name":"Missing Default Case in Multiple Condition Expression","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"The code does not have a default case in an expression with multiple conditions, such as a switch statement.","ExtendedDescription":"If a multiple-condition expression (such as a switch in C) omits the default case but does not consider or handle all possible values that could occur, then this might lead to complex logical errors and resultant weaknesses. Because of this, further decisions are made based on poor information, and cascading failure results. This cascading failure may result in any number of security issues, and constitutes a significant failure in the system.","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"1023","ViewID":"1000","Ordinal":"Primary"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Name":"C","Prevalence":"Undetermined"},{"Type":"Language","Name":"C++","Prevalence":"Undetermined"},{"Type":"Language","Name":"Java","Prevalence":"Undetermined"},{"Type":"Language","Name":"C#","Prevalence":"Undetermined"},{"Type":"Language","Name":"Python","Prevalence":"Undetermined"},{"Type":"Language","Name":"JavaScript","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Integrity"],"Impact":["Varies by Context","Alter Execution Logic"],"Note":"Depending on the logical circumstances involved, any consequences may result: e.g., issues of confidentiality, authentication, authorization, availability, integrity, accountability, or non-repudiation."}],"DetectionMethods":[{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Implementation"],"Description":"Ensure that there are no cases unaccounted for when adjusting program flow or values based on the value of a given variable. In the case of switch style statements, the very simple act of creating a default case can, if done correctly, mitigate this situation. Often however, the default case is used simply to represent an assumed option, as opposed to working as a check for invalid input. This is poor practice and in some cases is as bad as omitting a default case entirely."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"The following does not properly check the return code in the case where the security_check function returns a -1 value when an error occurs. If an attacker can supply data that will invoke an error, the attacker can bypass the security check:"},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\t#define FAILED 0\n\t#define PASSED 1\n\tint result;\n\t...\n\tresult = security_check(data);\n\tswitch (result) {\n\t\t\tcase FAILED:\n\t\t\t\tprintf(\"Security check failed!\\n\");\n\t\t\t\texit(-1);\n```\n//Break never reached because of exit()* \n\t\t\t\tbreak;\n\t\t\tcase PASSED:\n\t\t\t```\n\t\t\t\tprintf(\"Security check passed.\\n\");\n\t\t\t\tbreak;\n\t}\n```\n// program execution continues...* \n\t..."},{"BodyText":"Instead a default label should be used for unaccounted conditions:"},{"Nature":"Good","Language":"C","ExampleCode":"```\n\t#define FAILED 0\n\t#define PASSED 1\n\tint result;\n\t...\n\tresult = security_check(data);\n\tswitch (result) {\n\t\t\tcase FAILED:\n\t\t\t\tprintf(\"Security check failed!\\n\");\n\t\t\t\texit(-1);\n```\n//Break never reached because of exit()* \n\t\t\t\tbreak;\n\t\t\tcase PASSED:\n\t\t\t```\n\t\t\t\tprintf(\"Security check passed.\\n\");\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tprintf(\"Unknown error (%d), exiting...\\n\",result);\n\t\t\t\texit(-1);\n\t}\n```"},{"BodyText":"This label is used because the assumption cannot be made that all possible cases are accounted for. A good practice is to reserve the default case for error handling."}]},{"Entries":[{"IntroText":"In the following Java example the method getInterestRate retrieves the interest rate for the number of points for a mortgage. The number of points is provided within the input parameter and a switch statement will set the interest rate value to be returned based on the number of points."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tpublic static final String INTEREST_RATE_AT_ZERO_POINTS = \"5.00\";\n\tpublic static final String INTEREST_RATE_AT_ONE_POINTS = \"4.75\";\n\tpublic static final String INTEREST_RATE_AT_TWO_POINTS = \"4.50\";\n\t...\n\tpublic BigDecimal getInterestRate(int points) {\n\t\t\tBigDecimal result = new BigDecimal(INTEREST_RATE_AT_ZERO_POINTS);\n\t\t\tswitch (points) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tresult = new BigDecimal(INTEREST_RATE_AT_ZERO_POINTS);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tresult = new BigDecimal(INTEREST_RATE_AT_ONE_POINTS);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tresult = new BigDecimal(INTEREST_RATE_AT_TWO_POINTS);\n\t\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn result;\n\t}\n```"},{"BodyText":"However, this code assumes that the value of the points input parameter will always be 0, 1 or 2 and does not check for other incorrect values passed to the method. This can be easily accomplished by providing a default label in the switch statement that outputs an error message indicating an invalid value for the points input parameter and returning a null value."},{"Nature":"Good","Language":"Java","ExampleCode":"```\n\tpublic static final String INTEREST_RATE_AT_ZERO_POINTS = \"5.00\";\n\tpublic static final String INTEREST_RATE_AT_ONE_POINTS = \"4.75\";\n\tpublic static final String INTEREST_RATE_AT_TWO_POINTS = \"4.50\";\n\t...\n\tpublic BigDecimal getInterestRate(int points) {\n\t\t\tBigDecimal result = new BigDecimal(INTEREST_RATE_AT_ZERO_POINTS);\n\t\t\tswitch (points) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tresult = new BigDecimal(INTEREST_RATE_AT_ZERO_POINTS);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tresult = new BigDecimal(INTEREST_RATE_AT_ONE_POINTS);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tresult = new BigDecimal(INTEREST_RATE_AT_TWO_POINTS);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tSystem.err.println(\"Invalid value for points, must be 0, 1 or 2\");\n\t\t\t\t\t\tSystem.err.println(\"Returning null value for interest rate\");\n\t\t\t\t\t\tresult = null;\n\t\t\t}\n\t\t\treturn result;\n\t}\n```"}]},{"Entries":[{"IntroText":"In the following Python example the match-case statements (available in Python version 3.10 and later) perform actions based on the result of the process_data() function. The expected return is either 0 or 1. However, if an unexpected result (e.g., -1 or 2) is obtained then no actions will be taken potentially leading to an unexpected program state."},{"Nature":"Bad","Language":"Python","ExampleCode":"```\n\tresult = process_data(data) \n\tmatch result: \n\t\tcase 0: \n\t\t\tprint(\"Properly handle zero case.\")\n\t\tcase 1: \n\t\t\tprint(\"Properly handle one case.\")\n\t# program execution continues...\n```"},{"BodyText":"The recommended approach is to add a default case that captures any unexpected result conditions, regardless of how improbable these unexpected conditions might be, and properly handles them."},{"Nature":"Good","Language":"Python","ExampleCode":"```\n\tresult = process_data(data) \n\tmatch result: \n\t\tcase 0: \n\t\t\tprint(\"Properly handle zero case.\")\n\t\tcase 1: \n\t\t\tprint(\"Properly handle one case.\")\n\t\tcase _: \n\t\t\tprint(\"Properly handle unexpected condition.\")\n\t# program execution continues...\n```"}]},{"Entries":[{"IntroText":"In the following JavaScript example the switch-case statements (available in JavaScript version 1.2 and later) are used to process a given step based on the result of a calcuation involving two inputs. The expected return is either 1, 2, or 3. However, if an unexpected result (e.g., 4) is obtained then no action will be taken potentially leading to an unexpected program state."},{"Nature":"Bad","Language":"JavaScript","ExampleCode":"```\n\tlet step = input1 + input2; \n\tswitch(step) { \n\t\tcase 1: \n\t\t\talert(\"Process step 1.\"); \n\t\t\tbreak;\n\t\tcase 2: \n\t\t\talert(\"Process step 2.\"); \n\t\t\tbreak;\n\t\tcase 3: \n\t\t\talert(\"Process step 3.\"); \n\t\t\tbreak;\n\t} \n\t// program execution continues...\n```"},{"BodyText":"The recommended approach is to add a default case that captures any unexpected result conditions and properly handles them."},{"Nature":"Good","Language":"JavaScript","ExampleCode":"```\n\tlet step = input1 + input2; \n\tswitch(step) { \n\t\tcase 1: \n\t\t\talert(\"Process step 1.\"); \n\t\t\tbreak;\n\t\tcase 2: \n\t\t\talert(\"Process step 2.\"); \n\t\t\tbreak;\n\t\tcase 3: \n\t\t\talert(\"Process step 3.\"); \n\t\t\tbreak;\n\t\tdefault: \n\t\t\talert(\"Unexpected step encountered.\");\n\t} \n\t// program execution continues...\n```"}]},{"ID":"DX-152","Entries":[{"IntroText":"The Finite State Machine (FSM) shown in the \"bad\" code snippet below assigns the output (\"out\") based on the value of state, which is determined based on the user provided input (\"user_input\")."},{"Nature":"Bad","Language":"Verilog","ExampleCode":"```\n\tmodule fsm_1(out, user_input, clk, rst_n); \n\tinput [2:0] user_input; \n\tinput clk, rst_n; \n\toutput reg [2:0] out; \n\treg [1:0] state; \n\talways @ (posedge clk or negedge rst_n ) \n\t\tbegin \n\t\t\t if (!rst_n)\n\t\t\t\t state = 3'h0; \n\t\t\t else\n\t\t\t case (user_input) \n\t\t\t\t 3'h0:\n\t\t\t\t 3'h1:\n\t\t\t\t 3'h2:\n\t\t\t\t 3'h3: state = 2'h3;\n\t\t\t\t 3'h4: state = 2'h2;\n\t\t\t\t 3'h5: state = 2'h1;\n\t\t\t endcase \n\t\t end\n\t\t out \u003c= {1'h1, state};\n\t endmodule \n```"},{"BodyText":"The case statement does not include a default to handle the scenario when the user provides inputs of 3'h6 and 3'h7. Those inputs push the system to an undefined state and might cause a crash (denial of service) or any other unanticipated outcome.\n\n\nAdding a default statement to handle undefined inputs mitigates this issue. This is shown in the \"Good\" code snippet below. The default statement is in bold."},{"Nature":"Good","Language":"Verilog","ExampleCode":"```\n\tcase (user_input) \n\t\t3'h0: \n\t\t3'h1: \n\t\t3'h2: \n\t\t3'h3: state = 2'h3; \n\t\t3'h4: state = 2'h2; \n\t\t3'h5: state = 2'h1; \n```\ndefault: state = 2'h0;**  endcase"}]}],"TaxonomyMappings":[{"TaxonomyName":"CLASP","EntryName":"Failure to account for default case in switch"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP4","EntryName":"Unchecked Status Condition"}],"References":[{"ExternalReferenceID":"REF-18","Authors":["Secure Software, Inc."],"Title":"The CLASP Application Security Process","PublicationYear":"2005","URL":"https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf","URLDate":"2024-11-17"},{"ExternalReferenceID":"REF-62","Section":"Chapter 7, \"Switch Statements\", Page 337","Authors":["Mark Dowd","John McDonald","Justin Schuh"],"Title":"The Art of Software Security Assessment","Edition":"1st Edition","PublicationYear":"2006","Publisher":"Addison Wesley"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"CLASP","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Applicable_Platforms, Common_Consequences, Description, Relationships, Other_Notes, Taxonomy_Mappings, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Description, Name"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-06-21","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-27","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-06-23","ModificationComment":"updated Description, Other_Notes, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2018-03-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated References, Relationships, Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Applicable_Platforms, Demonstrative_Examples, Description, Name, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Contribution","ContributionName":"Drew Buttner","ContributionOrganization":"MITRE","ContributionDate":"2022-08-15","ContributionComment":"Suggested name change and other modifications, including a new demonstrative example.","ContributionType":"Content"},{"Type":"Rename","PreviousEntryName":"Failure to Account for Default Case in Switch","Date":"2008-04-11"},{"Type":"Rename","PreviousEntryName":"Failure to Use Default Case in Switch","Date":"2009-05-27"},{"Type":"Rename","PreviousEntryName":"Missing Default Case in Switch Statement","Date":"2022-10-13"}]}