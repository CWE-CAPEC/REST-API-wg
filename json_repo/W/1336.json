{"ID":"1336","Name":"Improper Neutralization of Special Elements Used in a Template Engine","Abstraction":"Base","Structure":"Simple","Status":"Incomplete","Description":"The product uses a template engine to insert or process externally-influenced input, but it does not neutralize or incorrectly neutralizes special elements or syntax that can be interpreted as template expressions or other code directives when processed by the engine.","ExtendedDescription":"\n\nMany web applications use template engines that allow developers to insert externally-influenced values into free text or messages in order to generate a full web page, document, message, etc. Such engines include Twig, Jinja2, Pug, Java Server Pages, FreeMarker, Velocity, ColdFusion, Smarty, and many others - including PHP itself. Some CMS (Content Management Systems) also use templates.\n\n\nTemplate engines often have their own custom command or expression language. If an attacker can influence input into a template before it is processed, then the attacker can invoke arbitrary expressions, i.e. perform injection attacks. For example, in some template languages, an attacker could inject the expression \"{{7*7}}\" and determine if the output returns \"49\" instead. The syntax varies depending on the language.\n\n\nIn some cases, XSS-style attacks can work, which can obscure the root cause if the developer does not closely investigate the root cause of the error.\n\n\nTemplate engines can be used on the server or client, so both \"sides\" could be affected by injection. The mechanisms of attack or the affected technologies might be different, but the mistake is fundamentally the same.\n","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"94","ViewID":"1000","Ordinal":"Primary"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Name":"Java","Prevalence":"Undetermined"},{"Type":"Language","Name":"PHP","Prevalence":"Undetermined"},{"Type":"Language","Name":"Python","Prevalence":"Undetermined"},{"Type":"Language","Name":"JavaScript","Prevalence":"Undetermined"},{"Type":"Language","Class":"Interpreted","Prevalence":"Undetermined"},{"Type":"Operating_System","Class":"Not OS-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Not Technology-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Name":"AI/ML","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Client Server","Prevalence":"Undetermined"}],"AlternateTerms":[{"Term":"Server-Side Template Injection / SSTI","Description":"This term is used for injection into template engines being used by a server."},{"Term":"Client-Side Template Injection / CSTI","Description":"This term is used for injection into template engines being used by a client."}],"ModesOfIntroduction":[{"Phase":"Architecture and Design","Note":"The developer might choose a template engine that makes it easier for programmers to write vulnerable code."},{"Phase":"Implementation","Note":"The programmer might not use engine's built-in sandboxes or other capabilities to escape or otherwise prevent template injection from untrusted input."}],"CommonConsequences":[{"Scope":["Integrity"],"Impact":["Execute Unauthorized Code or Commands"]}],"DetectionMethods":[{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"Choose a template engine that offers a sandbox or restricted mode, or at least limits the power of any available expressions, function calls, or commands."},{"Phase":["Implementation"],"Description":"Use the template engine's sandbox or restricted mode, if available."}],"ObservedExamples":[{"Reference":"CVE-2024-34359","Description":"Chain: Python bindings for LLM library do not use a sandboxed environment when parsing a template and constructing a prompt, allowing jinja2 Server Side Template Injection and code execution - one variant of a \"prompt injection\" attack.","Link":"https://www.cve.org/CVERecord?id=CVE-2024-34359"},{"Reference":"CVE-2017-16783","Description":"server-side template injection in content management server","Link":"https://www.cve.org/CVERecord?id=CVE-2017-16783"},{"Reference":"CVE-2020-9437","Description":"authentication / identity management product has client-side template injection","Link":"https://www.cve.org/CVERecord?id=CVE-2020-9437"},{"Reference":"CVE-2020-12790","Description":"Server-Side Template Injection using a Twig template","Link":"https://www.cve.org/CVERecord?id=CVE-2020-12790"},{"Reference":"CVE-2021-21244","Description":"devops platform allows SSTI","Link":"https://www.cve.org/CVERecord?id=CVE-2021-21244"},{"Reference":"CVE-2020-4027","Description":"bypass of Server-Side Template Injection protection mechanism with macros in Velocity templates","Link":"https://www.cve.org/CVERecord?id=CVE-2020-4027"},{"Reference":"CVE-2020-26282","Description":"web browser proxy server allows Java EL expressions from Server-Side Template Injection","Link":"https://www.cve.org/CVERecord?id=CVE-2020-26282"},{"Reference":"CVE-2020-1961","Description":"SSTI involving mail templates and JEXL expressions","Link":"https://www.cve.org/CVERecord?id=CVE-2020-1961"},{"Reference":"CVE-2019-19999","Description":"product does not use a \"safe\" setting for a FreeMarker configuration, allowing SSTI","Link":"https://www.cve.org/CVERecord?id=CVE-2019-19999"},{"Reference":"CVE-2018-20465","Description":"product allows read of sensitive database username/password variables using server-side template injection","Link":"https://www.cve.org/CVERecord?id=CVE-2018-20465"}],"References":[{"ExternalReferenceID":"REF-1193","Authors":["James Kettle"],"Title":"Server-Side Template Injection","PublicationYear":"2015","PublicationMonth":"08","PublicationDay":"05","URL":"https://portswigger.net/research/server-side-template-injection","URLDate":"2023-04-07"},{"ExternalReferenceID":"REF-1194","Authors":["James Kettle"],"Title":"Server-Side Template Injection: RCE For The Modern Web App","PublicationYear":"2015","PublicationMonth":"12","PublicationDay":"27","URL":"https://www.youtube.com/watch?v=3cT0uE7Y87s"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"Notes":[{"Type":"Relationship","Note":"Since expression languages are often used in templating languages, there may be some overlap with CWE-917 (Expression Language Injection). XSS (CWE-79) is also co-located with template injection."},{"Type":"Maintenance","Note":"The interrelationships and differences between CWE-917 and CWE-1336 need to be further clarified."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"CWE Content Team","SubmissionOrganization":"MITRE","SubmissionDate":"2021-07-19","SubmissionVersion":"4.5","SubmissionReleaseDate":"2021-07-20"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-06-28","ModificationComment":"updated Maintenance_Notes, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2024-07-16","ModificationComment":"updated Applicable_Platforms, Observed_Examples","ModificationVersion":"4.15","ModificationReleaseDate":"2024-07-16"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-12-11","ModificationComment":"updated Applicable_Platforms, Detection_Factors, Weakness_Ordinalities","ModificationVersion":"4.19","ModificationReleaseDate":"2025-12-11"}]}