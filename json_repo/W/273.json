{"ID":"273","Name":"Improper Check for Dropped Privileges","Abstraction":"Base","Structure":"Simple","Status":"Incomplete","Description":"The product attempts to drop privileges but does not check or incorrectly checks to see if the drop succeeded.","ExtendedDescription":"If the drop fails, the product will continue to run with the raised privileges, which might provide additional access to unprivileged users.","LikelihoodOfExploit":"Medium","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"754","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"754","ViewID":"1003","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"271","ViewID":"1000"},{"Nature":"PeerOf","CweID":"252","ViewID":"1000"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"BackgroundDetails":["In Windows based environments that have access control, impersonation is used so that access checks can be performed on a client identity by a server with higher privileges. By impersonating the client, the server is restricted to client-level security -- although in different threads it may have much higher privileges."],"ModesOfIntroduction":[{"Phase":"Implementation","Note":"\n\nREALIZATION: This weakness is caused during implementation of an architectural security tactic.\n\n\nThis issue is likely to occur in restrictive environments in which the operating system or application provides fine-grained control over privilege management.\n"}],"CommonConsequences":[{"Scope":["Access Control"],"Impact":["Gain Privileges or Assume Identity"],"Note":"If privileges are not dropped, neither are access rights of the user. Often these rights can be prevented from being dropped."},{"Scope":["Access Control","Non-Repudiation"],"Impact":["Gain Privileges or Assume Identity","Hide Activities"],"Note":"If privileges are not dropped, in some cases the system may record actions as the user which is being impersonated rather than the impersonator."}],"DetectionMethods":[{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"MitigationID":"MIT-46","Phase":["Architecture and Design"],"Strategy":"Separation of Privilege","Description":"\n\nCompartmentalize the system to have \"safe\" areas where trust boundaries can be unambiguously drawn. Do not allow sensitive data to go outside of the trust boundary and always be careful when interfacing with a compartment outside of the safe area.\n\n\nEnsure that appropriate compartmentalization is built into the system design, and the compartmentalization allows for and reinforces privilege separation functionality. Architects and designers should rely on the principle of least privilege to decide the appropriate time to use privileges and the time to drop privileges.\n"},{"MitigationID":"MIT-53","Phase":["Implementation"],"Description":"Check the results of all functions that return a value and verify that the value is expected.","Effectiveness":"High","EffectivenessNotes":"Checking the return value of the function will typically be sufficient, however beware of race conditions (CWE-362) in a concurrent environment."},{"Phase":["Implementation"],"Description":"In Windows, make sure that the process token has the SeImpersonatePrivilege(Microsoft Server 2003). Code that relies on impersonation for security must ensure that the impersonation succeeded, i.e., that a proper privilege demotion happened."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"This code attempts to take on the privileges of a user before creating a file, thus avoiding performing the action with unnecessarily high privileges:"},{"Nature":"Bad","Language":"C++","ExampleCode":"```\n\tbool DoSecureStuff(HANDLE hPipe) {\n\t\tbool fDataWritten = false;\n\t\tImpersonateNamedPipeClient(hPipe);\n\t\tHANDLE hFile = CreateFile(...);\n\t\t/../\n\t\tRevertToSelf()\n\t\t/../\n\t}\n```"},{"BodyText":"The call to ImpersonateNamedPipeClient may fail, but the return value is not checked. If the call fails, the code may execute with higher privileges than intended. In this case, an attacker could exploit this behavior to write a file to a location that the attacker does not have access to."}]}],"ObservedExamples":[{"Reference":"CVE-2006-4447","Description":"Program does not check return value when invoking functions to drop privileges, which could leave users with higher privileges than expected by forcing those functions to fail.","Link":"https://www.cve.org/CVERecord?id=CVE-2006-4447"},{"Reference":"CVE-2006-2916","Description":"Program does not check return value when invoking functions to drop privileges, which could leave users with higher privileges than expected by forcing those functions to fail.","Link":"https://www.cve.org/CVERecord?id=CVE-2006-2916"}],"AffectedResources":["System Process"],"TaxonomyMappings":[{"TaxonomyName":"CLASP","EntryName":"Failure to check whether privileges were dropped successfully"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"POS37-C","EntryName":"Ensure that privilege relinquishment is successful","MappingFit":"Exact"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP4","EntryName":"Unchecked Status Condition"}],"References":[{"ExternalReferenceID":"REF-18","Authors":["Secure Software, Inc."],"Title":"The CLASP Application Security Process","PublicationYear":"2005","URL":"https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf","URLDate":"2024-11-17"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"CLASP","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Common_Consequences, Description, Modes_of_Introduction, Relationships, Other_Notes, Taxonomy_Mappings, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-11-24","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Description, Name, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Name"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Observed_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-10-30","ModificationComment":"updated Demonstrative_Examples, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-06-23","ModificationComment":"updated Background_Details, Other_Notes, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Causal_Nature, Demonstrative_Examples, Modes_of_Introduction, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated References, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-12-10","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Rename","PreviousEntryName":"Failure to Check Whether Privileges Were Dropped Successfully","Date":"2009-03-10"},{"Type":"Rename","PreviousEntryName":"Improper Check for Successfully Dropped Privileges","Date":"2009-05-27"}]}