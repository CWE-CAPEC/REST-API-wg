{"ID":"616","Name":"Incomplete Identification of Uploaded File Variables (PHP)","Abstraction":"Variant","Structure":"Simple","Status":"Incomplete","Description":"The PHP application uses an old method for processing uploaded files by referencing the four global variables that are set for each file (e.g. $varname, $varname_size, $varname_name, $varname_type). These variables could be overwritten by attackers, causing the application to process unauthorized files.","ExtendedDescription":"These global variables could be overwritten by POST requests, cookies, or other methods of populating or overwriting these variables. This could be used to read or process arbitrary files by providing values such as \"/etc/passwd\".","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"345","ViewID":"1000","Ordinal":"Primary"},{"Nature":"PeerOf","CweID":"473","ViewID":"1000"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Name":"PHP","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Confidentiality","Integrity"],"Impact":["Read Files or Directories","Modify Files or Directories"]}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"Use PHP 4 or later."},{"Phase":["Architecture and Design"],"Description":"If you must support older PHP versions, write your own version of is_uploaded_file() and run it against $HTTP_POST_FILES['userfile']))"},{"Phase":["Implementation"],"Description":"For later PHP versions, reference uploaded files using the $HTTP_POST_FILES or $_FILES variables, and use is_uploaded_file() or move_uploaded_file() to ensure that you are dealing with an uploaded file."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"As of 2006, the \"four globals\" method is probably in sharp decline, but older PHP applications could have this issue."},{"BodyText":"In the \"four globals\" method, PHP sets the following 4 global variables (where \"varname\" is application-dependent):"},{"Nature":"Bad","Language":"PHP","ExampleCode":"```\n\t$varname = name of the temporary file on local machine\n\t$varname_size = size of file\n\t$varname_name = original name of file provided by client\n\t$varname_type = MIME type of the file\n```"}]},{"Entries":[{"IntroText":"\"The global $_FILES exists as of PHP 4.1.0 (Use $HTTP_POST_FILES instead if using an earlier version). These arrays will contain all the uploaded file information.\""},{"Nature":"Bad","Language":"PHP","ExampleCode":"```\n\t$_FILES['userfile']['name'] - original filename from client\n\t$_FILES['userfile']['tmp_name'] - the temp filename of the file on the server\n```"},{"BodyText":"** note: 'userfile' is the field name from the web form; this can vary."}]}],"ObservedExamples":[{"Reference":"CVE-2002-1460","Description":"Forum does not properly verify whether a file was uploaded or if the associated variables were set by POST, allowing remote attackers to read arbitrary files.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1460"},{"Reference":"CVE-2002-1759","Description":"Product doesn't check if the variables for an upload were set by uploading the file, or other methods such as $_POST.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1759"},{"Reference":"CVE-2002-1710","Description":"Product does not distinguish uploaded file from other files.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1710"}],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Incomplete Identification of Uploaded File Variables (PHP)"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP25","EntryName":"Tainted input to variable"}],"References":[{"ExternalReferenceID":"REF-502","Authors":["Shaun Clowes"],"Title":"A Study in Scarlet - section 5, \"File Upload\""}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2007-05-07","SubmissionVersion":"Draft 6","SubmissionReleaseDate":"2007-05-07"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Relationships, Observed_Example, Other_Notes, Taxonomy_Mappings, Weakness_Ordinalities"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-10-14","ModificationComment":"updated Description, Other_Notes, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Other_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Observed_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-10-30","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"}]}