{"ID":"405","Name":"Asymmetric Resource Consumption (Amplification)","Abstraction":"Class","Structure":"Simple","Status":"Incomplete","Description":"The product does not properly control situations in which an adversary can cause the product to consume or produce excessive resources without requiring the adversary to invest equivalent work or otherwise prove authorization, i.e., the adversary's influence is \"asymmetric.\"","ExtendedDescription":"This can lead to poor performance due to \"amplification\" of resource consumption, typically in a non-linear fashion. This situation is worsened if the product allows malicious users or attackers to consume more resources than their access level permits.","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"400","ViewID":"1000","Ordinal":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Operating_System","Class":"Not OS-Specific","Prevalence":"Undetermined"},{"Type":"Architecture","Class":"Not Architecture-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Not Technology-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"Client Server","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Architecture and Design"},{"Phase":"Implementation"},{"Phase":"Operation"}],"CommonConsequences":[{"Scope":["Availability"],"Impact":["DoS: Amplification","DoS: Resource Consumption (CPU)","DoS: Resource Consumption (Memory)","DoS: Resource Consumption (Other)"],"Likelihood":["High"],"Note":"Sometimes this is a factor in \"flood\" attacks, but other types of amplification exist."}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"An application must make resources available to a client commensurate with the client's access level."},{"Phase":["Architecture and Design"],"Description":"An application must, at all times, keep track of allocated resources and meter their usage appropriately."},{"Phase":["System Configuration"],"Description":"Consider disabling resource-intensive algorithms on the server side, such as Diffie-Hellman key exchange.","Effectiveness":"High","EffectivenessNotes":"Business requirements may prevent disabling resource-intensive algorithms."}],"DemonstrativeExamples":[{"ID":"DX-113","Entries":[{"IntroText":"This code listens on a port for DNS requests and sends the result to the requesting address."},{"Nature":"Bad","Language":"Python","ExampleCode":"```\n\tsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n\tsock.bind( (UDP_IP,UDP_PORT) )\n\twhile true:\n\t\t\tdata = sock.recvfrom(1024)\n\t\t\tif not data:\n\t\t\t\tbreak\n\t\t\t(requestIP, nameToResolve) = parseUDPpacket(data)\n\t\t\trecord = resolveName(nameToResolve)\n\t\t\tsendResponse(requestIP,record)\n```"},{"BodyText":"This code sends a DNS record to a requesting IP address. UDP allows the source IP address to be easily changed ('spoofed'), thus allowing an attacker to redirect responses to a target, which may be then be overwhelmed by the network traffic."}]},{"ID":"DX-157","Entries":[{"IntroText":"This function prints the contents of a specified file requested by a user."},{"Nature":"Bad","Language":"PHP","ExampleCode":"```\n\tfunction printFile($username,$filename){\n```\n//read file into string* \n\t\t\t$file = file_get_contents($filename);\n\t\t\tif ($file \u0026\u0026 isOwnerOf($username,$filename)){\n\t\t\t```\n\t\t\t\techo $file;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\telse{\n\t\t\t\techo 'You are not authorized to view this file';\n\t\t\t}\n\t\t\treturn false;\n\t}\n```"},{"BodyText":"This code first reads a specified file into memory, then prints the file if the user is authorized to see its contents. The read of the file into memory may be resource intensive and is unnecessary if the user is not allowed to see the file anyway."}]},{"ID":"DX-53","Entries":[{"IntroText":"The DTD and the very brief XML below illustrate what is meant by an XML bomb. The ZERO entity contains one character, the letter A. The choice of entity name ZERO is being used to indicate length equivalent to that exponent on two, that is, the length of ZERO is 2^0. Similarly, ONE refers to ZERO twice, therefore the XML parser will expand ONE to a length of 2, or 2^1. Ultimately, we reach entity THIRTYTWO, which will expand to 2^32 characters in length, or 4 GB, probably consuming far more data than expected."},{"Nature":"Attack","Language":"XML","ExampleCode":"```\n\t\u003c?xml version=\"1.0\"?\u003e\n\t\u003c!DOCTYPE MaliciousDTD [\n\t\u003c!ENTITY ZERO \"A\"\u003e\n\t\u003c!ENTITY ONE \"\u0026ZERO;\u0026ZERO;\"\u003e\n\t\u003c!ENTITY TWO \"\u0026ONE;\u0026ONE;\"\u003e\n\t...\n\t\u003c!ENTITY THIRTYTWO \"\u0026THIRTYONE;\u0026THIRTYONE;\"\u003e\n\t]\u003e\n\t\u003cdata\u003e\u0026THIRTYTWO;\u003c/data\u003e\n```"}]},{"ID":"DX-158","Entries":[{"IntroText":"This example attempts to check if an input string is a \"sentence\" [REF-1164]."},{"Nature":"Bad","Language":"JavaScript","ExampleCode":"var test_string = \"Bad characters: $@#\";\n var bad_pattern = /^(\\w+\\s?)*$/i;\n var result = test_string.search(bad_pattern);"},{"BodyText":"The regular expression has a vulnerable backtracking clause inside (\\w+\\s?)*$ which can be triggered to cause a Denial of Service by processing particular phrases.\n\n\nTo fix the backtracking problem, backtracking is removed with the ?= portion of the expression which changes it to a lookahead and the \\2 which prevents the backtracking. The modified example is:"},{"Nature":"Good","Language":"JavaScript","ExampleCode":"var test_string = \"Bad characters: $@#\";\n var good_pattern = /^((?=(\\w+))\\2\\s?)*$/i;\n var result = test_string.search(good_pattern);"},{"BodyText":"Note that [REF-1164] has a more thorough (and lengthy) explanation of everything going on within the RegEx."}]},{"Entries":[{"IntroText":"An adversary can cause significant resource consumption on a server by filtering the cryptographic algorithms offered by the client to the ones that are the most resource-intensive on the server side. After discovering which cryptographic algorithms are supported by the server, a malicious client can send the initial cryptographic handshake messages that contains only the resource-intensive algorithms. For some cryptographic protocols, these messages can be completely prefabricated, as the resource-intensive part of the handshake happens on the server-side first (such as TLS), rather than on the client side. In the case of cryptographic protocols where the resource-intensive part should happen on the client-side first (such as SSH), a malicious client can send a forged/precalculated computation result, which seems correct to the server, so the resource-intensive part of the handshake is going to happen on the server side. A malicious client is required to send only the initial messages of a cryptographic handshake to initiate the resource-consuming part of the cryptographic handshake. These messages are usually small, and generating them requires minimal computational effort, enabling a denial-of-service attack. An additional risk is the fact that higher key size increases the effectiveness of the attack. Cryptographic protocols where the clients have influence over the size of the used key (such as TLS 1.3 or SSH) are most at risk, as the client can enforce the highest key size supported by the server."}]}],"ObservedExamples":[{"Reference":"CVE-1999-0513","Description":"Classic \"Smurf\" attack, using spoofed ICMP packets to broadcast addresses.","Link":"https://www.cve.org/CVERecord?id=CVE-1999-0513"},{"Reference":"CVE-2003-1564","Description":"Parsing library allows XML bomb","Link":"https://www.cve.org/CVERecord?id=CVE-2003-1564"},{"Reference":"CVE-2004-2458","Description":"Tool creates directories before authenticating user.","Link":"https://www.cve.org/CVERecord?id=CVE-2004-2458"},{"Reference":"CVE-2020-10735","Description":"Python has \"quadratic complexity\" issue when converting string to int with many digits in unexpected bases","Link":"https://www.cve.org/CVERecord?id=CVE-2020-10735"},{"Reference":"CVE-2020-5243","Description":"server allows ReDOS with crafted User-Agent strings, due to overlapping capture groups that cause excessive backtracking.","Link":"https://www.cve.org/CVERecord?id=CVE-2020-5243"},{"Reference":"CVE-2013-5211","Description":"composite: NTP feature generates large responses (high amplification factor) with spoofed UDP source addresses.","Link":"https://www.cve.org/CVERecord?id=CVE-2013-5211"},{"Reference":"CVE-2002-20001","Description":"Diffie-Hellman (DHE) Key Agreement Protocol allows attackers to send arbitrary numbers that are not public keys, which causes the server to perform expensive, unnecessary computation of modular exponentiation.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-20001"},{"Reference":"CVE-2022-40735","Description":"The Diffie-Hellman Key Agreement Protocol allows use of long exponents, which are more computationally expensive than using certain \"short exponents\" with particular properties.","Link":"https://www.cve.org/CVERecord?id=CVE-2022-40735"}],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Asymmetric resource consumption (amplification)"},{"TaxonomyName":"OWASP Top Ten 2004","EntryID":"A9","EntryName":"Denial of Service","MappingFit":"CWE More Specific"},{"TaxonomyName":"WASC","EntryID":"41","EntryName":"XML Attribute Blowup"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"TPS00-J","EntryName":"Use thread pools to enable graceful degradation of service during traffic bursts"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"FIO04-J","EntryName":"Release resources when they are no longer needed"}],"References":[{"ExternalReferenceID":"REF-1164","Authors":["Ilya Kantor"],"Title":"Catastrophic backtracking","PublicationYear":"2020","PublicationMonth":"12","PublicationDay":"13","URL":"https://javascript.info/regexp-catastrophic-backtracking"}],"MappingNotes":{"Usage":"Allowed-with-Review","Rationale":"This CWE entry is a Class and might have Base-level children that would be more appropriate","Comments":"Examine children of this entry to see if there is a better fit","Reasons":["Abstraction"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Relationships, Other_Notes, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-10-14","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-07-27","ModificationComment":"updated Common_Consequences, Other_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-12-13","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-27","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-10-30","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Functional_Areas"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Applicable_Platforms, Common_Consequences, Demonstrative_Examples, Description, Observed_Examples, Potential_Mitigations, References, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2024-02-29","ModificationComment":"updated Demonstrative_Examples","ModificationVersion":"4.14","ModificationReleaseDate":"2024-02-29"},{"Type":"Contribution","ContributionName":"Szilárd Pfeiffer","ContributionOrganization":"Balasys IT Security","ContributionDate":"2021-11-11","ContributionComment":"Submitted content that led to modifications in applicable platforms, common consequences, potential mitigations, demonstrative examples, observed examples.","ContributionType":"Content"}]}