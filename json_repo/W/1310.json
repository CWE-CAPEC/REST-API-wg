{"ID":"1310","Name":"Missing Ability to Patch ROM Code","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"Missing an ability to patch ROM code may leave a System or System-on-Chip (SoC) in a vulnerable state.","ExtendedDescription":"\n\nA System or System-on-Chip (SoC) that implements a boot process utilizing security mechanisms such as Root-of-Trust (RoT) typically starts by executing code from a Read-only-Memory (ROM) component. The code in ROM is immutable, hence any security vulnerabilities discovered in the ROM code can never be fixed for the systems that are already in use.\n\n\nA common weakness is that the ROM does not have the ability to patch if security vulnerabilities are uncovered after the system gets shipped. This leaves the system in a vulnerable state where an adversary can compromise the SoC.\n","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"1329","ViewID":"1000","Ordinal":"Primary"}],"WeaknessOrdinalities":[{"Ordinality":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Operating_System","Class":"Not OS-Specific","Prevalence":"Undetermined"},{"Type":"Architecture","Class":"Not Architecture-Specific","Prevalence":"Undetermined"},{"Type":"Technology","Class":"System on Chip","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Architecture and Design","Note":"This issue could be introduced during hardware architecture and design and can be identified later during Testing."},{"Phase":"Implementation","Note":"This issue could be introduced during implementation and can be identified later during Testing."},{"Phase":"Integration","Note":"This issue could be introduced during integration and can be identified later during Testing."},{"Phase":"Manufacturing","Note":"This issue could be introduced during manufacturing and can be identified later during Testing."}],"CommonConsequences":[{"Scope":["Other"],"Impact":["Varies by Context","Reduce Maintainability"],"Likelihood":["High"],"Note":"When the system is unable to be patched, it can be left in a vulnerable state."}],"PotentialMitigations":[{"Phase":["Architecture and Design","Implementation"],"Description":"Secure patch support to allow ROM code to be patched on the next boot.","Effectiveness":"Moderate","EffectivenessNotes":"Some parts of the hardware initialization or signature verification done to authenticate patches will always be \"not patchable.\""},{"Phase":["Architecture and Design","Implementation"],"Description":"Support patches that can be programmed in-field or during manufacturing through hardware fuses. This feature can be used for limited patching of devices after shipping, or for the next batch of silicon devices manufactured, without changing the full device ROM.","Effectiveness":"Moderate","EffectivenessNotes":"Patches that use hardware fuses will have limitations in terms of size and the number of patches that can be supported. Note that some parts of the hardware initialization or signature verification done to authenticate patches will always be \"not patchable.\""}],"DemonstrativeExamples":[{"ID":"DX-146","Entries":[{"IntroText":"A System-on-Chip (SOC) implements a Root-of-Trust (RoT) in ROM to boot secure code. However, at times this ROM code might have security vulnerabilities and need to be patched. Since ROM is immutable, it can be impossible to patch."},{"BodyText":"ROM does not have built-in application-programming interfaces (APIs) to patch if the code is vulnerable. Implement mechanisms to patch the vulnerable ROM code."}]},{"Entries":[{"IntroText":"The example code is taken from the SoC peripheral wrapper inside the buggy OpenPiton SoC of HACK@DAC'21. The wrapper is used for connecting the communications between SoC peripherals, such as crypto-engines, direct memory access (DMA), reset controllers, JTAG, etc. The secure implementation of the SoC wrapper should allow users to boot from a ROM for Linux (i_bootrom_linux) or from a patchable ROM (i_bootrom_patch) if the Linux bootrom has security or functional issues.The example code is taken from the SoC peripheral wrapper inside the buggy OpenPiton SoC of HACK@DAC'21. The wrapper is used for connecting the communications between SoC peripherals, such as crypto-engines, direct memory access (DMA), reset controllers, JTAG, etc. The secure implementation of the SoC wrapper should allow users to boot from a ROM for Linux (i_bootrom_linux) or from a patchable ROM (i_bootrom_patch) if the Linux bootrom has security or functional issues."},{"Nature":"Bad","Language":"Verilog","ExampleCode":"...\n\n```\n\t bootrom i_bootrom_patch (\n\t\t .clk_i ,\n\t\t .req_i ( rom_req ),\n\t\t .addr_i ( rom_addr ),\n\t\t .rdata_o ( rom_rdata_patch )\n\t );\n\t bootrom_linux i_bootrom_linux (\n\t\t .clk_i ,\n\t\t .req_i ( rom_req ),\n\t\t .addr_i ( rom_addr ),\n\t\t .rdata_o ( rom_rdata_linux )\n\t );\n```\nassign rom_rdata = (ariane_boot_sel_i) ? rom_rdata_linux : rom_rdata_linux;** \n ..."},{"BodyText":"The above implementation causes the ROM data to be hardcoded for the linux system (rom_rdata_linux) regardless of the value of ariane_boot_sel_i. Therefore, the data (rom_rdata_patch) from the patchable ROM code is never used [REF-1396].\n\n\nThis weakness disables the ROM's ability to be patched. If attackers uncover security vulnerabilities in the ROM, the users must replace the entire device. Otherwise, the weakness exposes the system to a vulnerable state forever.\n\n\nA fix to this issue is to enable rom_rdata to be selected from the patchable rom (rom_rdata_patch) [REF-1397]."},{"Nature":"Good","Language":"Verilog","ExampleCode":"...\n\n```\n\t bootrom i_bootrom_patch (\n\t\t .clk_i ,\n\t\t .req_i ( rom_req ),\n\t\t .addr_i ( rom_addr ),\n\t\t .rdata_o ( rom_rdata_patch )\n\t );\n\t bootrom_linux i_bootrom_linux (\n\t\t .clk_i ,\n\t\t .req_i ( rom_req ),\n\t\t .addr_i ( rom_addr ),\n\t\t .rdata_o ( rom_rdata_linux )\n\t );\n```\nassign rom_rdata = (ariane_boot_sel_i) ? rom_rdata_patch : rom_rdata_linux;** \n ..."}]}],"RelatedAttackPatterns":["682"],"References":[{"ExternalReferenceID":"REF-1396","Title":"riscv_peripherals.sv line 534","PublicationYear":"2021","URL":"https://github.com/HACK-EVENT/hackatdac21/blob/75e5c0700b5a02e744f006fe8a09ff3c2ccdd32d/piton/design/chip/tile/ariane/openpiton/riscv_peripherals.sv#L534","URLDate":"2024-02-12"},{"ExternalReferenceID":"REF-1397","Title":"Fix for riscv_peripherals.sv line 534","PublicationYear":"2021","URL":"https://github.com/HACK-EVENT/hackatdac21/blob/cwe_1310_riscv_peripheral/piton/design/chip/tile/ariane/openpiton/riscv_peripherals.sv#L534","URLDate":"2024-02-12"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"Narasimha Kumar V Mangipudi","SubmissionOrganization":"Intel Corporation","SubmissionDate":"2020-04-25","SubmissionVersion":"4.3","SubmissionReleaseDate":"2020-12-10"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-03-15","ModificationComment":"updated Maintenance_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-07-20","ModificationComment":"updated Demonstrative_Examples, Maintenance_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-04-28","ModificationComment":"updated Applicable_Platforms, Common_Consequences, Potential_Mitigations, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated References, Related_Attack_Patterns"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2024-02-29","ModificationComment":"updated Demonstrative_Examples, References","ModificationVersion":"4.14","ModificationReleaseDate":"2024-02-29"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2025-12-11","ModificationComment":"updated Weakness_Ordinalities","ModificationVersion":"4.19","ModificationReleaseDate":"2025-12-11"},{"Type":"Contribution","ContributionName":"Jason Fung","ContributionOrganization":"Intel","ContributionDate":"2022-09-07","ContributionComment":"suggested removal of incorrect references","ContributionType":"Feedback"},{"Type":"Contribution","ContributionName":"Chen Chen, Rahul Kande, Jeyavijayan Rajendran","ContributionOrganization":"Texas A\u0026M University","ContributionDate":"2023-11-29","ContributionComment":"suggested demonstrative example","ContributionType":"Content"},{"Type":"Contribution","ContributionName":"Shaza Zeitouni, Mohamadreza Rostami, Ahmad-Reza Sadeghi","ContributionOrganization":"Technical University of Darmstadt","ContributionDate":"2023-11-29","ContributionComment":"suggested demonstrative example","ContributionType":"Content"}]}