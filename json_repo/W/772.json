{"ID":"772","Name":"Missing Release of Resource after Effective Lifetime","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"The product does not release a resource after its effective lifetime has ended, i.e., after the resource is no longer needed.","ExtendedDescription":"When a resource is not released after use, it can allow attackers to cause a denial of service by causing the allocation of resources without triggering their release. Frequently-affected resources include memory, CPU, disk space, power or battery, etc.","LikelihoodOfExploit":"High","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"404","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"404","ViewID":"1003","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"404","ViewID":"1305","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"404","ViewID":"1340","Ordinal":"Primary"}],"ApplicablePlatforms":[{"Type":"Technology","Class":"Mobile","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Availability"],"Impact":["DoS: Resource Consumption (Other)"],"Note":"An attacker that can influence the allocation of resources that are not properly released could deplete the available resource pool and prevent all other processes from accessing the same type of resource."}],"PotentialMitigations":[{"MitigationID":"MIT-3","Phase":["Requirements"],"Strategy":"Language Selection","Description":"\n\nUse a language that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.\n\n\nFor example, languages such as Java, Ruby, and Lisp perform automatic garbage collection that releases memory for objects that have been deallocated.\n"},{"Phase":["Implementation"],"Description":"It is good practice to be responsible for freeing all resources you allocate and to be consistent with how and where you free resources in a function. If you allocate resources that you intend to free upon completion of the function, you must be sure to free the resources at all exit points for that function including error conditions."},{"MitigationID":"MIT-47","Phase":["Operation","Architecture and Design"],"Strategy":"Resource Limitation","Description":"\n\nUse resource-limiting settings provided by the operating system or environment. For example, when managing system resources in POSIX, setrlimit() can be used to set limits for certain types of resources, and getrlimit() can determine how many resources are available. However, these functions are not available on all operating systems.\n\n\nWhen the current levels get close to the maximum that is defined for the application (see CWE-770), then limit the allocation of further resources to privileged users; alternately, begin releasing resources for less-privileged users. While this mitigation may protect the system from attack, it will not necessarily stop attackers from adversely impacting other users.\n\n\nEnsure that the application performs the appropriate error checks and error handling in case resources become unavailable (CWE-703).\n"}],"DemonstrativeExamples":[{"ID":"DX-81","Entries":[{"IntroText":"The following method never closes the new file handle. Given enough time, the Finalize() method for BufferReader should eventually call Close(), but there is no guarantee as to how long this action will take. In fact, there is no guarantee that Finalize() will ever be invoked. In a busy environment, the Operating System could use up all of the available file handles before the Close() function is called."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tprivate void processFile(string fName)\n\t{\n\t\tBufferReader fil = new BufferReader(new FileReader(fName));\n\t\tString line;\n\t\twhile ((line = fil.ReadLine()) != null)\n\t\t{\n\t\t\tprocessLine(line);\n\t\t}\n\t}\n```"},{"BodyText":"The good code example simply adds an explicit call to the Close() function when the system is done using the file. Within a simple example such as this the problem is easy to see and fix. In a real system, the problem may be considerably more obscure."},{"Nature":"Good","Language":"Java","ExampleCode":"```\n\tprivate void processFile(string fName)\n\t{\n\t\tBufferReader fil = new BufferReader(new FileReader(fName));\n\t\tString line;\n\t\twhile ((line = fil.ReadLine()) != null)\n\t\t{\n\t\t\tprocessLine(line);\n\t\t}\n\t\tfil.Close();\n\t}\n```"}]},{"Entries":[{"IntroText":"The following code attempts to open a new connection to a database, process the results returned by the database, and close the allocated SqlConnection object."},{"Nature":"Bad","Language":"C#","ExampleCode":"```\n\tSqlConnection conn = new SqlConnection(connString);\n\tSqlCommand cmd = new SqlCommand(queryString);\n\tcmd.Connection = conn;\n\tconn.Open();\n\tSqlDataReader rdr = cmd.ExecuteReader();\n\tHarvestResults(rdr);\n\tconn.Connection.Close();\n```"},{"BodyText":"The problem with the above code is that if an exception occurs while executing the SQL or processing the results, the SqlConnection object is not closed. If this happens often enough, the database will run out of available cursors and not be able to execute any more SQL queries."}]},{"ID":"DX-82","Entries":[{"IntroText":"This code attempts to open a connection to a database and catches any exceptions that may occur."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\ttry {\n\t\tConnection con = DriverManager.getConnection(some_connection_string);\n\t}\n\tcatch ( Exception e ) {\n\t\tlog( e );\n\t}\n```"},{"BodyText":"If an exception occurs after establishing the database connection and before the same connection closes, the pool of database connections may become exhausted. If the number of available connections is exceeded, other users cannot access this resource, effectively denying access to the application."}]},{"ID":"DX-83","Entries":[{"IntroText":"Under normal conditions the following C# code executes a database query, processes the results returned by the database, and closes the allocated SqlConnection object. But if an exception occurs while executing the SQL or processing the results, the SqlConnection object is not closed. If this happens often enough, the database will run out of available cursors and not be able to execute any more SQL queries."},{"Nature":"Bad","Language":"C#","ExampleCode":"```\n\t...\n\tSqlConnection conn = new SqlConnection(connString);\n\tSqlCommand cmd = new SqlCommand(queryString);\n\tcmd.Connection = conn;\n\tconn.Open();\n\tSqlDataReader rdr = cmd.ExecuteReader();\n\tHarvestResults(rdr);\n\tconn.Connection.Close();\n\t...\n```"}]},{"ID":"DX-84","Entries":[{"IntroText":"The following C function does not close the file handle it opens if an error occurs. If the process is long-lived, the process can run out of file handles."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tint decodeFile(char* fName) {\n\t\t\tchar buf[BUF_SZ];\n\t\t\tFILE* f = fopen(fName, \"r\");\n\t\t\tif (!f) {\n\t\t\t\tprintf(\"cannot open %s\\n\", fName);\n\t\t\t\treturn DECODE_FAIL;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t\twhile (fgets(buf, BUF_SZ, f)) {\n\t\t\t\t\t\tif (!checkChecksum(buf)) {\n\t\t\t\t\t\t\treturn DECODE_FAIL;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tdecodeBlock(buf);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tfclose(f);\n\t\t\treturn DECODE_SUCCESS;\n\t}\n```"}]}],"ObservedExamples":[{"Reference":"CVE-2007-0897","Description":"Chain: anti-virus product encounters a malformed file but returns from a function without closing a file descriptor (CWE-775) leading to file descriptor consumption (CWE-400) and failed scans.","Link":"https://www.cve.org/CVERecord?id=CVE-2007-0897"},{"Reference":"CVE-2001-0830","Description":"Sockets not properly closed when attacker repeatedly connects and disconnects from server.","Link":"https://www.cve.org/CVERecord?id=CVE-2001-0830"},{"Reference":"CVE-1999-1127","Description":"Does not shut down named pipe connections if malformed data is sent.","Link":"https://www.cve.org/CVERecord?id=CVE-1999-1127"},{"Reference":"CVE-2009-2858","Description":"Chain: memory leak (CWE-404) leads to resource exhaustion.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-2858"},{"Reference":"CVE-2009-2054","Description":"Product allows exhaustion of file descriptors when processing a large number of TCP packets.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-2054"},{"Reference":"CVE-2008-2122","Description":"Port scan triggers CPU consumption with processes that attempt to read data from closed sockets.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-2122"},{"Reference":"CVE-2007-4103","Description":"Product allows resource exhaustion via a large number of calls that do not complete a 3-way handshake.","Link":"https://www.cve.org/CVERecord?id=CVE-2007-4103"},{"Reference":"CVE-2002-1372","Description":"Chain: Return values of file/socket operations are not checked (CWE-252), allowing resultant consumption of file descriptors (CWE-772).","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1372"}],"TaxonomyMappings":[{"TaxonomyName":"CERT C Secure Coding","EntryID":"FIO42-C","EntryName":"Close files when they are no longer needed","MappingFit":"CWE More Abstract"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MEM31-C","EntryName":"Free dynamically allocated memory when no longer needed","MappingFit":"CWE More Abstract"},{"TaxonomyName":"OMG ASCSM","EntryID":"ASCSM-CWE-772"},{"TaxonomyName":"OMG ASCRM","EntryID":"ASCRM-CWE-772"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP14","EntryName":"Failure to Release Resource"}],"RelatedAttackPatterns":["469"],"References":[{"ExternalReferenceID":"REF-961","Section":"ASCRM-CWE-772","Authors":["Object Management Group (OMG)"],"Title":"Automated Source Code Reliability Measure (ASCRM)","PublicationYear":"2016","PublicationMonth":"01","URL":"http://www.omg.org/spec/ASCRM/1.0/"},{"ExternalReferenceID":"REF-962","Section":"ASCSM-CWE-772","Authors":["Object Management Group (OMG)"],"Title":"Automated Source Code Security Measure (ASCSM)","PublicationYear":"2016","PublicationMonth":"01","URL":"http://www.omg.org/spec/ASCSM/1.0/"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"Notes":[{"Type":"Maintenance","Note":"\"Resource exhaustion\" (CWE-400) is currently treated as a weakness, although it is more like a category of weaknesses that all have the same type of consequence. While this entry treats CWE-400 as a parent in view 1000, the relationship is probably more appropriately described as a chain."},{"Type":"Theoretical","Note":"Vulnerability theory is largely about how behaviors and resources interact. \"Resource exhaustion\" can be regarded as either a consequence or an attack, depending on the perspective. This entry is an attempt to reflect one of the underlying weaknesses that enable these attacks (or consequences) to take place."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"CWE Content Team","SubmissionOrganization":"MITRE","SubmissionDate":"2009-05-13","SubmissionVersion":"1.4","SubmissionReleaseDate":"2009-05-27"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Demonstrative_Examples, Potential_Mitigations, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-04-05","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-06-21","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-27","ModificationComment":"updated Observed_Examples, Related_Attack_Patterns, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-09-13","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Demonstrative_Examples, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-10-30","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2013-02-21","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-02-18","ModificationComment":"updated Applicable_Platforms, Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-01-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Likelihood_of_Exploit, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Common_Consequences, References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-09-19","ModificationComment":"updated Description, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Applicable_Platforms, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-12-10","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-03-15","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-10-26","ModificationComment":"updated Observed_Examples"}]}