{"ID":"543","Name":"Use of Singleton Pattern Without Synchronization in a Multithreaded Context","Abstraction":"Variant","Structure":"Simple","Status":"Incomplete","Description":"The product uses the singleton pattern when creating a resource within a multithreaded environment.","ExtendedDescription":"The use of a singleton pattern may not be thread-safe.","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"820","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"662","ViewID":"1305","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"662","ViewID":"1340","Ordinal":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Name":"Java","Prevalence":"Undetermined"},{"Type":"Language","Name":"C++","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Other","Integrity"],"Impact":["Other","Modify Application Data"]}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"Use the Thread-Specific Storage Pattern. See References."},{"Phase":["Implementation"],"Description":"Do not use member fields to store information in the Servlet. In multithreading environments, storing user data in Servlet member fields introduces a data access race condition."},{"Phase":["Implementation"],"Description":"Avoid using the double-checked locking pattern in language versions that cannot guarantee thread safety. This pattern may be used to avoid the overhead of a synchronized call, but in certain versions of Java (for example), this has been shown to be unsafe because it still introduces a race condition (CWE-209).","Effectiveness":"Limited"}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"This method is part of a singleton pattern, yet the following singleton() pattern is not thread-safe. It is possible that the method will create two objects instead of only one."},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tprivate static NumberConverter singleton;\n\tpublic static NumberConverter get_singleton() {\n\t\tif (singleton == null) {\n\t\t\tsingleton = new NumberConverter();\n\t\t}\n\t\treturn singleton;\n\t}\n```"},{"BodyText":"Consider the following course of events:"},{"BodyText":"- Thread A enters the method, finds singleton to be null, begins the NumberConverter constructor, and then is swapped out of execution.\n\n  - Thread B enters the method and finds that singleton remains null. This will happen if A was swapped out during the middle of the constructor, because the object reference is not set to point at the new object on the heap until the object is fully initialized.\n\n  - Thread B continues and constructs another NumberConverter object and returns it while exiting the method.\n\n  - Thread A continues, finishes constructing its NumberConverter object, and returns its version."},{"BodyText":"At this point, the threads have created and returned two different objects."}]}],"TaxonomyMappings":[{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"MSC07-J","EntryName":"Prevent multiple instantiations of singleton objects"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP19","EntryName":"Missing Lock"}],"References":[{"ExternalReferenceID":"REF-474","Authors":["Douglas C. Schmidt","Timothy H. Harrison","Nat Pryce"],"Title":"Thread-Specifc Storage for C/C++","URL":"http://www.cs.wustl.edu/~schmidt/PDF/TSS-pattern.pdf"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"ContentHistory":[{"Type":"Submission","SubmissionName":"Anonymous Tool Vendor (under NDA)","SubmissionDate":"2006-07-19","SubmissionVersion":"Draft 3","SubmissionReleaseDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Potential_Mitigations, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-09-27","ModificationComment":"updated Name"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-12-13","ModificationComment":"updated Applicable_Platforms, Demonstrative_Examples, Description, Potential_Mitigations, References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-12-10","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Rename","PreviousEntryName":"Use of Singleton Pattern in a Non-thread-safe Manner","Date":"2010-09-27"}]}