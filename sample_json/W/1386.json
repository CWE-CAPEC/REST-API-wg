{"ID":"1386","Name":"Insecure Operation on Windows Junction / Mount Point","Abstraction":"Base","Structure":"Simple","Status":"Incomplete","Description":"The product opens a file or directory, but it does not properly prevent the name from being associated with a junction or mount point to a destination that is outside of the intended control sphere.","ExtendedDescription":"\n\nDepending on the intended action being performed, this could allow an attacker to cause the product to read, write, delete, or otherwise operate on unauthorized files.\n\n\nIn Windows, NTFS5 allows for file system objects called reparse points. Applications can create a hard link from one directory to another directory, called a junction point. They can also create a mapping from a directory to a drive letter, called a mount point. If a file is used by a privileged program, but it can be replaced with a hard link to a sensitive file (e.g., AUTOEXEC.BAT), an attacker could excalate privileges. When the process opens the file, the attacker can assume the privileges of that process, tricking the privileged process to read, modify, or delete the sensitive file, preventing the program from accurately processing data. Note that one can also point to registries and semaphores.\n","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"59","ViewID":"1000","Ordinal":"Primary"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"},{"Type":"Operating_System","Class":"Windows","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation","Note":"The developer might not consider that when a program in Windows operates with different permissions than the executing user, the use of links, mount points, and junctions might cause the program to access files or directories that are outside of the intended storage location."}],"CommonConsequences":[{"Scope":["Confidentiality"],"Impact":["Read Files or Directories"],"Note":"Read arbitrary files by replacing a user-controlled folder with a mount point and additional hard links."},{"Scope":["Integrity"],"Impact":["Modify Files or Directories"],"Note":"Modify an arbitrary file by replacing the rollback files in installer directories, as they can have the installer execute those rollbacks."},{"Scope":["Availability"],"Impact":["Modify Files or Directories"],"Note":"Even if there is no control of contents, an arbitrary file delete or overwrite (when running as SYSTEM or admin) can be used for a permanent system denial-of-service, e.g. by deleting a startup configuration file that prevents the service from starting."}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Strategy":"Separation of Privilege","Description":"When designing software that will have different rights than the executer, the software should check that files that it is interacting with are not improper hard links or mount points. One way to do this in Windows is to use the functionality embedded in the following command: \"dir /al /s /b\" or, in PowerShell, use LinkType as a filter. In addition, some software uses authentication via signing to ensure that the file is the correct one to use. Make checks atomic with the file action, otherwise a TOCTOU weakness (CWE-367) can be introduced."}],"ObservedExamples":[{"Reference":"CVE-2021-26426","Description":"Privileged service allows attackers to delete unauthorized files using a directory junction, leading to arbitrary code execution as SYSTEM.","Link":"https://www.cve.org/CVERecord?id=CVE-2021-26426"},{"Reference":"CVE-2020-0863","Description":"By creating a mount point and hard links, an attacker can abuse a service to allow users arbitrary file read permissions.","Link":"https://www.cve.org/CVERecord?id=CVE-2020-0863"},{"Reference":"CVE-2019-1161","Description":"Chain: race condition (CWE-362) in anti-malware product allows deletion of files by creating a junction (CWE-1386) and using hard links during the time window in which a temporary file is created and deleted.","Link":"https://www.cve.org/CVERecord?id=CVE-2019-1161"},{"Reference":"CVE-2014-0568","Description":"Escape from sandbox for document reader by using a mountpoint [REF-1264]","Link":"https://www.cve.org/CVERecord?id=CVE-2014-0568"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"References":[{"ExternalReferenceID":"REF-1262","Authors":["Eran Shimony"],"Title":"Follow the Link: Exploiting Symbolic Links with Ease","PublicationYear":"2019","PublicationMonth":"10","PublicationDay":"03","URL":"https://www.cyberark.com/resources/threat-research-blog/follow-the-link-exploiting-symbolic-links-with-ease"},{"ExternalReferenceID":"REF-1264","Authors":["James Forshaw"],"Title":"Windows 10^H^H Symbolic Link Mitigations","PublicationYear":"2015","PublicationMonth":"08","PublicationDay":"25","URL":"https://googleprojectzero.blogspot.com/2015/08/windows-10hh-symbolic-link-mitigations.html"},{"ExternalReferenceID":"REF-1265","Title":"Symbolic testing tools","URL":"https://github.com/googleprojectzero/symboliclink-testing-tools"},{"ExternalReferenceID":"REF-1266","Authors":["Shubham Dubey"],"Title":"Understanding and Exploiting Symbolic links in Windows - Symlink Attack EOP","PublicationYear":"2020","PublicationMonth":"04","PublicationDay":"16","URL":"https://nixhacker.com/understanding-and-exploiting-symbolic-link-in-windows/"},{"ExternalReferenceID":"REF-1267","Authors":["Simon Zuckerbraun"],"Title":"Abusing Arbitrary File Deletes to Escalate Privilege and Other Great Tricks","PublicationYear":"2022","PublicationMonth":"03","PublicationDay":"17","URL":"https://www.zerodayinitiative.com/blog/2022/3/16/abusing-arbitrary-file-deletes-to-escalate-privilege-and-other-great-tricks"},{"ExternalReferenceID":"REF-1271","Authors":["Cl√©ment Lavoillotte"],"Title":"Abusing privileged file operations","PublicationYear":"2019","PublicationMonth":"03","PublicationDay":"20","URL":"https://troopers.de/troopers19/agenda/7af9hw/"}],"Notes":[{"Type":"Terminology","Note":"Symbolic links, hard links, junctions, and mount points can be confusing terminology, as there are differences in how they operate between UNIX-based systems and Windows, and there are interactions between them."},{"Type":"Maintenance","Note":"This entry is still under development and will continue to see updates and content improvements."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"CWE Content Team","SubmissionOrganization":"MITRE","SubmissionDate":"2022-06-07"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description, Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"}]}