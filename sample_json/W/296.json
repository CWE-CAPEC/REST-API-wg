{"ID":"296","Name":"Improper Following of a Certificate's Chain of Trust","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"The product does not follow, or incorrectly follows, the chain of trust for a certificate back to a trusted root certificate, resulting in incorrect trust of any resource that is associated with that certificate.","ExtendedDescription":"\n\nIf a system does not follow the chain of trust of a certificate to a root server, the certificate loses all usefulness as a metric of trust. Essentially, the trust gained from a certificate is derived from a chain of trust -- with a reputable trusted entity at the end of that list. The end user must trust that reputable source, and this reputable source must vouch for the resource in question through the medium of the certificate.\n\n\nIn some cases, this trust traverses several entities who vouch for one another. The entity trusted by the end user is at one end of this trust chain, while the certificate-wielding resource is at the other end of the chain. If the user receives a certificate at the end of one of these trust chains and then proceeds to check only that the first link in the chain, no real trust has been derived, since the entire chain must be traversed back to a trusted source to verify the certificate.\n\n\nThere are several ways in which the chain of trust might be broken, including but not limited to:\n\n\n  - Any certificate in the chain is self-signed, unless it the root.\n\n  - Not every intermediate certificate is checked, starting from the original certificate all the way up to the root certificate.\n\n  - An intermediate, CA-signed certificate does not have the expected Basic Constraints or other important extensions.\n\n  - The root certificate has been compromised or authorized to the wrong party.\n\n","LikelihoodOfExploit":"Low","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"295","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"573","ViewID":"1000"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Implementation","Note":"When the product uses certificate pinning, the developer might not properly validate all relevant components of the certificate before pinning the certificate. This can make it difficult or expensive to test after the pinning is complete."},{"Phase":"Implementation","Note":"REALIZATION: This weakness is caused during implementation of an architectural security tactic."}],"CommonConsequences":[{"Scope":["Non-Repudiation"],"Impact":["Hide Activities"],"Note":"Exploitation of this flaw can lead to the trust of data that may have originated with a spoofed source."},{"Scope":["Integrity","Confidentiality","Availability","Access Control"],"Impact":["Gain Privileges or Assume Identity","Execute Unauthorized Code or Commands"],"Note":"Data, requests, or actions taken by the attacking entity can be carried out as a spoofed benign entity."}],"DetectionMethods":[{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"Ensure that proper certificate checking is included in the system design."},{"Phase":["Implementation"],"Description":"Understand, and properly implement all checks necessary to ensure the integrity of certificate trust integrity."},{"Phase":["Implementation"],"Description":"If certificate pinning is being used, ensure that all relevant properties of the certificate are fully validated before the certificate is pinned, including the full chain of trust."}],"DemonstrativeExamples":[{"ID":"DX-121","Entries":[{"IntroText":"This code checks the certificate of a connected peer."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tif ((cert = SSL_get_peer_certificate(ssl)) \u0026\u0026 host)\n\t\tfoo=SSL_get_verify_result(ssl);\n\tif ((X509_V_OK==foo) || X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN==foo))\n```\n// certificate looks good, host can be trusted*"},{"BodyText":"In this case, because the certificate is self-signed, there was no external authority that could prove the identity of the host. The program could be communicating with a different system that is spoofing the host, e.g. by poisoning the DNS cache or using an Adversary-in-the-Middle (AITM) attack to modify the traffic from server to client."}]}],"ObservedExamples":[{"Reference":"CVE-2016-2402","Description":"Server allows bypass of certificate pinning by sending a chain of trust that includes a trusted CA that is not pinned.","Link":"https://www.cve.org/CVERecord?id=CVE-2016-2402"},{"Reference":"CVE-2008-4989","Description":"Verification function trusts certificate chains in which the last certificate is self-signed.","Link":"https://www.cve.org/CVERecord?id=CVE-2008-4989"},{"Reference":"CVE-2012-5821","Description":"Chain: Web browser uses a TLS-related function incorrectly, preventing it from verifying that a server's certificate is signed by a trusted certification authority (CA).","Link":"https://www.cve.org/CVERecord?id=CVE-2012-5821"},{"Reference":"CVE-2009-3046","Description":"Web browser does not check if any intermediate certificates are revoked.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-3046"},{"Reference":"CVE-2009-0265","Description":"chain: DNS server does not correctly check return value from the OpenSSL EVP_VerifyFinal function allows bypass of validation of the certificate chain.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-0265"},{"Reference":"CVE-2009-0124","Description":"chain: incorrect check of return value from the OpenSSL EVP_VerifyFinal function allows bypass of validation of the certificate chain.","Link":"https://www.cve.org/CVERecord?id=CVE-2009-0124"},{"Reference":"CVE-2002-0970","Description":"File-transfer software does not validate Basic Constraints of an intermediate CA-signed certificate.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-0970"},{"Reference":"CVE-2002-0862","Description":"Cryptographic API, as used in web browsers, mail clients, and other software, does not properly validate Basic Constraints.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-0862"}],"TaxonomyMappings":[{"TaxonomyName":"CLASP","EntryName":"Failure to follow chain of trust in certificate validation"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"References":[{"ExternalReferenceID":"REF-18","Authors":["Secure Software, Inc."],"Title":"The CLASP Application Security Process","PublicationYear":"2005","URL":"https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf"},{"ExternalReferenceID":"REF-245","Authors":["Martin Georgiev","Subodh Iyengar","Suman Jana","Rishita Anubhai","Dan Boneh","Vitaly Shmatikov"],"Title":"The Most Dangerous Code in the World: Validating SSL Certificates in Non-Browser Software","PublicationYear":"2012","PublicationMonth":"10","PublicationDay":"25","URL":"http://www.cs.utexas.edu/~shmat/shmat_ccs12.pdf"},{"ExternalReferenceID":"REF-44","Section":"\"Sin 23: Improper Use of PKI, Especially SSL.\" Page 347","Authors":["Michael Howard","David LeBlanc","John Viega"],"Title":"24 Deadly Sins of Software Security","Publication":"McGraw-Hill","PublicationYear":"2010"}],"ContentHistory":[{"Type":"Submission","SubmissionName":"CLASP","SubmissionDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Common_Consequences, Relationships, Other_Notes, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Description, Name, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-07-27","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-12-13","ModificationComment":"updated Other_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2013-02-21","ModificationComment":"updated Applicable_Platforms, Demonstrative_Examples, Description, Name, Observed_Examples, Other_Notes, References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2013-07-17","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Demonstrative_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Demonstrative_Examples, Modes_of_Introduction, References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2018-03-27","ModificationComment":"updated Modes_of_Introduction, Observed_Examples, Potential_Mitigations, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-09-19","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Demonstrative_Examples, References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-07-20","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-10-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-04-28","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description, Modes_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Rename","PreviousEntryName":"Failure to Follow Chain of Trust in Certificate Validation","Date":"2009-03-10"},{"Type":"Rename","PreviousEntryName":"Improper Following of Chain of Trust for Certificate Validation","Date":"2013-02-21"}]}