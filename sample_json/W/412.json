{"ID":"412","Name":"Unrestricted Externally Accessible Lock","Abstraction":"Base","Structure":"Simple","Status":"Incomplete","Description":"The product properly checks for the existence of a lock, but the lock can be externally controlled or influenced by an actor that is outside of the intended sphere of control.","ExtendedDescription":"This prevents the product from acting on associated resources or performing other behaviors that are controlled by the presence of the lock. Relevant locks might include an exclusive lock or mutex, or modifying a shared resource that is treated as a lock. If the lock can be held for an indefinite period of time, then the denial of service could be permanent.","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"667","ViewID":"1000","Ordinal":"Primary"},{"Nature":"CanAlsoBe","CweID":"410","ViewID":"1000"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Architecture and Design"},{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Availability"],"Impact":["DoS: Resource Consumption (Other)"],"Note":"When an attacker can control a lock, the program may wait indefinitely until the attacker releases the lock, causing a denial of service to other users of the program. This is especially problematic if there is a blocking operation on the lock."}],"DetectionMethods":[{"Method":"White Box","Description":"Automated code analysis techniques might not be able to reliably detect this weakness, since the application's behavior and general security model dictate which resource locks are critical. Interpretation of the weakness might require knowledge of the environment, e.g. if the existence of a file is used as a lock, but the file is created in a world-writable directory."}],"PotentialMitigations":[{"Phase":["Architecture and Design","Implementation"],"Description":"Use any access control that is offered by the functionality that is offering the lock."},{"Phase":["Architecture and Design","Implementation"],"Description":"Use unpredictable names or identifiers for the locks. This might not always be possible or feasible."},{"Phase":["Architecture and Design"],"Description":"Consider modifying your code to use non-blocking synchronization methods."}],"DemonstrativeExamples":[{"ID":"DX-69","Entries":[{"IntroText":"This code tries to obtain a lock for a file, then writes to it."},{"Nature":"Bad","Language":"PHP","ExampleCode":"```\n\tfunction writeToLog($message){\n\t\t$logfile = fopen(\"logFile.log\", \"a\");\n```\n//attempt to get logfile lock* \n\t\tif (flock($logfile, LOCK_EX)) {\n\t\t```\n\t\t\tfwrite($logfile,$message);\n```\n// unlock logfile* \n\t\t\tflock($logfile, LOCK_UN);}\n\t\telse {\n\t\t```\n\t\t\tprint \"Could not obtain lock on logFile.log, message not recorded\\n\";\n\t\t}\n\t}\n\tfclose($logFile);\n```"},{"BodyText":"PHP by default will wait indefinitely until a file lock is released. If an attacker is able to obtain the file lock, this code will pause execution, possibly leading to denial of service for other users. Note that in this case, if an attacker can perform an flock() on the file, they may already have privileges to destroy the log file. However, this still impacts the execution of other programs that depend on flock()."}]}],"ObservedExamples":[{"Reference":"CVE-2001-0682","Description":"Program can not execute when attacker obtains a mutex.","Link":"https://www.cve.org/CVERecord?id=CVE-2001-0682"},{"Reference":"CVE-2002-1914","Description":"Program can not execute when attacker obtains a lock on a critical output file.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1914"},{"Reference":"CVE-2002-1915","Description":"Program can not execute when attacker obtains a lock on a critical output file.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1915"},{"Reference":"CVE-2002-0051","Description":"Critical file can be opened with exclusive read access by user, preventing application of security policy. Possibly related to improper permissions, large-window race condition.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-0051"},{"Reference":"CVE-2000-0338","Description":"Chain: predictable file names used for locking, allowing attacker to create the lock beforehand. Resultant from permissions and randomness.","Link":"https://www.cve.org/CVERecord?id=CVE-2000-0338"},{"Reference":"CVE-2000-1198","Description":"Chain: Lock files with predictable names. Resultant from randomness.","Link":"https://www.cve.org/CVERecord?id=CVE-2000-1198"},{"Reference":"CVE-2002-1869","Description":"Product does not check if it can write to a log file, allowing attackers to avoid logging by accessing the file using an exclusive lock. Overlaps unchecked error condition. This is not quite CWE-412, but close.","Link":"https://www.cve.org/CVERecord?id=CVE-2002-1869"}],"TaxonomyMappings":[{"TaxonomyName":"PLOVER","EntryName":"Unrestricted Critical Resource Lock"},{"TaxonomyName":"7 Pernicious Kingdoms","EntryName":"Deadlock"},{"TaxonomyName":"OWASP Top Ten 2004","EntryID":"A9","EntryName":"Denial of Service","MappingFit":"CWE More Specific"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"LCK00-J","EntryName":"Use private final lock objects to synchronize classes that may interact with untrusted code"},{"TaxonomyName":"The CERT Oracle Secure Coding Standard for Java (2011)","EntryID":"LCK07-J","EntryName":"Avoid deadlock by requesting and releasing locks in the same order"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP22","EntryName":"Unrestricted lock"}],"RelatedAttackPatterns":["25"],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"Notes":[{"Type":"Relationship","Note":"This overlaps Insufficient Resource Pool when the \"pool\" is of size 1. It can also be resultant from race conditions, although the timing window could be quite large in some cases."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"PLOVER","SubmissionDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Potential_Mitigations, Time_of_Introduction"},{"Type":"Modification","ModificationOrganization":"KDM Analytics","ModificationDate":"2008-08-01","ModificationComment":"added/updated white box definitions"},{"Type":"Modification","ModificationOrganization":"Veracode","ModificationDate":"2008-08-15","ModificationComment":"Suggested OWASP Top Ten 2004 mapping"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Common_Consequences, Description, Detection_Factors, Relationships, Observed_Example, Relationship_Notes, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-10-14","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"KDM Analytics","ModificationDate":"2009-07-17","ModificationComment":"Suggested a better name and the minimal relationship with resources regardless of their criticality."},{"Type":"Modification","ModificationName":"KDM Analytics","ModificationDate":"2009-07-17","ModificationComment":"Added a White_Box_Definition and clarified the consequences."},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-07-27","ModificationComment":"updated Common_Consequences, Description, Name, Potential_Mitigations, White_Box_Definitions"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Demonstrative_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Relationships, White_Box_Definitions"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"},{"Type":"Contribution","ContributionOrganization":"KDM Analytics","ContributionDate":"2008-08-29","ContributionComment":"suggested clarification of description and observed examples, which were vague and inconsistent.","ContributionType":"Feedback"},{"Type":"Rename","PreviousEntryName":"Unrestricted Critical Resource Lock","Date":"2008-04-11"},{"Type":"Rename","PreviousEntryName":"Unrestricted Lock on Critical Resource","Date":"2009-07-27"}]}