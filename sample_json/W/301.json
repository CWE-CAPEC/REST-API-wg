{"ID":"301","Name":"Reflection Attack in an Authentication Protocol","Abstraction":"Base","Structure":"Simple","Status":"Draft","Description":"Simple authentication protocols are subject to reflection attacks if a malicious user can use the target machine to impersonate a trusted user.","ExtendedDescription":"\n\nA mutual authentication protocol requires each party to respond to a random challenge by the other party by encrypting it with a pre-shared key. Often, however, such protocols employ the same pre-shared key for communication with a number of different entities. A malicious user or an attacker can easily compromise this protocol without possessing the correct key by employing a reflection attack on the protocol.\n\n\nReflection attacks capitalize on mutual authentication schemes in order to trick the target into revealing the secret shared between it and another valid user. In a basic mutual-authentication scheme, a secret is known to both the valid user and the server; this allows them to authenticate. In order that they may verify this shared secret without sending it plainly over the wire, they utilize a Diffie-Hellman-style scheme in which they each pick a value, then request the hash of that value as keyed by the shared secret. In a reflection attack, the attacker claims to be a valid user and requests the hash of a random value from the server. When the server returns this value and requests its own value to be hashed, the attacker opens another connection to the server. This time, the hash requested by the attacker is the value which the server requested in the first connection. When the server returns this hashed value, it is used in the first connection, authenticating the attacker successfully as the impersonated valid user.\n","LikelihoodOfExploit":"Medium","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"1390","ViewID":"1000","Ordinal":"Primary"},{"Nature":"PeerOf","CweID":"327","ViewID":"1000"}],"ApplicablePlatforms":[{"Type":"Language","Class":"Not Language-Specific","Prevalence":"Undetermined"}],"ModesOfIntroduction":[{"Phase":"Architecture and Design","Note":"COMMISSION: This weakness refers to an incorrect design related to an architectural security tactic."}],"CommonConsequences":[{"Scope":["Access Control"],"Impact":["Gain Privileges or Assume Identity"],"Note":"The primary result of reflection attacks is successful authentication with a target machine -- as an impersonated user."}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"Use different keys for the initiator and responder or of a different type of challenge for the initiator and responder."},{"Phase":["Architecture and Design"],"Description":"Let the initiator prove its identity before proceeding."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"The following example demonstrates the weakness."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tunsigned char *simple_digest(char *alg,char *buf,unsigned int len, int *olen) {\n\t\tconst EVP_MD *m;\n\t\tEVP_MD_CTX ctx;\n\t\tunsigned char *ret;\n\t\tOpenSSL_add_all_digests();\n\t\tif (!(m = EVP_get_digestbyname(alg))) return NULL;\n\t\tif (!(ret = (unsigned char*)malloc(EVP_MAX_MD_SIZE))) return NULL;\n\t\tEVP_DigestInit(\u0026ctx, m);\n\t\tEVP_DigestUpdate(\u0026ctx,buf,len);\n\t\tEVP_DigestFinal(\u0026ctx,ret,olen);\n\t\treturn ret;\n\t}\n\tunsigned char *generate_password_and_cmd(char *password_and_cmd) {\n\t\tsimple_digest(\"sha1\",password,strlen(password_and_cmd)\n\t\t...\n\t\t);\n\t}\n```"},{"Nature":"Bad","Language":"Java","ExampleCode":"```\n\tString command = new String(\"some cmd to execute \u0026 the password\") MessageDigest encer = MessageDigest.getInstance(\"SHA\");\n\tencer.update(command.getBytes(\"UTF-8\"));\n\tbyte[] digest = encer.digest();\n```"}]}],"ObservedExamples":[{"Reference":"CVE-2005-3435","Description":"product authentication succeeds if user-provided MD5 hash matches the hash in its database; this can be subjected to replay attacks.","Link":"https://www.cve.org/CVERecord?id=CVE-2005-3435"}],"TaxonomyMappings":[{"TaxonomyName":"CLASP","EntryName":"Reflection attack in an auth protocol"},{"TaxonomyName":"OWASP Top Ten 2007","EntryID":"A7","EntryName":"Broken Authentication and Session Management","MappingFit":"CWE More Specific"}],"RelatedAttackPatterns":["90"],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"References":[{"ExternalReferenceID":"REF-18","Authors":["Secure Software, Inc."],"Title":"The CLASP Application Security Process","PublicationYear":"2005","URL":"https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf"},{"ExternalReferenceID":"REF-62","Section":"Chapter 2, \"Insufficient Validation\", Page 38","Authors":["Mark Dowd","John McDonald","Justin Schuh"],"Title":"The Art of Software Security Assessment","Edition":"1st Edition","PublicationYear":"2006","Publisher":"Addison Wesley"}],"Notes":[{"Type":"Maintenance","Note":"The term \"reflection\" is used in multiple ways within CWE and the community, so its usage should be reviewed."}],"ContentHistory":[{"Type":"Submission","SubmissionName":"CLASP","SubmissionDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Common_Consequences, Description, Maintenance_Notes, Relationships, Other_Notes, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated Observed_Examples, References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Applicable_Platforms, Demonstrative_Examples, Modes_of_Introduction, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-03-15","ModificationComment":"updated Description, Other_Notes"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-01-31","ModificationComment":"updated Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes"}]}