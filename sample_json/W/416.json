{"ID":"416","Name":"Use After Free","Abstraction":"Variant","Structure":"Simple","Status":"Stable","Description":"Referencing memory after it has been freed can cause a program to crash, use unexpected values, or execute code.","ExtendedDescription":"\n\nThe use of previously-freed memory can have any number of adverse consequences, ranging from the corruption of valid data to the execution of arbitrary code, depending on the instantiation and timing of the flaw. The simplest way data corruption may occur involves the system's reuse of the freed memory. Use-after-free errors have two common and sometimes overlapping causes:\n\n\n  - Error conditions and other exceptional circumstances.\n\n  - Confusion over which part of the program is responsible for freeing the memory.\n\nIn this scenario, the memory in question is allocated to another pointer validly at some point after it has been freed. The original pointer to the freed memory is used again and points to somewhere within the new allocation. As the data is changed, it corrupts the validly used memory; this induces undefined behavior in the process.\n\nIf the newly allocated data happens to hold a class, in C++ for example, various function pointers may be scattered within the heap data. If one of these function pointers is overwritten with an address to valid shellcode, execution of arbitrary code can be achieved.\n","LikelihoodOfExploit":"High","RelatedWeaknesses":[{"Nature":"ChildOf","CweID":"825","ViewID":"1000","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"672","ViewID":"1003","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"672","ViewID":"1305","Ordinal":"Primary"},{"Nature":"ChildOf","CweID":"672","ViewID":"1340","Ordinal":"Primary"},{"Nature":"CanPrecede","CweID":"120","ViewID":"1000"},{"Nature":"CanPrecede","CweID":"123","ViewID":"1000"}],"ApplicablePlatforms":[{"Type":"Language","Name":"C","Prevalence":"Undetermined"},{"Type":"Language","Name":"C++","Prevalence":"Undetermined"}],"AlternateTerms":[{"Term":"Dangling pointer"},{"Term":"Use-After-Free"}],"ModesOfIntroduction":[{"Phase":"Implementation"}],"CommonConsequences":[{"Scope":["Integrity"],"Impact":["Modify Memory"],"Note":"The use of previously freed memory may corrupt valid data, if the memory area in question has been allocated and used properly elsewhere."},{"Scope":["Availability"],"Impact":["DoS: Crash, Exit, or Restart"],"Note":"If chunk consolidation occurs after the use of previously freed data, the process may crash when invalid data is used as chunk information."},{"Scope":["Integrity","Confidentiality","Availability"],"Impact":["Execute Unauthorized Code or Commands"],"Note":"If malicious data is entered before chunk consolidation can take place, it may be possible to take advantage of a write-what-where primitive to execute arbitrary code."}],"DetectionMethods":[{"DetectionMethodID":"DM-13","Method":"Fuzzing","Description":"Fuzz testing (fuzzing) is a powerful technique for generating large numbers of diverse inputs - either randomly or algorithmically - and dynamically invoking the code with those inputs. Even with random inputs, it is often capable of generating unexpected results such as crashes, memory corruption, or resource consumption. Fuzzing effectively produces repeatable test cases that clearly indicate bugs, which helps developers to diagnose the issues.","Effectiveness":"High"},{"DetectionMethodID":"DM-14","Method":"Automated Static Analysis","Description":"Automated static analysis, commonly referred to as Static Application Security Testing (SAST), can find some instances of this weakness by analyzing source code (or binary/compiled code) without having to execute it. Typically, this is done by building a model of data flow and control flow, then searching for potentially-vulnerable patterns that connect \"sources\" (origins of input) with \"sinks\" (destinations where the data interacts with external components, a lower layer such as the OS, etc.)","Effectiveness":"High"}],"PotentialMitigations":[{"Phase":["Architecture and Design"],"Description":"Choose a language that provides automatic memory management."},{"Phase":["Implementation"],"Description":"When freeing pointers, be sure to set them to NULL once they are freed. However, the utilization of multiple or complex data structures may lower the usefulness of this strategy."}],"DemonstrativeExamples":[{"Entries":[{"IntroText":"The following example demonstrates the weakness."},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\t#include \u003cstdio.h\u003e\n\t#include \u003cunistd.h\u003e\n\t#define BUFSIZER1 512\n\t#define BUFSIZER2 ((BUFSIZER1/2) - 8)\n\tint main(int argc, char **argv) {\n\t\tchar *buf1R1;\n\t\tchar *buf2R1;\n\t\tchar *buf2R2;\n\t\tchar *buf3R2;\n\t\tbuf1R1 = (char *) malloc(BUFSIZER1);\n\t\tbuf2R1 = (char *) malloc(BUFSIZER1);\n\t\tfree(buf2R1);\n\t\tbuf2R2 = (char *) malloc(BUFSIZER2);\n\t\tbuf3R2 = (char *) malloc(BUFSIZER2);\n\t\tstrncpy(buf2R1, argv[1], BUFSIZER1-1);\n\t\tfree(buf1R1);\n\t\tfree(buf2R2);\n\t\tfree(buf3R2);\n\t}\n```"}]},{"Entries":[{"IntroText":"The following code illustrates a use after free error:"},{"Nature":"Bad","Language":"C","ExampleCode":"```\n\tchar* ptr = (char*)malloc (SIZE);\n\tif (err) {\n\t\tabrt = 1;\n\t\tfree(ptr);\n\t}\n\t...\n\tif (abrt) {\n\t\tlogError(\"operation aborted before commit\", ptr);\n\t}\n```"},{"BodyText":"When an error occurs, the pointer is immediately freed. However, this pointer is later incorrectly used in the logError function."}]}],"ObservedExamples":[{"Reference":"CVE-2021-0920","Description":"Chain: mobile platform race condition (CWE-362) leading to use-after-free (CWE-416), as exploited in the wild per CISA KEV.","Link":"https://www.cve.org/CVERecord?id=CVE-2021-0920"},{"Reference":"CVE-2020-6819","Description":"Chain: race condition (CWE-362) leads to use-after-free (CWE-416), as exploited in the wild per CISA KEV.","Link":"https://www.cve.org/CVERecord?id=CVE-2020-6819"},{"Reference":"CVE-2010-4168","Description":"Use-after-free triggered by closing a connection while data is still being transmitted.","Link":"https://www.cve.org/CVERecord?id=CVE-2010-4168"},{"Reference":"CVE-2010-2941","Description":"Improper allocation for invalid data leads to use-after-free.","Link":"https://www.cve.org/CVERecord?id=CVE-2010-2941"},{"Reference":"CVE-2010-2547","Description":"certificate with a large number of Subject Alternate Names not properly handled in realloc, leading to use-after-free","Link":"https://www.cve.org/CVERecord?id=CVE-2010-2547"},{"Reference":"CVE-2010-1772","Description":"Timers are not disabled when a related object is deleted","Link":"https://www.cve.org/CVERecord?id=CVE-2010-1772"},{"Reference":"CVE-2010-1437","Description":"Access to a \"dead\" object that is being cleaned up","Link":"https://www.cve.org/CVERecord?id=CVE-2010-1437"},{"Reference":"CVE-2010-1208","Description":"object is deleted even with a non-zero reference count, and later accessed","Link":"https://www.cve.org/CVERecord?id=CVE-2010-1208"},{"Reference":"CVE-2010-0629","Description":"use-after-free involving request containing an invalid version number","Link":"https://www.cve.org/CVERecord?id=CVE-2010-0629"},{"Reference":"CVE-2010-0378","Description":"unload of an object that is currently being accessed by other functionality","Link":"https://www.cve.org/CVERecord?id=CVE-2010-0378"},{"Reference":"CVE-2010-0302","Description":"incorrectly tracking a reference count leads to use-after-free","Link":"https://www.cve.org/CVERecord?id=CVE-2010-0302"},{"Reference":"CVE-2010-0249","Description":"use-after-free related to use of uninitialized memory","Link":"https://www.cve.org/CVERecord?id=CVE-2010-0249"},{"Reference":"CVE-2010-0050","Description":"HTML document with incorrectly-nested tags","Link":"https://www.cve.org/CVERecord?id=CVE-2010-0050"},{"Reference":"CVE-2009-3658","Description":"Use after free in ActiveX object by providing a malformed argument to a method","Link":"https://www.cve.org/CVERecord?id=CVE-2009-3658"},{"Reference":"CVE-2009-3616","Description":"use-after-free by disconnecting during data transfer, or a message containing incorrect data types","Link":"https://www.cve.org/CVERecord?id=CVE-2009-3616"},{"Reference":"CVE-2009-3553","Description":"disconnect during a large data transfer causes incorrect reference count, leading to use-after-free","Link":"https://www.cve.org/CVERecord?id=CVE-2009-3553"},{"Reference":"CVE-2009-2416","Description":"use-after-free found by fuzzing","Link":"https://www.cve.org/CVERecord?id=CVE-2009-2416"},{"Reference":"CVE-2009-1837","Description":"Chain: race condition (CWE-362) from improper handling of a page transition in web client while an applet is loading (CWE-368) leads to use after free (CWE-416)","Link":"https://www.cve.org/CVERecord?id=CVE-2009-1837"},{"Reference":"CVE-2009-0749","Description":"realloc generates new buffer and pointer, but previous pointer is still retained, leading to use after free","Link":"https://www.cve.org/CVERecord?id=CVE-2009-0749"},{"Reference":"CVE-2010-3328","Description":"Use-after-free in web browser, probably resultant from not initializing memory.","Link":"https://www.cve.org/CVERecord?id=CVE-2010-3328"},{"Reference":"CVE-2008-5038","Description":"use-after-free when one thread accessed memory that was freed by another thread","Link":"https://www.cve.org/CVERecord?id=CVE-2008-5038"},{"Reference":"CVE-2008-0077","Description":"assignment of malformed values to certain properties triggers use after free","Link":"https://www.cve.org/CVERecord?id=CVE-2008-0077"},{"Reference":"CVE-2006-4434","Description":"mail server does not properly handle a long header.","Link":"https://www.cve.org/CVERecord?id=CVE-2006-4434"},{"Reference":"CVE-2010-2753","Description":"chain: integer overflow leads to use-after-free","Link":"https://www.cve.org/CVERecord?id=CVE-2010-2753"},{"Reference":"CVE-2006-4997","Description":"freed pointer dereference","Link":"https://www.cve.org/CVERecord?id=CVE-2006-4997"}],"AffectedResources":["Memory"],"TaxonomyMappings":[{"TaxonomyName":"7 Pernicious Kingdoms","EntryName":"Use After Free"},{"TaxonomyName":"CLASP","EntryName":"Using freed memory"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MEM00-C","EntryName":"Allocate and free memory in the same module, at the same level of abstraction"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MEM01-C","EntryName":"Store a new value in pointers immediately after free()"},{"TaxonomyName":"CERT C Secure Coding","EntryID":"MEM30-C","EntryName":"Do not access freed memory","MappingFit":"Exact"},{"TaxonomyName":"Software Fault Patterns","EntryID":"SFP15","EntryName":"Faulty Resource Use"}],"MappingNotes":{"Usage":"Allowed","Rationale":"This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.","Comments":"Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.","Reasons":["Acceptable-Use"]},"References":[{"ExternalReferenceID":"REF-6","Authors":["Katrina Tsipenyuk","Brian Chess","Gary McGraw"],"Title":"Seven Pernicious Kingdoms: A Taxonomy of Software Security Errors","Publication":"NIST Workshop on Software Security Assurance Tools Techniques and Metrics","PublicationYear":"2005","PublicationMonth":"11","PublicationDay":"07","Publisher":"NIST","URL":"https://samate.nist.gov/SSATTM_Content/papers/Seven%20Pernicious%20Kingdoms%20-%20Taxonomy%20of%20Sw%20Security%20Errors%20-%20Tsipenyuk%20-%20Chess%20-%20McGraw.pdf"},{"ExternalReferenceID":"REF-18","Authors":["Secure Software, Inc."],"Title":"The CLASP Application Security Process","PublicationYear":"2005","URL":"https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf"},{"ExternalReferenceID":"REF-44","Section":"\"Sin 8: C++ Catastrophes.\" Page 143","Authors":["Michael Howard","David LeBlanc","John Viega"],"Title":"24 Deadly Sins of Software Security","Publication":"McGraw-Hill","PublicationYear":"2010"}],"ContentHistory":[{"Type":"Submission","SubmissionName":"7 Pernicious Kingdoms","SubmissionDate":"2006-07-19"},{"Type":"Modification","ModificationName":"Eric Dalci","ModificationOrganization":"Cigital","ModificationDate":"2008-07-01","ModificationComment":"updated Potential_Mitigations, Time_of_Introduction"},{"Type":"Modification","ModificationOrganization":"KDM Analytics","ModificationDate":"2008-08-01","ModificationComment":"added/updated white box definitions"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-09-08","ModificationComment":"updated Applicable_Platforms, Common_Consequences, Relationships, Observed_Example, Other_Notes, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2008-11-24","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-03-10","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-05-27","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2009-10-29","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-02-16","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-06-21","ModificationComment":"updated Potential_Mitigations"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-09-27","ModificationComment":"updated Observed_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2010-12-13","ModificationComment":"updated Alternate_Terms, Common_Consequences, Description, Observed_Examples, Other_Notes, Potential_Mitigations, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-03-29","ModificationComment":"updated Description"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-01","ModificationComment":"updated Common_Consequences"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-06-27","ModificationComment":"updated Demonstrative_Examples"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2011-09-13","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2012-05-11","ModificationComment":"updated References, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2014-07-30","ModificationComment":"updated Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2015-12-07","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2017-11-08","ModificationComment":"updated Demonstrative_Examples, Relationships, Taxonomy_Mappings, White_Box_Definitions"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-01-03","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-06-20","ModificationComment":"updated Relationships, Type"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2019-09-19","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-02-24","ModificationComment":"updated References, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-06-25","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-08-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2020-12-10","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2021-07-20","ModificationComment":"updated Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-06-28","ModificationComment":"updated Observed_Examples, Relationships"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2022-10-13","ModificationComment":"updated Description, Relationships, Taxonomy_Mappings"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-04-27","ModificationComment":"updated Detection_Factors, Relationships, Time_of_Introduction"},{"Type":"Modification","ModificationName":"CWE Content Team","ModificationOrganization":"MITRE","ModificationDate":"2023-06-29","ModificationComment":"updated Mapping_Notes, Relationships"},{"Type":"Contribution","ContributionName":"Anonymous External Contributor","ContributionDate":"2022-06-28","ContributionComment":"Suggested rephrase for extended description","ContributionType":"Feedback"}]}